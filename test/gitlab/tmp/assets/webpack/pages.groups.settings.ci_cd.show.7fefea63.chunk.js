(this.webpackJsonp=this.webpackJsonp||[]).push([[71],{1043:function(e,t,n){n(42),n(110),e.exports=n(1044)},1044:function(e,t,n){"use strict";n.r(t);var i=n(155),a=n(478);document.addEventListener("DOMContentLoaded",function(){Object(i.a)();var e=document.querySelector(".js-ci-variable-list-section");new a.a({container:e,saveButton:e.querySelector(".js-ci-variables-save-button"),errorBox:e.querySelector(".js-ci-variable-error-box"),saveEndpoint:e.dataset.saveEndpoint})})},110:function(e,t,n){"use strict";n.r(t);var i=n(36),a=n(38);document.addEventListener("DOMContentLoaded",function(){var e,t=document.body.dataset.page;["groups:clusters:new","groups:clusters:create_gcp","groups:clusters:create_user"].indexOf(t)>-1&&((e=document.querySelector(".gcp-signup-offer"))&&new i.a(e),Object(a.a)())})},155:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(0),a=n.n(i),o=n(1);function r(e){e.find(".js-settings-toggle:not(.js-settings-toggle-trigger-only)").text(Object(o.a)("Collapse")),e.find(".settings-content").off("scroll.expandSection").scrollTop(0),e.addClass("expanded"),e.hasClass("no-animate")||e.addClass("animating").one("animationend.animateSection",function(){return e.removeClass("animating")})}function s(e){e.removeClass("no-animate"),e.hasClass("expanded")?function(e){e.find(".js-settings-toggle:not(.js-settings-toggle-trigger-only)").text(Object(o.a)("Expand")),e.find(".settings-content").on("scroll.expandSection",function(){return r(e)}),e.removeClass("expanded"),e.hasClass("no-animate")||e.addClass("animating").one("animationend.animateSection",function(){return e.removeClass("animating")})}(e):r(e)}function c(){if(a()(".settings").each(function(e,t){var n=a()(t);n.on("click.toggleSection",".js-settings-toggle",function(){return s(n)}),n.hasClass("expanded")||n.find(".settings-content").on("scroll.expandSection",function(){n.removeClass("no-animate"),r(n)})}),window.location.hash){var e=a()(window.location.hash);e.length&&e.hasClass("settings")&&r(e)}}},201:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(5),a=n.n(i);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultToggleLabel=t.defaultToggleLabel,this.fieldName=t.fieldName,this.onSelect=t.onSelect||function(){},this.getDataOption=t.getData,this.getDataRemote=!!t.filterRemote,this.createNewItemFromValueOption=t.createNewItemFromValue,this.$dropdown=t.$dropdown,this.$dropdownContainer=this.$dropdown.parent(),this.$dropdownFooter=this.$dropdownContainer.find(".dropdown-footer"),this.$createButton=this.$dropdownContainer.find(".js-dropdown-create-new-item"),this.buildDropdown(),this.bindEvents(),this.toggleFooter(!0)}var t,n,i;return t=e,(n=[{key:"buildDropdown",value:function(){var e=this;this.$dropdown.glDropdown({data:this.getData.bind(this),filterable:!0,filterRemote:this.getDataRemote,search:{fields:["text"]},selectable:!0,toggleLabel:function(e){return e&&"id"in e?a.a.escape(e.title):this.defaultToggleLabel},fieldName:this.fieldName,text:function(e){return a.a.escape(e.text)},id:function(e){return a.a.escape(e.id)},onFilter:this.toggleCreateNewButton.bind(this),clicked:function(t){t.e.preventDefault(),e.onSelect()}})}},{key:"clearDropdown",value:function(){this.$dropdownContainer.find(".dropdown-content").html(""),this.$dropdownContainer.find(".dropdown-input-field").val("")}},{key:"bindEvents",value:function(){this.$createButton.on("click",this.onClickCreateWildcard.bind(this))}},{key:"onClickCreateWildcard",value:function(e){e.preventDefault(),this.refreshData(),this.$dropdown.data("glDropdown").selectRowAtIndex()}},{key:"refreshData",value:function(){this.$dropdown.data("glDropdown").remote.execute()}},{key:"getData",value:function(e,t){var n=this;this.getDataOption(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=e;n.selectedItem&&e.some(function(e){return e.id===n.selectedItem.id})||(i=e.concat(n.selectedItem||[])),t(i)})}},{key:"createNewItemFromValue",value:function(e){return this.createNewItemFromValueOption?this.createNewItemFromValueOption(e):{title:e,id:e,text:e}}},{key:"toggleCreateNewButton",value:function(e){e&&(this.selectedItem=this.createNewItemFromValue(e),this.$dropdownContainer.find(".js-dropdown-create-new-item code").text(e)),this.toggleFooter(!e)}},{key:"toggleFooter",value:function(e){this.$dropdownFooter.toggleClass("hidden",e)}}])&&o(t.prototype,n),i&&o(t,i),e}()},286:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),a=n.n(i),o=n(7),r=n(1),s=n(13);function c(e,t){e.classList.toggle("is-checked",t)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.querySelectorAll(".js-project-feature-toggle").forEach(function(e){var n=e.querySelector(".js-project-feature-toggle-input");c(e,Object(s.A)(n.value)),e.addEventListener("click",function(e,t,n){var i=Object(s.A)(t.value);c(e,!i),e.setAttribute("disabled",!0),e.classList.toggle("is-loading",!0),Promise.resolve(n(!i,e)).then(function(){t.setAttribute("value",!i)}).catch(function(){c(e,i)}).then(function(){e.removeAttribute("disabled"),e.classList.toggle("is-loading",!1),a()(t).trigger("trigger-change")}).catch(function(){Object(o.a)(Object(r.a)("Something went wrong when toggling the button"))})}.bind(null,e,n,t))})}},319:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(1),a=n(13);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){function e(t){var n=t.container,i=t.valueSelector,a=void 0===i?".js-secret-value":i,o=t.placeholderSelector,r=void 0===o?".js-secret-value-placeholder":o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.valueSelector=a,this.placeholderSelector=r}var t,n,r;return t=e,(n=[{key:"init",value:function(){if(this.revealButton=this.container.querySelector(".js-secret-value-reveal-button"),this.revealButton){var e=Object(a.A)(this.revealButton.dataset.secretRevealStatus);this.updateDom(e),this.revealButton.addEventListener("click",this.onRevealButtonClicked.bind(this))}}},{key:"onRevealButtonClicked",value:function(){var e=Object(a.A)(this.revealButton.dataset.secretRevealStatus);this.updateDom(!e)}},{key:"updateDom",value:function(e){var t=this.container.querySelectorAll(this.valueSelector);t.forEach(function(t){t.classList.toggle("hide",!e)}),this.container.querySelectorAll(this.placeholderSelector).forEach(function(t){t.classList.toggle("hide",e)}),this.revealButton.textContent=e?Object(i.d)("Hide value","Hide values",t.length):Object(i.d)("Reveal value","Reveal values",t.length),this.revealButton.dataset.secretRevealStatus=e}}])&&o(t.prototype,n),r&&o(t,r),e}()},357:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(0),a=n.n(i),o=n(13),r=n(1),s=n(286),c=n(201),l=n(319);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=Object(r.e)("CiVariable|All environments");function v(e){return{title:"*"===e?f:e,id:e,text:"*"===e?Object(r.e)("CiVariable|* (All environments)"):e}}var h=function(){function e(t){var n=t.container,i=t.formField;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=a()(n),this.formField=i,this.environmentDropdownMap=new WeakMap,this.inputMap={id:{selector:".js-ci-variable-input-id",default:""},key:{selector:".js-ci-variable-input-key",default:""},secret_value:{selector:".js-ci-variable-input-value",default:""},protected:{selector:".js-ci-variable-input-protected",default:a()(".js-ci-variable-input-protected").attr("data-default")},environment_scope:{selector:'input[name="'.concat(this.formField,'[variables_attributes][][environment_scope]"]'),default:"*"},_destroy:{selector:".js-ci-variable-input-destroy",default:""}},this.secretValues=new l.a({container:this.$container[0],valueSelector:".js-row:not(:last-child) .js-secret-value",placeholderSelector:".js-row:not(:last-child) .js-secret-value-placeholder"})}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.bindEvents(),this.secretValues.init()}},{key:"bindEvents",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){e.initRow(n)}),this.$container.on("click",".js-row-remove-button",function(t){t.preventDefault(),e.removeRow(a()(t.currentTarget).closest(".js-row"))});var t=Object.keys(this.inputMap).map(function(t){return e.inputMap[t].selector}).join(",");this.$container.on("blur",t,function(t){var n=a()(t.currentTarget).closest(".js-row");n.is(":not(:last-child)")&&!e.checkIfRowTouched(n)&&e.removeRow(n)}),this.$container.on("input trigger-change",t,function(){var t=e.$container.find(".js-row").last();e.checkIfRowTouched(t)&&e.insertRow(t)})}},{key:"initRow",value:function(e){var t=this,n=a()(e);Object(s.a)(n[0]),n.find(this.inputMap.secret_value.selector).css("height","");var i=n.find(".js-variable-environment-toggle");if(i.length){var o=new c.a({$dropdown:i,defaultToggleLabel:f,fieldName:"".concat(this.formField,"[variables_attributes][][environment_scope]"),getData:function(e,n){return n(t.getEnvironmentValues())},createNewItemFromValue:v,onSelect:function(){t.refreshDropdownData(),n.find(t.inputMap.environment_scope.selector).trigger("trigger-change")}});o.clearDropdown(),this.environmentDropdownMap.set(n[0],o)}}},{key:"insertRow",value:function(e){var t=this,n=e.clone();n.removeAttr("data-is-persisted"),Object.keys(this.inputMap).forEach(function(e){var i=t.inputMap[e];n.find(i.selector).val(i.default)}),n.find(".dropdown-menu.show").each(function(e,t){t.classList.remove("show")}),this.initRow(n),e.after(n)}},{key:"removeRow",value:function(e){var t=a()(e);Object(o.A)(t.attr("data-is-persisted"))?(t.hide(),t.find(this.inputMap._destroy.selector).val(!0)):t.remove(),this.refreshDropdownData()}},{key:"checkIfRowTouched",value:function(e){var t=this;return Object.keys(this.inputMap).some(function(n){var i=t.inputMap[n],a=e.find(i.selector);return a.length&&a.val()!==i.default})}},{key:"toggleEnableRow",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$container.find(this.inputMap.key.selector).attr("disabled",!e),this.$container.find(".js-row-remove-button").attr("disabled",!e)}},{key:"hideValues",value:function(){this.secretValues.updateDom(!1)}},{key:"getAllData",value:function(){var e=this;return this.$container.find(".js-row").toArray().slice(0,-1).map(function(t){var n={};return Object.keys(e.inputMap).forEach(function(i){var o=e.inputMap[i],r=a()(t).find(o.selector);r.length&&(n[i]=r.val())}),n})}},{key:"getEnvironmentValues",value:function(){var e=this.$container.find(this.inputMap.environment_scope.selector).toArray().reduce(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){u(e,t,n[t])})}return e}({},e,u({},t.value,t.value))},{});return Object.keys(e).map(v)}},{key:"refreshDropdownData",value:function(){var e=this;this.$container.find(".js-row").each(function(t,n){var i=e.environmentDropdownMap.get(n);i&&i.refreshData()})}}])&&d(t.prototype,n),i&&d(t,i),e}()},478:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var i=n(5),a=n.n(i),o=n(6),r=n(1),s=n(7),c=n(13),l=n(83),u=n(357);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t){var n=t.container,i=t.saveButton,a=t.errorBox,o=t.formField,r=void 0===o?"variables":o,s=t.saveEndpoint;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n,this.saveButton=i,this.errorBox=a,this.saveEndpoint=s,this.variableList=new u.a({container:this.container,formField:r}),this.bindEvents(),this.variableList.init()}var t,n,i;return t=e,(n=[{key:"bindEvents",value:function(){this.saveButton.addEventListener("click",this.onSaveClicked.bind(this))}},{key:"onSaveClicked",value:function(){var e=this,t=this.saveButton.querySelector(".js-ci-variables-save-loading-icon");return t.classList.toggle("hide",!1),this.errorBox.classList.toggle("hide",!0),this.variableList.toggleEnableRow(!1),o.a.patch(this.saveEndpoint,{variables_attributes:this.variableList.getAllData()},{validateStatus:function(e){return e>=l.a.OK&&e<l.a.MULTIPLE_CHOICES||e===l.a.BAD_REQUEST}}).then(function(n){var i,o;t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),n.status===l.a.OK&&n.data?(e.updateRowsWithPersistedVariables(n.data.variables),e.variableList.hideValues()):n.status===l.a.BAD_REQUEST&&(e.errorBox.innerHTML=(i=n.data,o=[].concat(i).map(function(e){return"\n    <li>\n      ".concat(a.a.escape(e),"\n    </li>\n  ")}),"\n    <p>\n      ".concat(Object(r.e)("CiVariable|Validation failed"),"\n    </p>\n    <ul>\n      ").concat(o.join(""),"\n    </ul>\n  ")),e.errorBox.classList.toggle("hide",!1))}).catch(function(){t.classList.toggle("hide",!0),e.variableList.toggleEnableRow(!0),Object(s.a)(Object(r.e)("CiVariable|Error occurred while saving variables"))})}},{key:"updateRowsWithPersistedVariables",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[].concat(e).reduce(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){d(e,t,n[t])})}return e}({},e,d({},t.key,t))},{});this.container.querySelectorAll(".js-row").forEach(function(e){var n=e.querySelector(".js-ci-variable-input-destroy");if(Object(c.A)(n.value))e.remove();else{var i=e.querySelector(".js-ci-variable-input-key").value,a=t[i];a&&(e.querySelector(".js-ci-variable-input-id").value=a.id,e.setAttribute("data-is-persisted","true"))}})}}])&&f(t.prototype,n),i&&f(t,i),e}()},83:function(e,t,n){"use strict";n.d(t,"b",function(){return a});var i={ABORTED:0,OK:200,CREATED:201,ACCEPTED:202,NON_AUTHORITATIVE_INFORMATION:203,NO_CONTENT:204,RESET_CONTENT:205,PARTIAL_CONTENT:206,MULTI_STATUS:207,ALREADY_REPORTED:208,IM_USED:226,MULTIPLE_CHOICES:300,BAD_REQUEST:400,FORBIDDEN:403,NOT_FOUND:404,UNPROCESSABLE_ENTITY:422},a=[i.OK,i.CREATED,i.ACCEPTED,i.NON_AUTHORITATIVE_INFORMATION,i.NO_CONTENT,i.RESET_CONTENT,i.PARTIAL_CONTENT,i.MULTI_STATUS,i.ALREADY_REPORTED,i.IM_USED];t.a=i}},[[1043,1,0,2]]]);
//# sourceMappingURL=pages.groups.settings.ci_cd.show.7fefea63.chunk.js.map