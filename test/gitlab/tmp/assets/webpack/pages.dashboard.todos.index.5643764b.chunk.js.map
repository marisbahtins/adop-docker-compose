{"version":3,"sources":["webpack:///./pages/dashboard/todos/index/todos.js","webpack:///./pages/dashboard/todos/index/index.js"],"names":["Todos","_classCallCheck","this","initFilters","bindEvents","todo_ids","cleanupWrapper","cleanup","bind","document","addEventListener","unbindEvents","removeEventListener","$","off","updateRowStateClickedWrapper","updateallStateClickedWrapper","goToTodoUrl","updateRowStateClicked","updateAllStateClickedWrapper","updateAllStateClicked","on","initFilterDropdown","UsersSelect","$dropdown","fieldName","searchFields","glDropdown","selectable","filterable","search","fields","data","clicked","$formEl","closest","find","concat","group_id","project_id","remove","submit","e","_this","stopPropagation","preventDefault","target","setAttribute","classList","add","axios","dataset","method","href","then","_ref","updateRowState","updateBadges","catch","flash","__","isInactive","arguments","length","undefined","row","restoreBtn","querySelector","doneBtn","removeAttribute","parentNode","removeChild","_this2","currentTarget","ids","_ref2","updateAllState","markAllDoneBtn","undoAllBtn","todoListContainer","nothingHereContainer","updated_ids","toggle","trigger","count","innerHTML","done_count","todoLink","url","tagName","isMetaClick","window","open","visitUrl"],"mappings":"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","file":"pages.dashboard.todos.index.5643764b.chunk.js","sourcesContent":["/* eslint-disable class-methods-use-this, no-unneeded-ternary */\n\nimport $ from 'jquery';\nimport { visitUrl } from '~/lib/utils/url_utility';\nimport UsersSelect from '~/users_select';\nimport { isMetaClick } from '~/lib/utils/common_utils';\nimport { __ } from '~/locale';\nimport flash from '~/flash';\nimport axios from '~/lib/utils/axios_utils';\n\nexport default class Todos {\n  constructor() {\n    this.initFilters();\n    this.bindEvents();\n    this.todo_ids = [];\n\n    this.cleanupWrapper = this.cleanup.bind(this);\n    document.addEventListener('beforeunload', this.cleanupWrapper);\n  }\n\n  cleanup() {\n    this.unbindEvents();\n    document.removeEventListener('beforeunload', this.cleanupWrapper);\n  }\n\n  unbindEvents() {\n    $('.js-done-todo, .js-undo-todo, .js-add-todo').off('click', this.updateRowStateClickedWrapper);\n    $('.js-todos-mark-all', '.js-todos-undo-all').off('click', this.updateallStateClickedWrapper);\n    $('.todo').off('click', this.goToTodoUrl);\n  }\n\n  bindEvents() {\n    this.updateRowStateClickedWrapper = this.updateRowStateClicked.bind(this);\n    this.updateAllStateClickedWrapper = this.updateAllStateClicked.bind(this);\n\n    $('.js-done-todo, .js-undo-todo, .js-add-todo').on('click', this.updateRowStateClickedWrapper);\n    $('.js-todos-mark-all, .js-todos-undo-all').on('click', this.updateAllStateClickedWrapper);\n    $('.todo').on('click', this.goToTodoUrl);\n  }\n\n  initFilters() {\n    this.initFilterDropdown($('.js-group-search'), 'group_id', ['text']);\n    this.initFilterDropdown($('.js-project-search'), 'project_id', ['text']);\n    this.initFilterDropdown($('.js-type-search'), 'type');\n    this.initFilterDropdown($('.js-action-search'), 'action_id');\n\n    return new UsersSelect();\n  }\n\n  initFilterDropdown($dropdown, fieldName, searchFields) {\n    $dropdown.glDropdown({\n      fieldName,\n      selectable: true,\n      filterable: searchFields ? true : false,\n      search: { fields: searchFields },\n      data: $dropdown.data('data'),\n      clicked: () => {\n        const $formEl = $dropdown.closest('form.filter-form');\n        const mutexDropdowns = {\n          group_id: 'project_id',\n          project_id: 'group_id',\n        };\n\n        $formEl.find(`input[name=\"${mutexDropdowns[fieldName]}\"]`).remove();\n        $formEl.submit();\n      },\n    });\n  }\n\n  updateRowStateClicked(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const { target } = e;\n    target.setAttribute('disabled', true);\n    target.classList.add('disabled');\n\n    axios[target.dataset.method](target.dataset.href)\n      .then(({ data }) => {\n        this.updateRowState(target);\n        this.updateBadges(data);\n      })\n      .catch(() => {\n        this.updateRowState(target, true);\n        return flash(__('Error updating todo status.'));\n      });\n  }\n\n  updateRowState(target, isInactive = false) {\n    const row = target.closest('li');\n    const restoreBtn = row.querySelector('.js-undo-todo');\n    const doneBtn = row.querySelector('.js-done-todo');\n\n    target.classList.add('hidden');\n    target.removeAttribute('disabled');\n    target.classList.remove('disabled');\n\n    if (isInactive === true) {\n      restoreBtn.classList.add('hidden');\n      doneBtn.classList.remove('hidden');\n    } else if (target === doneBtn) {\n      row.classList.add('done-reversible');\n      restoreBtn.classList.remove('hidden');\n    } else if (target === restoreBtn) {\n      row.classList.remove('done-reversible');\n      doneBtn.classList.remove('hidden');\n    } else {\n      row.parentNode.removeChild(row);\n    }\n  }\n\n  updateAllStateClicked(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const target = e.currentTarget;\n    target.setAttribute('disabled', true);\n    target.classList.add('disabled');\n\n    axios[target.dataset.method](target.dataset.href, {\n      ids: this.todo_ids,\n    })\n      .then(({ data }) => {\n        this.updateAllState(target, data);\n        this.updateBadges(data);\n      })\n      .catch(() => flash(__('Error updating status for all todos.')));\n  }\n\n  updateAllState(target, data) {\n    const markAllDoneBtn = document.querySelector('.js-todos-mark-all');\n    const undoAllBtn = document.querySelector('.js-todos-undo-all');\n    const todoListContainer = document.querySelector('.js-todos-list-container');\n    const nothingHereContainer = document.querySelector('.js-nothing-here-container');\n\n    target.removeAttribute('disabled');\n    target.classList.remove('disabled');\n\n    this.todo_ids = target === markAllDoneBtn ? data.updated_ids : [];\n    undoAllBtn.classList.toggle('hidden');\n    markAllDoneBtn.classList.toggle('hidden');\n    todoListContainer.classList.toggle('hidden');\n    nothingHereContainer.classList.toggle('hidden');\n  }\n\n  updateBadges(data) {\n    $(document).trigger('todo:toggle', data.count);\n    document.querySelector('.todos-pending .badge').innerHTML = data.count;\n    document.querySelector('.todos-done .badge').innerHTML = data.done_count;\n  }\n\n  goToTodoUrl(e) {\n    const todoLink = this.dataset.url;\n\n    if (!todoLink || e.target.tagName === 'A' || e.target.tagName === 'IMG') {\n      return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (isMetaClick(e)) {\n      const windowTarget = '_blank';\n\n      window.open(todoLink, windowTarget);\n    } else {\n      visitUrl(todoLink);\n    }\n  }\n}\n","import Todos from './todos';\n\ndocument.addEventListener('DOMContentLoaded', () => new Todos());\n"],"sourceRoot":""}