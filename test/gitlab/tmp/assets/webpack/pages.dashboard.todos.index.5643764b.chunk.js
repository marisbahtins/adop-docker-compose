(this.webpackJsonp=this.webpackJsonp||[]).push([[49],{1003:function(e,t,o){o(42),e.exports=o(1438)},1438:function(e,t,o){"use strict";o.r(t);var a=o(0),d=o.n(a),i=o(19),n=o(105),s=o(13),r=o(1),l=o(7),c=o(6);function u(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initFilters(),this.bindEvents(),this.todo_ids=[],this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper)}var t,o,a;return t=e,(o=[{key:"cleanup",value:function(){this.unbindEvents(),document.removeEventListener("beforeunload",this.cleanupWrapper)}},{key:"unbindEvents",value:function(){d()(".js-done-todo, .js-undo-todo, .js-add-todo").off("click",this.updateRowStateClickedWrapper),d()(".js-todos-mark-all",".js-todos-undo-all").off("click",this.updateallStateClickedWrapper),d()(".todo").off("click",this.goToTodoUrl)}},{key:"bindEvents",value:function(){this.updateRowStateClickedWrapper=this.updateRowStateClicked.bind(this),this.updateAllStateClickedWrapper=this.updateAllStateClicked.bind(this),d()(".js-done-todo, .js-undo-todo, .js-add-todo").on("click",this.updateRowStateClickedWrapper),d()(".js-todos-mark-all, .js-todos-undo-all").on("click",this.updateAllStateClickedWrapper),d()(".todo").on("click",this.goToTodoUrl)}},{key:"initFilters",value:function(){return this.initFilterDropdown(d()(".js-group-search"),"group_id",["text"]),this.initFilterDropdown(d()(".js-project-search"),"project_id",["text"]),this.initFilterDropdown(d()(".js-type-search"),"type"),this.initFilterDropdown(d()(".js-action-search"),"action_id"),new n.a}},{key:"initFilterDropdown",value:function(e,t,o){e.glDropdown({fieldName:t,selectable:!0,filterable:!!o,search:{fields:o},data:e.data("data"),clicked:function(){var o=e.closest("form.filter-form");o.find('input[name="'.concat({group_id:"project_id",project_id:"group_id"}[t],'"]')).remove(),o.submit()}})}},{key:"updateRowStateClicked",value:function(e){var t=this;e.stopPropagation(),e.preventDefault();var o=e.target;o.setAttribute("disabled",!0),o.classList.add("disabled"),c.a[o.dataset.method](o.dataset.href).then(function(e){var a=e.data;t.updateRowState(o),t.updateBadges(a)}).catch(function(){return t.updateRowState(o,!0),Object(l.a)(Object(r.a)("Error updating todo status."))})}},{key:"updateRowState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=e.closest("li"),a=o.querySelector(".js-undo-todo"),d=o.querySelector(".js-done-todo");e.classList.add("hidden"),e.removeAttribute("disabled"),e.classList.remove("disabled"),!0===t?(a.classList.add("hidden"),d.classList.remove("hidden")):e===d?(o.classList.add("done-reversible"),a.classList.remove("hidden")):e===a?(o.classList.remove("done-reversible"),d.classList.remove("hidden")):o.parentNode.removeChild(o)}},{key:"updateAllStateClicked",value:function(e){var t=this;e.stopPropagation(),e.preventDefault();var o=e.currentTarget;o.setAttribute("disabled",!0),o.classList.add("disabled"),c.a[o.dataset.method](o.dataset.href,{ids:this.todo_ids}).then(function(e){var a=e.data;t.updateAllState(o,a),t.updateBadges(a)}).catch(function(){return Object(l.a)(Object(r.a)("Error updating status for all todos."))})}},{key:"updateAllState",value:function(e,t){var o=document.querySelector(".js-todos-mark-all"),a=document.querySelector(".js-todos-undo-all"),d=document.querySelector(".js-todos-list-container"),i=document.querySelector(".js-nothing-here-container");e.removeAttribute("disabled"),e.classList.remove("disabled"),this.todo_ids=e===o?t.updated_ids:[],a.classList.toggle("hidden"),o.classList.toggle("hidden"),d.classList.toggle("hidden"),i.classList.toggle("hidden")}},{key:"updateBadges",value:function(e){d()(document).trigger("todo:toggle",e.count),document.querySelector(".todos-pending .badge").innerHTML=e.count,document.querySelector(".todos-done .badge").innerHTML=e.done_count}},{key:"goToTodoUrl",value:function(e){var t=this.dataset.url;if(t&&"A"!==e.target.tagName&&"IMG"!==e.target.tagName)if(e.stopPropagation(),e.preventDefault(),Object(s.v)(e)){window.open(t,"_blank")}else Object(i.g)(t)}}])&&u(t.prototype,o),a&&u(t,a),e}();document.addEventListener("DOMContentLoaded",function(){return new p})}},[[1003,1,0,4]]]);
//# sourceMappingURL=pages.dashboard.todos.index.5643764b.chunk.js.map