(this.webpackJsonp=this.webpackJsonp||[]).push([[163],{1362:function(t,e,n){n(42),n(44),t.exports=n(1422)},1422:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),a=n(6),o=n(7);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$form=i()(e),this.canTestService=this.$form.data("canTest"),this.testEndPoint=this.$form.data("testUrl"),this.$serviceToggle=this.$form.find("#service_active"),this.$submitBtn=this.$form.find('button[type="submit"]'),this.$submitBtnLoader=this.$submitBtn.find(".js-btn-spinner"),this.$submitBtnLabel=this.$submitBtn.find(".js-btn-label")}var e,n,r;return e=t,(n=[{key:"init",value:function(){var t=this;this.toggleServiceState(this.$serviceToggle.is(":checked")),this.$serviceToggle.on("change",function(e){return t.handleServiceToggle(e)}),this.$submitBtn.on("click",function(e){return t.handleSettingsSave(e)})}},{key:"handleSettingsSave",value:function(t){this.$serviceToggle.is(":checked")&&this.$form.get(0).checkValidity()&&this.canTestService&&(t.preventDefault(),this.testSettings(this.$form.serialize()))}},{key:"handleServiceToggle",value:function(t){this.toggleServiceState(i()(t.currentTarget).is(":checked"))}},{key:"toggleServiceState",value:function(t){this.toggleSubmitBtnLabel(t),t?this.$form.removeAttr("novalidate"):this.$form.attr("novalidate")||this.$form.attr("novalidate","novalidate")}},{key:"toggleSubmitBtnLabel",value:function(t){var e="Save changes";t&&this.canTestService&&(e="Test settings and save changes"),this.$submitBtnLabel.text(e)}},{key:"toggleSubmitBtnState",value:function(t){t?(this.$submitBtn.disable(),this.$submitBtnLoader.removeClass("hidden")):(this.$submitBtn.enable(),this.$submitBtnLoader.addClass("hidden"))}},{key:"testSettings",value:function(t){var e=this;return this.toggleSubmitBtnState(!0),a.a.put(this.testEndPoint,t).then(function(t){var n,r=t.data;r.error?(r.test_failed&&(n={title:"Save anyway",clickHandler:function(t){t.preventDefault(),e.$form.submit()}}),Object(o.a)("".concat(r.message," ").concat(r.service_response),"alert",document,n)):e.$form.submit();e.toggleSubmitBtnState(!1)}).catch(function(){Object(o.a)("Something went wrong on our end."),e.toggleSubmitBtnState(!1)})}}])&&s(e.prototype,n),r&&s(e,r),t}(),u=n(5),l=n.n(u),d=n(1),h="empty",f="loading",p="list",m=n(13);function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var v=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backOffRequestCounter=0,this.$wrapper=i()(e),this.$monitoredMetricsPanel=this.$wrapper.find(".js-panel-monitored-metrics"),this.$monitoredMetricsCount=this.$monitoredMetricsPanel.find(".js-monitored-count"),this.$monitoredMetricsLoading=this.$monitoredMetricsPanel.find(".js-loading-metrics"),this.$monitoredMetricsEmpty=this.$monitoredMetricsPanel.find(".js-empty-metrics"),this.$monitoredMetricsList=this.$monitoredMetricsPanel.find(".js-metrics-list"),this.$missingEnvVarPanel=this.$wrapper.find(".js-panel-missing-env-vars"),this.$panelToggle=this.$missingEnvVarPanel.find(".js-panel-toggle"),this.$missingEnvVarMetricCount=this.$missingEnvVarPanel.find(".js-env-var-count"),this.$missingEnvVarMetricsList=this.$missingEnvVarPanel.find(".js-missing-var-metrics-list"),this.activeMetricsEndpoint=this.$monitoredMetricsPanel.data("activeMetrics"),this.helpMetricsPath=this.$monitoredMetricsPanel.data("metrics-help-path"),this.$panelToggle.on("click",function(t){return n.handlePanelToggle(t)})}var e,n,r;return e=t,(n=[{key:"handlePanelToggle",value:function(t){var e=i()(t.currentTarget);e.closest(".card").find(".card-body").toggleClass("hidden"),e.hasClass("fa-caret-down")?e.removeClass("fa-caret-down").addClass("fa-caret-right"):e.removeClass("fa-caret-right").addClass("fa-caret-down")}},{key:"showMonitoringMetricsPanelState",value:function(t){switch(t){case f:this.$monitoredMetricsLoading.removeClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.addClass("hidden");break;case p:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.addClass("hidden"),this.$monitoredMetricsList.removeClass("hidden");break;default:this.$monitoredMetricsLoading.addClass("hidden"),this.$monitoredMetricsEmpty.removeClass("hidden"),this.$monitoredMetricsList.addClass("hidden")}}},{key:"populateActiveMetrics",value:function(t){var e=this,n=0,r=0,i=0;if(t.forEach(function(t){t.active_metrics>0&&(i+=1,e.$monitoredMetricsList.append("<li>".concat(l.a.escape(t.group),'<span class="badge">').concat(l.a.escape(t.active_metrics),"</span></li>")),n+=t.active_metrics,t.metrics_missing_requirements>0&&(e.$missingEnvVarMetricsList.append("<li>".concat(l.a.escape(t.group),"</li>")),r+=1))}),0===n){var a=Object(d.f)(Object(d.e)('PrometheusService|<p class="text-tertiary">No <a href="%{docsUrl}">common metrics</a> were found</p>'),{docsUrl:this.helpMetricsPath},!1);this.$monitoredMetricsEmpty.empty(),this.$monitoredMetricsEmpty.append(a),this.showMonitoringMetricsPanelState(h)}else{var o=Object(d.f)(Object(d.e)("PrometheusService|%{exporters} with %{metrics} were found"),{exporters:Object(d.d)("%d exporter","%d exporters",i),metrics:Object(d.d)("%d metric","%d metrics",n)});this.$monitoredMetricsCount.text(o),this.showMonitoringMetricsPanelState(p),r>0&&(this.$missingEnvVarPanel.removeClass("hidden"),this.$missingEnvVarMetricCount.text(r))}}},{key:"loadActiveMetrics",value:function(){var t=this;this.showMonitoringMetricsPanelState(f),Object(m.d)(function(e,n){a.a.get(t.activeMetricsEndpoint).then(function(r){var i=r.data;i&&i.success?n(i):(t.backOffRequestCounter+=1,t.backOffRequestCounter<3?e():n(i))}).catch(n)}).then(function(e){e&&e.data&&e.data.length?t.populateActiveMetrics(e.data):t.showMonitoringMetricsPanelState(h)}).catch(function(){t.showMonitoringMetricsPanelState(h)})}}])&&g(e.prototype,n),r&&g(e,r),t}();document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".js-prometheus-metrics-monitoring");(new c(".js-integration-settings-form").init(),t)&&new v(".js-prometheus-metrics-monitoring").loadActiveMetrics()})},27:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var r=n(2),i=n.n(r),a=n(4),o=n(43);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=c(this,u(e).call(this)),i.a.bind("g p",function(){return Object(a.a)(".shortcuts-project")}),i.a.bind("g v",function(){return Object(a.a)(".shortcuts-project-activity")}),i.a.bind("g r",function(){return Object(a.a)(".shortcuts-project-releases")}),i.a.bind("g f",function(){return Object(a.a)(".shortcuts-tree")}),i.a.bind("g c",function(){return Object(a.a)(".shortcuts-commits")}),i.a.bind("g j",function(){return Object(a.a)(".shortcuts-builds")}),i.a.bind("g n",function(){return Object(a.a)(".shortcuts-network")}),i.a.bind("g d",function(){return Object(a.a)(".shortcuts-repository-charts")}),i.a.bind("g i",function(){return Object(a.a)(".shortcuts-issues")}),i.a.bind("g b",function(){return Object(a.a)(".shortcuts-issue-boards")}),i.a.bind("g m",function(){return Object(a.a)(".shortcuts-merge_requests")}),i.a.bind("g w",function(){return Object(a.a)(".shortcuts-wiki")}),i.a.bind("g s",function(){return Object(a.a)(".shortcuts-snippets")}),i.a.bind("g k",function(){return Object(a.a)(".shortcuts-kubernetes")}),i.a.bind("g e",function(){return Object(a.a)(".shortcuts-environments")}),i.a.bind("g l",function(){return Object(a.a)(".shortcuts-metrics")}),i.a.bind("i",function(){return Object(a.a)(".shortcuts-new-issue")}),t.enabledHelp.push(".hidden-shortcut.project"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,o["a"]),e}()},28:function(t,e,n){"use strict";var r=n(0),i=n.n(r),a=n(12),o=n(31);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.projectSelectInput=i()(e),this.newItemBtn=i()(".new-project-item-link"),this.resourceType=this.newItemBtn.data("type"),this.resourceLabel=this.newItemBtn.data("label"),this.formattedText=this.deriveTextVariants(),this.groupId=this.projectSelectInput.data("groupId"),this.bindEvents(),this.initLocalStorage()}var e,n,r;return e=t,(n=[{key:"bindEvents",value:function(){var t=this;this.projectSelectInput.siblings(".new-project-item-select-button").on("click",function(e){return t.openDropdown(e)}),this.newItemBtn.on("click",function(e){t.getProjectFromLocalStorage()||(e.preventDefault(),t.openDropdown(e))}),this.projectSelectInput.on("change",function(){return t.selectProject()})}},{key:"initLocalStorage",value:function(){o.a.isLocalStorageAccessSafe()&&(this.localStorageKey=["group",this.groupId,this.formattedText.localStorageItemType,"recent-project"].join("-"),this.setBtnTextFromLocalStorage())}},{key:"openDropdown",value:function(t){i()(t.currentTarget).siblings(".project-item-select").select2("open")}},{key:"selectProject",value:function(){var t=JSON.parse(this.projectSelectInput.val()),e={url:"".concat(t.url,"/").concat(this.projectSelectInput.data("relativePath")),name:t.name};this.setNewItemBtnAttributes(e),this.setProjectInLocalStorage(e)}},{key:"setBtnTextFromLocalStorage",value:function(){var t=this.getProjectFromLocalStorage();this.setNewItemBtnAttributes(t)}},{key:"setNewItemBtnAttributes",value:function(t){t?(this.newItemBtn.attr("href",t.url),this.newItemBtn.text("".concat(this.formattedText.defaultTextPrefix," in ").concat(t.name))):this.newItemBtn.text("Select project to create ".concat(this.formattedText.presetTextSuffix))}},{key:"getProjectFromLocalStorage",value:function(){var t=localStorage.getItem(this.localStorageKey);return JSON.parse(t)}},{key:"setProjectInLocalStorage",value:function(t){var e=JSON.stringify(t);localStorage.setItem(this.localStorageKey,e)}},{key:"deriveTextVariants",value:function(){var t=this.resourceLabel;return{localStorageItemType:"new-".concat(this.resourceType.split("_").join("-").slice(0,-1)),defaultTextPrefix:t,presetTextSuffix:this.resourceType.split("_").join(" ").slice(0,-1)}}}])&&s(e.prototype,n),r&&s(e,r),t}();function u(){i()(".ajax-project-select").each(function(t,e){var n,r,o=i()(e).data("simpleFilter")||!1;return this.groupId=i()(e).data("groupId"),this.includeGroups=i()(e).data("includeGroups"),this.allProjects=i()(e).data("allProjects")||!1,this.orderBy=i()(e).data("orderBy")||"id",this.withIssuesEnabled=i()(e).data("withIssuesEnabled"),this.withMergeRequestsEnabled=i()(e).data("withMergeRequestsEnabled"),this.withShared=void 0===i()(e).data("withShared")||i()(e).data("withShared"),this.includeProjectsInSubgroups=i()(e).data("includeProjectsInSubgroups")||!1,this.allowClear=i()(e).data("allowClear")||!1,n="Search for project",this.includeGroups&&(n+=" or group"),i()(e).select2({placeholder:n,minimumInputLength:0,query:(r=this,function(t){var e,n;return e=function(e){var n;return n={results:e},t.callback(n)},n=r.includeGroups?function(n){var r;return r=function(t){var r;return r=t.concat(n),e(r)},a.a.groups(t.term,{},r)}:e,r.groupId?a.a.groupProjects(r.groupId,t.term,{with_issues_enabled:r.withIssuesEnabled,with_merge_requests_enabled:r.withMergeRequestsEnabled,with_shared:r.withShared,include_subgroups:r.includeProjectsInSubgroups},n):a.a.projects(t.term,{order_by:r.orderBy,with_issues_enabled:r.withIssuesEnabled,with_merge_requests_enabled:r.withMergeRequestsEnabled,membership:!r.allProjects},n)}),id:function(t){return o?t.id:JSON.stringify({name:t.name,url:t.web_url})},text:function(t){return t.name_with_namespace||t.name},initSelection:function(t,e){return a.a.project(t.val()).then(function(t){var n=t.data;return e(n)})},allowClear:this.allowClear,dropdownCssClass:"ajax-project-dropdown"}),o?e:new c(e)})}n.d(e,"a",function(){return u})},29:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n(0),i=n.n(r),a=n(14),o=n.n(a),s=n(1),c=n(19),u=n(6),l=n(7),d=n(28);function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=i()("ul.clone-options-dropdown"),n=i()("#project_clone"),r=i()(".js-git-clone-holder .js-clone-dropdown-label"),a=document.querySelector(".js-mobile-git-clone .js-clone-dropdown-label"),s=r.text().trim();s.length>0&&i()("a:contains('".concat(s,"')"),e).addClass("is-active"),i()("a",e).on("click",function(t){t.preventDefault();var r=i()(t.currentTarget),o=r.attr("href"),s=r.data("cloneType");i()(".is-active",e).removeClass("is-active"),i()('a[data-clone-type="'.concat(s,'"]')).each(function(){var t=i()(this),e=t.find(".dropdown-menu-inner-title").text(),n=t.closest(".project-clone-holder").find(".js-clone-dropdown-label");t.toggleClass("is-active"),n.text(e)}),a?a.dataset.clipboardText=o:n.val(o),i()(".js-git-empty .js-clone").text(o)}),t.initRefSwitcher(),i()(".project-refs-select").on("change",function(){return i()(this).parents("form").submit()}),i()(".hide-no-ssh-message").on("click",function(t){return o.a.set("hide_no_ssh_message","false"),i()(this).parents(".no-ssh-key-message").remove(),t.preventDefault()}),i()(".hide-no-password-message").on("click",function(t){return o.a.set("hide_no_password_message","false"),i()(this).parents(".no-password-message").remove(),t.preventDefault()}),i()(".hide-auto-devops-implicitly-enabled-banner").on("click",function(t){var e=i()(this).data("project-id"),n="hide_auto_devops_implicitly_enabled_banner_".concat(e);return o.a.set(n,"false"),i()(this).parents(".auto-devops-implicitly-enabled-banner").remove(),t.preventDefault()}),t.projectSelectDropdown()}var e,n,r;return e=t,r=[{key:"projectSelectDropdown",value:function(){Object(d.a)(),i()(".project-item-select").on("click",function(e){return t.changeProject(i()(e.currentTarget).val())})}},{key:"changeProject",value:function(t){return window.location=t}},{key:"initRefSwitcher",value:function(){var t=document.createElement("li"),e=document.createElement("a");return e.href="#",i()(".js-project-refs-dropdown").each(function(){var n,r;return n=i()(this),r=n.data("selected"),n.glDropdown({data:function(t,e){u.a.get(n.data("refsUrl"),{params:{ref:n.data("ref"),search:t}}).then(function(t){var n=t.data;return e(n)}).catch(function(){return Object(l.a)(Object(s.a)("An error occurred while getting projects"))})},selectable:!0,filterable:!0,filterRemote:!0,filterByText:!0,inputFieldName:n.data("inputFieldName"),fieldName:n.data("fieldName"),renderRow:function(n){var i=t.cloneNode(!1);if(null!=n.header)i.className="dropdown-header",i.textContent=n.header;else{var a=e.cloneNode(!1);n===r&&(a.className="is-active"),a.textContent=n,a.dataset.ref=n,i.appendChild(a)}return i},id:function(t,e){return e.attr("data-ref")},toggleLabel:function(t,e){return e.text().trim()},clicked:function(t){if(t.e.preventDefault(),i()('input[name="ref"]').length){var e=n.closest("form"),r=n.data("visit"),a=!!r||r,o=e.attr("action"),s=-1===o.indexOf("?")?"?":"&";a&&Object(c.g)("".concat(o).concat(s).concat(e.serialize()))}}})})}}],(n=null)&&h(e.prototype,n),r&&h(e,r),t}()},44:function(t,e,n){"use strict";n.r(e);var r=n(38),i=n(36),a=n(29),o=n(27);document.addEventListener("DOMContentLoaded",function(){var t=document.body.dataset.page;if(["projects:clusters:new","projects:clusters:create_gcp","projects:clusters:create_user"].indexOf(t)>-1){var e=document.querySelector(".gcp-signup-offer");e&&new i.a(e),Object(r.a)()}new a.a,new o.a})}},[[1362,1,0,2]]]);
//# sourceMappingURL=pages.projects.services.edit.44dbb227.chunk.js.map