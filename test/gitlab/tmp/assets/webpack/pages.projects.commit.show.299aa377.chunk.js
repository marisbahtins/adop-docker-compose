(this.webpackJsonp=this.webpackJsonp||[]).push([[108,22],{109:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(31);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.field=t,this.isLocalStorageAvailable=i.a.isLocalStorageAccessSafe(),null!=n.join&&(n=n.join("/")),this.key="autosave/"+n,this.field.data("autosave",this),this.restore(),this.field.on("input",function(){return o.save()})}var t,n,s;return t=e,(n=[{key:"restore",value:function(){if(this.isLocalStorageAvailable&&this.field.length){var e=window.localStorage.getItem(this.key);(null!=e?e.length:void 0)>0&&this.field.val(e),this.field.trigger("input");var t=new Event("change",{bubbles:!0,cancelable:!1}),n=this.field.get(0);n&&n.dispatchEvent(t)}}},{key:"save",value:function(){if(this.field.length){var e=this.field.val();return this.isLocalStorageAvailable&&(null!=e?e.length:void 0)>0?window.localStorage.setItem(this.key,e):this.reset()}}},{key:"reset",value:function(){if(this.isLocalStorageAvailable)return window.localStorage.removeItem(this.key)}},{key:"dispose",value:function(){this.field.off("input")}}])&&o(t.prototype,n),s&&o(t,s),e}()},111:function(e,t){Mousetrap=function(e){var t=e,n=t.stopCallback,i=!0;return t.stopCallback=function(e,t,o){return!i||n(e,t,o)},t.pause=function(){i=!1},t.unpause=function(){i=!0},t}(Mousetrap)},1236:function(e,t,n){n(42),n(44),e.exports=n(1406)},1237:function(e,t){window.NoteModel=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.discussionId=t,this.id=n.noteId,this.canResolve=n.canResolve,this.resolved=n.resolved,this.resolved_by=n.resolvedBy,this.authorName=n.authorName,this.authorAvatar=n.authorAvatar,this.noteTruncated=n.noteTruncated}},125:function(e,t,n){"use strict";function i(e,t){var n=t.x,i=t.y,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=document.createElement("button");return o.concat(["js-image-badge"]).forEach(function(e){return s.classList.add(e)}),s.setAttribute("type","button"),s.setAttribute("disabled",!0),s.dataset.noteId=e,s.style.left="".concat(n,"px"),s.style.top="".concat(i,"px"),s}function o(e,t){var n=t.x,i=t.y,o=document.createElement("button");o.classList.add("btn-transparent"),o.classList.add("comment-indicator"),o.setAttribute("type","button"),o.style.left="".concat(n,"px"),o.style.top="".concat(i,"px"),o.innerHTML=gl.utils.spriteIcon("image-comment-dark"),e.appendChild(o)}var s={x:0,y:0,width:0,height:0},a=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.noteId,i=t.discussionId;this.actual=t.actual||s,this.browser=t.browser||s,this.noteId=n,this.discussionId=i,t.imageEl&&!t.browser&&(this.browser=T.resizeCoordinatesToImageElement(t.imageEl,this.actual))},r=n(0),c=n.n(r);function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t,this.canCreateNote=!(!n||!n.canCreateNote),this.renderCommentBadge=!(!n||!n.renderCommentBadge),this.$noteContainer=c()(".note-container",this.el),this.imageBadges=[]}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.imageFrameEl=this.el.querySelector(".diff-file .js-image-frame"),this.imageEl=this.imageFrameEl.querySelector("img"),this.bindEvents()}},{key:"bindEvents",value:function(){var e;this.imageClickedWrapper=this.imageClicked.bind(this),this.imageBlurredWrapper=T.removeCommentIndicator.bind(null,this.imageFrameEl),this.addBadgeWrapper=this.addBadge.bind(this),this.removeBadgeWrapper=this.removeBadge.bind(this),this.renderBadgesWrapper=this.renderBadges.bind(this),(e=this.imageEl).complete&&0!==e.naturalHeight?this.renderBadges():this.imageEl.addEventListener("load",this.renderBadgesWrapper),this.$noteContainer.on("click",".js-diff-notes-toggle",T.toggleCollapsed),c()(this.el).on("click",".comment-indicator",T.commentIndicatorOnClick),this.canCreateNote&&(this.el.addEventListener("click.imageDiff",this.imageClickedWrapper),this.el.addEventListener("blur.imageDiff",this.imageBlurredWrapper),this.el.addEventListener("addBadge.imageDiff",this.addBadgeWrapper),this.el.addEventListener("removeBadge.imageDiff",this.removeBadgeWrapper))}},{key:"imageClicked",value:function(e){var t=e.detail,n=T.getTargetSelection(t),i=t.currentTarget;T.setPositionDataAttribute(i,n.actual),T.showCommentIndicator(this.imageFrameEl,n.browser)}},{key:"renderBadges",value:function(){l(this.el.querySelectorAll(".note-container .discussion-notes .notes")).forEach(this.renderBadge.bind(this))}},{key:"renderBadge",value:function(e,t){var n=T.generateBadgeFromDiscussionDOM(this.imageFrameEl,e);this.imageBadges.push(n);var i={coordinate:n.browser,noteId:n.noteId};if(this.renderCommentBadge)T.addImageCommentBadge(this.imageFrameEl,i);else{var o=Object.assign({},i,{badgeText:t+1});T.addImageBadge(this.imageFrameEl,o)}}},{key:"addBadge",value:function(e){var t=e.detail,n=t.x,i=t.y,o=t.width,s=t.height,r=t.noteId,c=t.discussionId,l=this.imageBadges.length+1,d=new a({actual:{x:n,y:i,width:o,height:s},imageEl:this.imageFrameEl.querySelector("img"),noteId:r,discussionId:c});this.imageBadges.push(d),T.addImageBadge(this.imageFrameEl,{coordinate:d.browser,badgeText:l,noteId:r}),T.addAvatarBadge(this.el,{detail:{noteId:r,badgeNumber:l}});var u=this.el.querySelector("#discussion_".concat(c));T.updateDiscussionBadgeNumber(u,l)}},{key:"removeBadge",value:function(e){var t=this,n=e.detail.badgeNumber,i=n-1,o=this.imageFrameEl.querySelectorAll(".badge");this.imageBadges.length!==n&&this.imageBadges.forEach(function(e,n){if(n>i){var s=e.discussionId,a=n,r=t.el.querySelector("#discussion_".concat(s));o[n].innerText=a,T.updateDiscussionBadgeNumber(r,a),T.updateDiscussionAvatarBadgeNumber(r,a)}}),this.imageBadges.splice(i,1),o[i].remove()}}])&&d(t.prototype,n),i&&d(t,i),e}(),f={TWO_UP:"TWO_UP",SWIPE:"SWIPE",ONION_SKIN:"ONION_SKIN"};function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,b(t).apply(this,arguments))}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,u),n=t,(i=[{key:"init",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.TWO_UP;this.imageFrameEls=(m(e={},f.TWO_UP,this.el.querySelector(".two-up .js-image-frame")),m(e,f.SWIPE,this.el.querySelector(".swipe .js-image-frame")),m(e,f.ONION_SKIN,this.el.querySelector(".onion-skin .js-image-frame")),e);var i=this.el.querySelector(".view-modes-menu");this.viewModesEls=(m(t={},f.TWO_UP,i.querySelector(".two-up")),m(t,f.SWIPE,i.querySelector(".swipe")),m(t,f.ONION_SKIN,i.querySelector(".onion-skin")),t),this.currentView=n,this.generateImageEls(),this.bindEvents()}},{key:"generateImageEls",value:function(){var e=this;this.imageEls={},Object.getOwnPropertyNames(f).forEach(function(t){e.imageEls[t]=e.imageFrameEls[t].querySelector("img")})}},{key:"bindEvents",value:function(){y(b(t.prototype),"bindEvents",this).call(this),this.changeToViewTwoUp=this.changeView.bind(this,f.TWO_UP),this.changeToViewSwipe=this.changeView.bind(this,f.SWIPE),this.changeToViewOnionSkin=this.changeView.bind(this,f.ONION_SKIN),this.viewModesEls[f.TWO_UP].addEventListener("click",this.changeToViewTwoUp),this.viewModesEls[f.SWIPE].addEventListener("click",this.changeToViewSwipe),this.viewModesEls[f.ONION_SKIN].addEventListener("click",this.changeToViewOnionSkin)}},{key:"changeView",value:function(e){if(t=e,Object.getOwnPropertyNames(f).find(function(e){return e===t})){var t,n=T.removeCommentIndicator(this.imageFrameEl);this.currentView=e,p(this.imageFrameEl.querySelectorAll(".badge")).map(function(e){return e.remove()}),this.imageBadges=[],setTimeout(this.renderNewView.bind(this,n),250)}}},{key:"renderNewView",value:function(e){if(this.renderBadges(),e.removed){var t=T.resizeCoordinatesToImageElement(this.imageEl,{x:e.x,y:e.y,width:e.image.width,height:e.image.height});T.showCommentIndicator(this.imageFrameEl,t)}}},{key:"imageEl",get:function(){return this.imageEls[this.currentView]}},{key:"imageFrameEl",get:function(){return this.imageFrameEls[this.currentView]}}])&&v(n.prototype,i),o&&v(n,o),t}();function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var _=900,x=["two-up","swipe"],E=function(){function e(t){var n,i,o,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o={"two-up":function(){return c()(".two-up.view .wrap",this.file).each((e=this,function(t,n){return c()("img",n).each(function(){if(c()(this).width()>_/2)return c()(this).width(_/2)}),e.requestImageInfo(c()("img",n),function(e,t){return c()(".image-info .meta-width",n).text(e+"px"),c()(".image-info .meta-height",n).text(t+"px"),c()(".image-info",n).removeClass("hide")})}));var e},swipe:function(){var e,t,n;return t=0,e=0,c()(".swipe.view",this.file).each((n=this,function(i,o){var s,a,r,l,d;s=C(n.prepareFrames(o),2),t=s[0],e=s[1],l=c()(".swipe-frame",o),a=c()(".swipe-wrap",o),r=c()(".swipe-bar",o),l.css({width:t+16,height:e+28}),a.css({width:t+1,height:e+2}),r.css({left:1}),d=parseInt(a.css("right").replace("px",""),10),n.initDraggable(r,d,function(e,n){n>0&&n<l.width()-2*d&&(a.width(t+1-n),r.css("left",n))})}))},"onion-skin":function(){var e,t,n,i;return n=0,t=0,e=c()(".drag-track",this.file).width()-c()(".dragger",this.file).width(),c()(".onion-skin.view",this.file).each((i=this,function(o,s){var a,r,l,d,u,f;a=C(i.prepareFrames(s),2),n=a[0],t=a[1],r=c()(".onion-skin-frame",s),u=c()(".frame.added",s),l=c()(".drag-track",s),d=c()(".dragger",l),r.css({width:n+16,height:t+28}),c()(".swipe-wrap",s).css({width:n+1,height:t+2}),d.css({left:e}),u.css("opacity",1),f=parseInt(u.css("right").replace("px",""),10),i.initDraggable(d,f,function(t,n){var i=n/e;i>=0&&i<=1&&(d.css("left",n),u.css("opacity",i))})}))}},(i="views")in(n=this)?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,this.file=t,this.requestImageInfo(c()(".two-up.view .frame.deleted img",this.file),(s=this,function(e,t){return s.requestImageInfo(c()(".two-up.view .frame.added img",s.file),function(e,t){s.initViewModes(),c()(".two-up.view img",s.file).waitForImages(function(){s.initView("two-up")})})}))}var t,n,i;return t=e,(n=[{key:"initViewModes",value:function(){var e,t=x[0];return c()(".view-modes",this.file).removeClass("hide"),c()(".view-modes-menu",this.file).on("click","li",(e=this,function(t){if(!c()(t.currentTarget).hasClass("active"))return e.activateViewMode(t.currentTarget.className)})),this.activateViewMode(t)}},{key:"activateViewMode",value:function(e){return c()(".view-modes-menu li",this.file).removeClass("active").filter("."+e).addClass("active"),c()(".view:visible:not(."+e+")",this.file).fadeOut(200,(t=this,function(){return c()(".view."+e,t.file).fadeIn(200),t.initView(e)}));var t}},{key:"initView",value:function(e){return this.views[e].call(this)}},{key:"initDraggable",value:function(e,t,n){var i=!1,o=c()("body"),s=e.parent();e.off("mousedown").on("mousedown",function(){i=!0,o.css("user-select","none")}),o.off("mouseup").off("mousemove").on("mouseup",function(){i=!1,o.css("user-select","")}).on("mousemove",function(e){var o;i&&(o=e.pageX-(s.offset().left+t),n(e,o))})}},{key:"prepareFrames",value:function(e){var t,n;return n=0,t=0,c()(".frame",e).each(function(e,i){var o,s;return s=c()(i).width(),o=c()(i).height(),n=s>n?s:n,t=o>t?o:t}).css({width:n,height:t}),[n,t]}},{key:"requestImageInfo",value:function(e,t){var n,i=e.get(0);if(i)return i.complete?t.call(this,i.naturalWidth,i.naturalHeight):e.on("load",(n=this,function(){return t.call(n,i.naturalWidth,i.naturalHeight)}))}}])&&j(t.prototype,n),i&&j(t,i),e}();var T=t.a={addCommentIndicator:o,removeCommentIndicator:function(e){var t=e.querySelector(".comment-indicator"),n=e.querySelector("img"),i=!!t,o={};return i&&(o={x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),image:{width:n.width,height:n.height}},t.remove()),Object.assign({},o,{removed:i})},showCommentIndicator:function(e,t){var n=t.x,i=t.y,s=e.querySelector(".comment-indicator");s?(s.style.left="".concat(n,"px"),s.style.top="".concat(i,"px")):o(e,t)},commentIndicatorOnClick:function(e){e.stopPropagation(),e.currentTarget.closest(".diff-viewer").querySelector(".note-container .note-textarea").focus()},addImageBadge:function(e,t){var n=t.coordinate,o=t.badgeText,s=i(t.noteId,n,["badge","badge-pill"]);s.innerText=o,e.appendChild(s)},addImageCommentBadge:function(e,t){var n=t.coordinate,o=i(t.noteId,n,["image-comment-badge"]);o.innerHTML=gl.utils.spriteIcon("image-comment-dark"),e.appendChild(o)},addAvatarBadge:function(e,t){var n=t.detail,i=n.noteId,o=n.badgeNumber,s=e.querySelector("#".concat(i," .badge"));s.innerText=o,s.classList.remove("hidden")},setPositionDataAttribute:function(e,t){var n=t.x,i=t.y,o=t.width,s=t.height,a=e.dataset.position,r=Object.assign({},JSON.parse(a),{x:n,y:i,width:o,height:s});e.setAttribute("data-position",JSON.stringify(r))},updateDiscussionAvatarBadgeNumber:function(e,t){e.querySelector(".image-diff-avatar-link .badge").innerText=t},updateDiscussionBadgeNumber:function(e,t){e.querySelector(".badge").innerText=t},toggleCollapsed:function(e){var t=e.currentTarget.closest(".discussion-notes"),n=t.querySelector(".discussion-form"),i=t.classList.contains("collapsed");i?t.classList.remove("collapsed"):t.classList.add("collapsed"),n&&!i?n.style.display="none":n&&i&&(n.style.display="block")},resizeCoordinatesToImageElement:function(e,t){var n=t.x,i=t.y,o=t.width,s=t.height,a=e.width,r=e.height,c=a/o,l=r/s;return{x:Math.round(n*c),y:Math.round(i*l),width:a,height:r}},generateBadgeFromDiscussionDOM:function(e,t){var n=JSON.parse(t.dataset.position),i=t.querySelector(".note");return new a({actual:n,imageEl:e.querySelector("img"),noteId:i.id,discussionId:t.dataset.discussionId})},getTargetSelection:function(e){var t=e.currentTarget.querySelector("img"),n=e.offsetX,i=e.offsetY,o=t.width,s=t.height,a=t.naturalWidth,r=t.naturalHeight,c=a/o,l=r/s,d=Math.max(0,n)&&Math.min(n,o),u=Math.max(0,i)&&Math.min(i,s);return{browser:{x:d,y:u,width:o,height:s},actual:{x:Math.round(d*c),y:Math.round(u*l),width:a,height:r}}},initImageDiff:function(e,t,n){var i,o={canCreateNote:t,renderCommentBadge:n};return new E(e),e.querySelector(".diff-file .js-single-image")?(i=new u(e,o)).init():e.querySelector(".diff-file .js-replaced-image")&&(i=new k(e,o)).init(),i}}},1406:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),s=n(196),a=n(85),r=n(27),c=n(485),l=n(360),d=n(295),u=n(11),f=n(20);function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t,this.notes={},this.loading=!1,this.canResolve=!1}var t,n,i;return t=e,(n=[{key:"createNote",value:function(e){u.default.set(this.notes,e.noteId,new NoteModel(this.id,e))}},{key:"deleteNote",value:function(e){u.default.delete(this.notes,e)}},{key:"getNote",value:function(e){return this.notes[e]}},{key:"notesCount",value:function(){return Object.keys(this.notes).length}},{key:"isResolved",value:function(){for(var e in this.notes){if(!this.notes[e].resolved)return!1}return!0}},{key:"resolveAllNotes",value:function(e){for(var t in this.notes){var n=this.notes[t];n.resolved||(n.resolved=!0,n.resolved_by=e)}}},{key:"unResolveAllNotes",value:function(){for(var e in this.notes){var t=this.notes[e];t.resolved&&(t.resolved=!1,t.resolved_by=null)}}},{key:"updateHeadline",value:function(e){var t='.discussion[data-discussion-id="'.concat(this.id,'"]'),n=o()("".concat(t," .js-discussion-headline"));e.discussion_headline_html?(n.length?n.replaceWith(e.discussion_headline_html):o()("".concat(t," .discussion-header")).append(e.discussion_headline_html),Object(f.i)(o()(".js-timeago","".concat(t)))):n.remove()}},{key:"isResolvable",value:function(){if(!this.canResolve)return!1;for(var e in this.notes){if(this.notes[e].canResolve)return!0}return!1}}])&&h(t.prototype,n),i&&h(t,i),e}();window.DiscussionModel=p;n(1237);window.CommentsStore={state:{},get:function(e,t){return this.state[e].getNote(t)},createDiscussion:function(e,t){var n=this.state[e];return this.state[e]||(n=new DiscussionModel(e),u.default.set(this.state,e,n)),void 0!==t&&(n.canResolve=t),n},create:function(e){this.createDiscussion(e.discussionId).createNote(e)},update:function(e,t,n,i){var o=this.state[e].getNote(t);o.resolved=n,o.resolved_by=i},delete:function(e,t){var n=this.state[e];n.deleteNote(t),0===n.notesCount()&&u.default.delete(this.state,e)},unresolvedDiscussionIds:function(){var e=[];for(var t in this.state){var n=this.state[t];n.isResolved()||e.push(n.id)}return e}};var m=n(7);n(412);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}window.gl=window.gl||{};var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.noteResource=u.default.resource("".concat(t,"/notes{/noteId}/resolve?html=true")),this.discussionResource=u.default.resource("".concat(t,"/merge_requests{/mergeRequestId}/discussions{/discussionId}/resolve?html=true"))}var t,n,i;return t=e,(n=[{key:"resolve",value:function(e){return this.noteResource.save({noteId:e},{})}},{key:"unresolve",value:function(e){return this.noteResource.delete({noteId:e},{})}},{key:"toggleResolveForDiscussion",value:function(e,t){var n=CommentsStore.state[t],i=n.isResolved();(i?this.unResolveAll(e,t):this.resolveAll(e,t)).then(function(e){return e.json()}).then(function(e){n.loading=!1;var t=e?e.resolved_by:null;i?n.unResolveAllNotes():n.resolveAllNotes(t),gl.mrWidget&&gl.mrWidget.checkStatus(),n.updateHeadline(e)}).catch(function(){return new m.a("An error occurred when trying to resolve a discussion. Please try again.")})}},{key:"resolveAll",value:function(e,t){return CommentsStore.state[t].loading=!0,this.discussionResource.save({mergeRequestId:e,discussionId:t},{})}},{key:"unResolveAll",value:function(e,t){return CommentsStore.state[t].loading=!0,this.discussionResource.delete({mergeRequestId:e,discussionId:t},{})}}])&&v(t.prototype,n),i&&v(t,i),e}();gl.DiffNotesResolveServiceClass=g;var y={computed:{discussionCount:function(){return Object.keys(this.discussions).length},resolvedDiscussionCount:function(){var e=0;for(var t in this.discussions){this.discussions[t].isResolved()&&(e+=1)}return e},unresolvedDiscussionCount:function(){var e=0;for(var t in this.discussions){this.discussions[t].isResolved()||(e+=1)}return e}}},b=u.default.extend({props:{discussionId:{type:String,required:!0}},data:function(){return{textareaIsEmpty:!0,discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?this.textareaIsEmpty?"Unresolve discussion":"Comment & unresolve discussion":this.textareaIsEmpty?"Resolve discussion":"Comment & resolve discussion"}},created:function(){this.discussionId&&(this.discussion=CommentsStore.state[this.discussionId])},mounted:function(){var e=this;if(this.discussionId){var t=o()(".js-discussion-note-form[data-discussion-id=".concat(this.discussionId,"] .note-textarea"));this.textareaIsEmpty=""===t.val(),t.on("input.comment-and-resolve-btn",function(){e.textareaIsEmpty=""===t.val()})}},destroyed:function(){this.discussionId&&o()(".js-discussion-note-form[data-discussion-id=".concat(this.discussionId,"] .note-textarea")).off("input.comment-and-resolve-btn")}});u.default.component("comment-and-resolve-btn",b);var w=u.default.extend({mixins:[y],props:{discussionId:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state,discussion:{}}},computed:{buttonText:function(){return this.discussionId?"Jump to next unresolved discussion":"Jump to first unresolved discussion"},allResolved:function(){return 0===this.unresolvedDiscussionCount},showButton:function(){return this.discussionId?this.unresolvedDiscussionCount>1||this.discussionId!==this.lastResolvedId:this.unresolvedDiscussionCount>=1},lastResolvedId:function(){var e;for(var t in this.discussions){var n=this.discussions[t];n.isResolved()||(e=n.id)}return e}},created:function(){this.discussion=this.discussions[this.discussionId]},methods:{jumpToNextUnresolvedDiscussion:function(){var e,t,n,i,s=window.mrTabs.currentAction,a=!0,r=!this.discussionId,c=function(e){return e.map(function(){return o()(this).attr("data-discussion-id")}).toArray()},l=this.discussions;if("diffs"===s){e=".diffs .notes[data-discussion-id]",t=c(o()(e));for(var d=0,u=0;u<t.length;u+=1){var f=l[t[u]];f&&!f.isResolved()&&(d+=1)}this.discussionId&&!this.discussion.isResolved()?1===d&&(a=!1):0===d&&(a=!1)}else"show"!==s&&(a=!1);a||(window.mrTabs.activateTab("show"),s="show",r=!0),"show"===s&&(e=".discussion[data-discussion-id]",t=c(o()(e)));for(var h=!1,p=0;p<t.length;p+=1){var m=t[p],v=l[m];if(v){if(!n&&!v.isResolved()&&(n=m,r))break;if(!r){if(h){if(v.isResolved())continue;i=m;break}m===this.discussionId&&(h=!0)}}}if(i=i||n){var g=o()("".concat(e,'[data-discussion-id="').concat(i,'"]'));if("show"===s)(g=g.closest(".note-discussion")).find(".js-toggle-content").is(":hidden")&&g.find(".js-toggle-button i").trigger("click");else if("diffs"===s){g.closest(".content").show();var y,b=g.closest("tr.notes_holder");b.length>0&&(g=b),g.show();for(var w=0;w<4&&(y=g.prev()).hasClass("line_holder");w+=1)g=y}o.a.scrollTo(g,{offset:-150})}}}});u.default.component("jump-to-discussion",w);var k=u.default.extend({props:{noteId:{type:Number,required:!0},discussionId:{type:String,required:!0},resolved:{type:Boolean,required:!0},canResolve:{type:Boolean,required:!0},resolvedBy:{type:String,required:!0},authorName:{type:String,required:!0},authorAvatar:{type:String,required:!0},noteTruncated:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state,loading:!1}},computed:{discussion:function(){return this.discussions[this.discussionId]},note:function(){return this.discussion?this.discussion.getNote(this.noteId):{}},buttonText:function(){return this.isResolved?"Resolved by ".concat(this.resolvedByName):this.canResolve?"Mark as resolved":"Unable to resolve"},isResolved:function(){return!!this.note&&this.note.resolved},resolvedByName:function(){return this.note.resolved_by}},watch:{discussions:{handler:"updateTooltip",deep:!0}},mounted:function(){o()(this.$refs.button).tooltip({container:"body"})},beforeDestroy:function(){CommentsStore.delete(this.discussionId,this.noteId)},created:function(){CommentsStore.create({discussionId:this.discussionId,noteId:this.noteId,canResolve:this.canResolve,resolved:this.resolved,resolvedBy:this.resolvedBy,authorName:this.authorName,authorAvatar:this.authorAvatar,noteTruncated:this.noteTruncated})},methods:{updateTooltip:function(){var e=this;this.$nextTick(function(){o()(e.$refs.button).tooltip("hide").tooltip("_fixTitle")})},resolve:function(){var e=this;this.canResolve&&(this.loading=!0,(this.isResolved?ResolveService.unresolve(this.noteId):ResolveService.resolve(this.noteId)).then(function(e){return e.json()}).then(function(t){e.loading=!1;var n=t?t.resolved_by:null;CommentsStore.update(e.discussionId,e.noteId,!e.isResolved,n),e.discussion.updateHeadline(t),gl.mrWidget.checkStatus(),e.updateTooltip()}).catch(function(){return new m.a("An error occurred when trying to resolve a comment. Please try again.")}))}}});u.default.component("resolve-btn",k),window.ResolveCount=u.default.extend({mixins:[y],props:{loggedOut:{type:Boolean,required:!0}},data:function(){return{discussions:CommentsStore.state}},computed:{allResolved:function(){return this.resolvedDiscussionCount===this.discussionCount},resolvedCountText:function(){return 1===this.discussionCount?"discussion":"discussions"}}});var C=u.default.extend({props:{discussionId:{type:String,required:!0},mergeRequestId:{type:Number,required:!0},canResolve:{type:Boolean,required:!0}},data:function(){return{discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return!!this.discussion&&this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?"Unresolve discussion":"Resolve discussion"},loading:function(){return!!this.discussion&&this.discussion.loading}},created:function(){CommentsStore.createDiscussion(this.discussionId,this.canResolve),this.discussion=CommentsStore.state[this.discussionId]},methods:{resolve:function(){ResolveService.toggleResolveForDiscussion(this.mergeRequestId,this.discussionId)}}});u.default.component("resolve-discussion-btn",C);var j=n(800),_=n.n(j),x=n(224),E=n(92),T=u.default.extend({components:{userAvatarImage:E.a},props:{discussionId:{type:String,required:!0}},data:function(){return{isVisible:!1,lineType:"",storeState:CommentsStore.state,shownAvatars:3,collapseIcon:_.a}},computed:{discussionClassName:function(){return"js-diff-avatars-".concat(this.discussionId)},notesSubset:function(){var e=this,t=[];return this.discussion&&(t=Object.keys(this.discussion.notes).slice(0,this.shownAvatars).map(function(t){return e.discussion.notes[t]})),t},extraNotesTitle:function(){if(this.discussion){var e=this.discussion.notesCount()-this.shownAvatars;return"".concat(e," more comment").concat(e>1?"s":"")}return""},discussion:function(){return this.storeState[this.discussionId]},notesCount:function(){return this.discussion?this.discussion.notesCount():0},moreText:function(){var e=this.notesCount<100?"+":"";return"".concat(e).concat(this.notesCount-this.shownAvatars)}},watch:{storeState:{handler:function(){var e=this;this.$nextTick(function(){o()(".has-tooltip",e.$el).tooltip("_fixTitle"),e.addNoCommentClass()})},deep:!0}},mounted:function(){var e=this;this.$nextTick(function(){e.addNoCommentClass(),e.setDiscussionVisible(),e.lineType=o()(e.$el).closest(".diff-line-num").hasClass("old_line")?"old":"new"}),o()(document).on("toggle.comments",function(){e.$nextTick(function(){e.setDiscussionVisible()})})},beforeDestroy:function(){this.addNoCommentClass(),o()(document).off("toggle.comments")},methods:{clickedAvatar:function(e){var t=this;x.a.instance.onAddDiffNote(e),this.toggleDiscussionsToggleState(),this.$nextTick(function(){t.setDiscussionVisible(),o()(".has-tooltip",t.$el).tooltip("_fixTitle"),o()(".has-tooltip",t.$el).tooltip("hide")})},addNoCommentClass:function(){var e=this.notesCount;o()(this.$el).closest(".js-avatar-container").toggleClass("no-comment-btn",e>0).nextUntil(".js-avatar-container").toggleClass("no-comment-btn",e>0)},toggleDiscussionsToggleState:function(){var e=o()(this.$el).closest(".code").find(".notes_holder"),t=e.filter(":visible");o()(this.$el).closest(".diff-file").find(".js-toggle-diff-comments").toggleClass("active",e.length===t.length)},setDiscussionVisible:function(){this.isVisible=o()('.diffs .notes[data-discussion-id="'.concat(this.discussion.id,'"]')).is(":visible")},getTooltipText:function(e){return"".concat(e.authorName,": ").concat(e.noteTruncated)}},template:'\n    <div class="diff-comment-avatar-holders"\n      :class="discussionClassName"\n      v-show="notesCount !== 0">\n      <div v-if="!isVisible">\n        \x3c!-- FIXME: Pass an alt attribute here for accessibility --\x3e\n        <user-avatar-image\n          v-for="note in notesSubset"\n          :key="note.id"\n          class="diff-comment-avatar js-diff-comment-avatar"\n          @click.native="clickedAvatar($event)"\n          :img-src="note.authorAvatar"\n          :tooltip-text="getTooltipText(note)"\n          :data-line-type="lineType"\n          :size="19"\n          data-html="true"\n        />\n        <span v-if="notesCount > shownAvatars"\n          class="diff-comments-more-count has-tooltip js-diff-comment-avatar"\n          data-container="body"\n          data-placement="top"\n          ref="extraComments"\n          role="button"\n          :data-line-type="lineType"\n          :title="extraNotesTitle"\n          @click="clickedAvatar($event)">{{ moreText }}</span>\n      </div>\n      <button class="diff-notes-collapse js-diff-comment-avatar"\n        type="button"\n        aria-label="Show comments"\n        :data-line-type="lineType"\n        @click="clickedAvatar($event)"\n        v-if="isVisible"\n        v-html="collapseIcon">\n      </button>\n    </div>\n  '});u.default.component("diff-note-avatars",T);var S=u.default.extend({props:{discussionId:{type:String,required:!0}},data:function(){return{discussions:CommentsStore.state}},computed:{discussion:function(){return this.discussions[this.discussionId]},showButton:function(){return!!this.discussion&&!this.discussion.isResolved()}}});u.default.component("new-issue-for-discussion-btn",S);var N=n(6),I=n(1);function D(e,t){var n=function(e,t){return 0===e?"".concat(t," ").concat(Object(I.d)("merge request","merge requests",t)):","}(e,t);return o()("<span />",{class:"append-right-5",text:n})}function O(e){var t=o()("<span />"),n=function(e){return o()("<a />",{class:"append-right-5",href:e.path,text:"!".concat(e.iid)})}(e),i=function(e){return o()("<span />",{text:e.title})}(e);return t.append(n),t.append(i),t}function A(){var e=o()(".merge-requests");N.a.get(e.data("projectCommitPath")).then(function(t){var n=function(e){var t=o()("<span />");return 0===e.length?t.text(Object(I.e)("Commits|No related merge requests found")):e.forEach(function(n){var i=D(t.children().length,e.length),o=O(n);t.append(i),t.append(o)}),t}(t.data);e.html(n)}).catch(function(){return Flash(Object(I.e)("Commits|An error occurred while fetching merge requests data."))})}document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelector(".with-performance-bar")?35:0;new s.a,new a.a,new r.a,new c.a({container:".js-commit-pipeline-graph"}).bindEvents(),Object(l.a)(),Object(d.a)(document.querySelector(".navbar-gitlab").offsetHeight+t),o()(".commit-info.branches").load(document.querySelector(".js-commit-box").dataset.commitPath),A(),e=(document.querySelector(".merge-request")||document.querySelector(".commit-box")).dataset.projectPath,window.gl=window.gl||{},window.gl.diffNoteApps={},window.ResolveService=new gl.DiffNotesResolveServiceClass(e),gl.diffNotesCompileComponents=function(){o()("diff-note-avatars").each(function(){var e=(new(u.default.extend({template:o()(this).get(0).outerHTML}))).$mount();o()(this).replaceWith(e.$el),o()(e.$el).one("remove.vue",function(){e.$destroy(),e.$el.remove()})});var e=o()("resolve-btn, resolve-discussion-btn, jump-to-discussion, comment-and-resolve-btn, new-issue-for-discussion-btn").filter(function(){return 1!==o()(this).closest("resolve-count").length});e&&e.each(function(){var e=o()(this),t=e.attr(":note-id"),n=e.attr(":discussion-id");if(!e.is("comment-and-resolve-btn")||n){var i=(new(u.default.extend({template:e.get(0).outerHTML}))).$mount();t&&(gl.diffNoteApps["note_".concat(t)]=i),e.replaceWith(i.$el)}})},gl.diffNotesCompileComponents(),o()(window).trigger("resize.nav")})},143:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(0),o=n.n(i),s=(n(261),n(6)),a=n(7);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selector=t.selector,this.dataType=t.dataType,this.fieldName=t.fieldName,this.onSuccess=t.onSuccess||function(){},this.onError=function(e){var t="";return e.response.data&&"object"===r(e.response.data)&&(t=e.response.data.errors.join(" ")),new a.a(t||"Update failed","alert")},this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.disable(),o()("".concat(this.selector," .js-task-list-container")).taskList("enable"),o()(document).on("tasklist:changed","".concat(this.selector," .js-task-list-container"),this.update.bind(this))}},{key:"disable",value:function(){o()("".concat(this.selector," .js-task-list-container")).taskList("disable"),o()(document).off("tasklist:changed","".concat(this.selector," .js-task-list-container"))}},{key:"update",value:function(e){var t,n,i,a=this,r=o()(e.target),c={};return c[this.dataType]=(t={},n=this.fieldName,i=r.val(),n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t),s.a.patch(r.data("updateUrl")||o()("form.js-issuable-update").attr("action"),c).then(function(e){var t=e.data;return a.onSuccess(t)}).catch(function(e){return a.onError(e)})}}])&&c(t.prototype,n),i&&c(t,i),e}()},156:function(e,t,n){"use strict";var i={init:function(e){this.hook=e,this.destroyed=!1,this.config=e.config.InputSetter||(this.hook.config.InputSetter={}),this.eventWrapper={},this.addEvents()},addEvents:function(){this.eventWrapper.setInputs=this.setInputs.bind(this),this.hook.list.list.addEventListener("click.dl",this.eventWrapper.setInputs)},removeEvents:function(){this.hook.list.list.removeEventListener("click.dl",this.eventWrapper.setInputs)},setInputs:function(e){var t=this;if(!this.destroyed){var n=e.detail.selected;Array.isArray(this.config)||(this.config=[this.config]),this.config.forEach(function(e){return t.setInput(e,n)})}},setInput:function(e,t){var n=e.input||this.hook.trigger,i=t.getAttribute(e.valueAttribute),o=e.inputAttribute;return n.hasAttribute(o)?n.setAttribute(o,i):"INPUT"===n.tagName?n.value=i:n.textContent=i},destroy:function(){this.destroyed=!0,this.removeEvents()}};t.a=i},160:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r});var i=n(212),o=n.n(i),s=function(e,t,n,i){var o=Math.floor(e.offsetTop-t);if(o<=n&&!e.classList.contains("is-stuck")){var s=i?function(){var e=document.createElement("div");return e.classList.add("sticky-placeholder"),e}():null,a=e.offsetHeight;e.classList.add("is-stuck"),i&&(e.parentNode.insertBefore(s,e.nextElementSibling),s.style.height="".concat(a-e.offsetHeight,"px"))}else o>n&&e.classList.contains("is-stuck")&&(e.classList.remove("is-stuck"),i&&e.nextElementSibling&&e.nextElementSibling.classList.contains("sticky-placeholder")&&e.nextElementSibling.remove())},a=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&"undefined"!=typeof CSS&&CSS.supports("(position: -webkit-sticky) or (position: sticky)")&&document.addEventListener("scroll",function(){return s(e,window.scrollY,t,n)},{passive:!0})},r=function(e){o.a.add(e)}},196:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(6),a=n(7),r=n(1),c=n(19),l=n(14),d=n.n(l),u=".".concat("diff-line-num",", .line_content"),f={init:function(e){var t=this;this.userCanCreateNote||(this.userCanCreateNote=""===e.closest(".files").data("canCreateNote")),this.isParallelView="parallel"===d.a.get("diff_view"),this.userCanCreateNote&&e.on("mouseover",u,function(e){return t.showButton(t.isParallelView,e)}).on("mouseleave",u,function(e){return t.hideButton(t.isParallelView,e)})},showButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);this.validateButtonParent(n)&&(n.classList.add("is-over"),n.nextElementSibling.classList.add("is-over"))},hideButton:function(e,t){var n=this.getButtonParent(t.currentTarget,e);n.classList.remove("is-over"),n.nextElementSibling.classList.remove("is-over")},getButtonParent:function(e,t){if(t){if(!e.classList.contains("diff-line-num"))return e.previousElementSibling}else if(!e.classList.contains("old_line"))return e.parentNode.querySelector(".".concat("old_line"));return e},validateButtonParent:function(e){return!(e.classList.contains("empty-cell")||e.classList.contains("js-unfold")||e.classList.contains("no-comment-btn")||e.parentNode.classList.contains("diff-expanded"))}},h=n(125),p=n(140);function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v='<div class="diff-content"></div>',g='<i class="fa fa-spinner fa-spin"></i>',y='<div class="nothing-here-block diff-collapsed">This diff is collapsed. <button class="click-to-expand btn btn-link">Click to expand it.</button></div>',b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.toggleDiff=this.toggleDiff.bind(this),this.content=o()(".diff-content",this.file),this.$toggleIcon=o()(".diff-toggle-caret",this.file),this.diffForPath=this.content.find("[data-diff-for-path]").data("diffForPath"),this.isOpen=!this.diffForPath,this.diffForPath?(this.collapsedContent=this.content,this.loadingContent=o()(v).addClass("loading").html(g).hide(),this.content=null,this.collapsedContent.after(this.loadingContent),this.$toggleIcon.addClass("fa-caret-right")):(this.collapsedContent=o()(v).html(y).hide(),this.content.after(this.collapsedContent),this.$toggleIcon.addClass("fa-caret-down")),o()(".js-file-title, .click-to-expand",this.file).on("click",function(e){this.toggleDiff(o()(e.target))}.bind(this))}var t,n,i;return t=e,(n=[{key:"toggleDiff",value:function(e,t){if(e.hasClass("js-file-title")||e.hasClass("click-to-expand")||e.hasClass("diff-toggle-caret"))if(this.isOpen=!this.isOpen,this.isOpen||this.hasError){if(!this.content)return this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),this.getContentHTML(t);this.collapsedContent.hide(),this.content.show(),this.$toggleIcon.addClass("fa-caret-down").removeClass("fa-caret-right"),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}else this.content.hide(),this.$toggleIcon.addClass("fa-caret-right").removeClass("fa-caret-down"),this.collapsedContent.show(),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"getContentHTML",value:function(e){var t=this;this.collapsedContent.hide(),this.loadingContent.show(),s.a.get(this.diffForPath).then(function(n){var i=n.data;t.loadingContent.hide(),i.html?(t.content=o()(i.html),Object(p.a)(t.content)):(t.hasError=!0,t.content=o()('<div class="nothing-here-block"><i class="fa fa-warning"></i> Could not load diff</div>')),t.collapsedContent.after(t.content),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents();var s=o()(t.file);f.init(s);var a=s.closest(".files").is("[data-can-create-note]");h.a.initImageDiff(s[0],a),e&&e()}).catch(function(){Object(a.a)(Object(r.a)("An error occurred while retrieving diff"))})}}])&&m(t.prototype,n),i&&m(t,i),e}();function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,s=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"a",function(){return j});var C=!1,j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=o()(".files .diff-file");t.each(function(e,t){o.a.data(t,"singleFileDiff")||o.a.data(t,"singleFileDiff",new b(t))});var n=document.getElementById("diffs");(!n||n&&n.dataset&&""!==n.dataset.isLocked)&&f.init(t);var i=o()(".files").first().get(0),s=i&&i.hasAttribute("data-can-create-note");t.each(function(e,t){return h.a.initImageDiff(t,s)}),C||(o()(document).on("click",".js-unfold",this.handleClickUnfold.bind(this)).on("click",".diff-line-num a",this.handleClickLineNum.bind(this)).on("mousedown","td.line_content.parallel",this.handleParallelLineDown.bind(this)),C=!0),Object(c.a)()&&this.highlightSelectedLine(),this.openAnchoredDiff()}var t,n,i;return t=e,(n=[{key:"handleClickUnfold",value:function(e){var t,n,i=o()(e.target),c=w(this.lineNumbers(i.parent()),2),l=c[0],d=c[1],u=d-l,f=i.hasClass("js-unfold-bottom"),h=!0;if(f){var p=d+1;t=p,n=p+20}else{var m=d-1;t=m-20,n=m;var v=this.lineNumbers(i.parent().prev())[1];t<=v+1&&(t=v+1,h=!1)}var g=i.parents(".diff-file"),y=g.data("blobDiffPath"),b={since:t,to:n,bottom:f,offset:u,unfold:h,view:g.data("view")};s.a.get(y,{params:b}).then(function(e){var t=e.data;return i.parent().replaceWith(t)}).catch(function(){return Object(a.a)(Object(r.a)("An error occurred while loading diff"))})}},{key:"openAnchoredDiff",value:function(e){var t=this,n=Object(c.a)(),i=n&&n.split("_")[0];if(i){var s=o()("#".concat(i)).closest(".diff-file");if(o()(".nothing-here-block:visible",s).length){var a=o()(".js-file-title, .click-to-expand",s);s.data("singleFileDiff").toggleDiff(a,function(){t.highlightSelectedLine(),e&&e()})}else e&&e()}}},{key:"handleClickLineNum",value:function(e){var t=o()(e.currentTarget).attr("href");e.preventDefault(),window.history.pushState?window.history.pushState(null,null,t):window.location.hash=t,this.highlightSelectedLine()}},{key:"handleParallelLineDown",value:function(e){var t=o()(e.currentTarget),n=t.closest("table");n.removeClass("left-side-selected right-side-selected");var i=["left-side","right-side"].filter(function(e){return t.hasClass(e)})[0];i&&n.addClass("".concat(i,"-selected"))}},{key:"diffViewType",value:function(){return o()(".inline-parallel-buttons a.active").data("viewType")}},{key:"lineNumbers",value:function(e){var t=e.find(".diff-line-num").toArray();return 2!==t.length?[0,0]:t.map(function(e){return parseInt(o()(e).data("linenumber"),10)||0})}},{key:"highlightSelectedLine",value:function(){var e=Object(c.a)(),t=o()(".diff-file");t.find(".hll").removeClass("hll"),e&&t.find("tr#".concat(e,":not(.match) td, td#").concat(e,', td[data-line-code="').concat(e,'"]')).addClass("hll")}}])&&k(t.prototype,n),i&&k(t,i),e}()},212:function(e,t){!function(t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=!1;if(t.getComputedStyle){var s=n.createElement("div");["","-webkit-","-moz-","-ms-"].some(function(e){try{s.style.position=e+"sticky"}catch(e){}return""!=s.style.position})&&(o=!0)}else o=!0;var a="undefined"!=typeof ShadowRoot,r={top:null,left:null},c=[];function l(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function d(e){return parseFloat(e)||0}function u(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}var f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(c.some(function(e){return e._node===t}))throw new Error("Stickyfill is already applied to this node");this._node=t,this._stickyMode=null,this._active=!1,c.push(this),this.refresh()}return i(e,[{key:"refresh",value:function(){if(!o&&!this._removed){this._active&&this._deactivate();var e=this._node,i=getComputedStyle(e),s={top:i.top,display:i.display,marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat};if(!isNaN(parseFloat(s.top))&&"table-cell"!=s.display&&"none"!=s.display){this._active=!0;var r=e.parentNode,c=a&&r instanceof ShadowRoot?r.host:r,f=e.getBoundingClientRect(),h=c.getBoundingClientRect(),p=getComputedStyle(c);this._parent={node:c,styles:{position:c.style.position},offsetHeight:c.offsetHeight},this._offsetToWindow={left:f.left,right:n.documentElement.clientWidth-f.right},this._offsetToParent={top:f.top-h.top-d(p.borderTopWidth),left:f.left-h.left-d(p.borderLeftWidth),right:-f.right+h.right-d(p.borderRightWidth)},this._styles={position:e.style.position,top:e.style.top,bottom:e.style.bottom,left:e.style.left,right:e.style.right,width:e.style.width,marginTop:e.style.marginTop,marginLeft:e.style.marginLeft,marginRight:e.style.marginRight};var m=d(s.top);this._limits={start:f.top+t.pageYOffset-m,end:h.top+t.pageYOffset+c.offsetHeight-d(p.borderBottomWidth)-e.offsetHeight-m-d(s.marginBottom)};var v=p.position;"absolute"!=v&&"relative"!=v&&(c.style.position="relative"),this._recalcPosition();var g=this._clone={};g.node=n.createElement("div"),l(g.node.style,{width:f.right-f.left+"px",height:f.bottom-f.top+"px",marginTop:s.marginTop,marginBottom:s.marginBottom,marginLeft:s.marginLeft,marginRight:s.marginRight,cssFloat:s.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),r.insertBefore(g.node,e),g.docOffsetTop=u(g.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var e=r.top<=this._limits.start?"start":r.top>=this._limits.end?"end":"middle";if(this._stickyMode!=e){switch(e){case"start":l(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":l(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":l(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=e}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(u(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var e=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,l(this._node.style,this._styles),delete this._styles,c.some(function(t){return t!==e&&t._parent&&t._parent.node===e._parent.node})||l(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var e=this;this._deactivate(),c.some(function(t,n){if(t._node===e._node)return c.splice(n,1),!0}),this._removed=!0}}]),e}(),h={stickies:c,Sticky:f,addOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}for(var t=0;t<c.length;t++)if(c[t]._node===e)return c[t];return new f(e)},add:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length){for(var t=[],n=function(n){var i=e[n];return i instanceof HTMLElement?c.some(function(e){if(e._node===i)return t.push(e),!0})?"continue":void t.push(new f(i)):(t.push(void 0),"continue")},i=0;i<e.length;i++)n(i);return t}},refreshAll:function(){c.forEach(function(e){return e.refresh()})},removeOne:function(e){if(!(e instanceof HTMLElement)){if(!e.length||!e[0])return;e=e[0]}c.some(function(t){if(t._node===e)return t.remove(),!0})},remove:function(e){if(e instanceof HTMLElement&&(e=[e]),e.length)for(var t=function(t){var n=e[t];c.some(function(e){if(e._node===n)return e.remove(),!0})},n=0;n<e.length;n++)t(n)},removeAll:function(){for(;c.length;)c[0].remove()}};o||function(){function e(){t.pageXOffset!=r.left?(r.top=t.pageYOffset,r.left=t.pageXOffset,h.refreshAll()):t.pageYOffset!=r.top&&(r.top=t.pageYOffset,r.left=t.pageXOffset,c.forEach(function(e){return e._recalcPosition()}))}e(),t.addEventListener("scroll",e),t.addEventListener("resize",h.refreshAll),t.addEventListener("orientationchange",h.refreshAll);var i=void 0;function o(){i=setInterval(function(){c.forEach(function(e){return e._fastCheck()})},500)}var s=void 0,a=void 0;"hidden"in n?(s="hidden",a="visibilitychange"):"webkitHidden"in n&&(s="webkitHidden",a="webkitvisibilitychange"),a?(n[s]||o(),n.addEventListener(a,function(){n[s]?clearInterval(i):o()})):o()}(),void 0!==e&&e.exports?e.exports=h:t.Stickyfill=h}(window,document)},224:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(5),a=n.n(s),r=n(14),c=n.n(r),l=n(62),d=n.n(l),u=(n(410),n(411),n(152)),f=n(11),h=n(140),p=n(10),m=n(6),v=n(19),g=n(7),y=n(66),b=n(175),w=n(156);function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var C=Object.assign({},w.a),j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dropdownTrigger=t.dropdownTrigger,this.dropdownList=t.dropdownList,this.noteTypeInput=t.noteTypeInput,this.submitButton=t.submitButton,this.closeButton=t.closeButton,this.reopenButton=t.reopenButton}var t,n,i;return t=e,(n=[{key:"initDroplab",value:function(){this.droplab=new b.a;var e=this.setConfig();this.droplab.init(this.dropdownTrigger,this.dropdownList,[C],e)}},{key:"setConfig",value:function(){var e={InputSetter:[{input:this.noteTypeInput,valueAttribute:"data-value"},{input:this.submitButton,valueAttribute:"data-submit-text"}]};return this.closeButton&&e.InputSetter.push({input:this.closeButton,valueAttribute:"data-close-text"},{input:this.closeButton,valueAttribute:"data-close-text",inputAttribute:"data-alternative-text"}),this.reopenButton&&e.InputSetter.push({input:this.reopenButton,valueAttribute:"data-reopen-text"},{input:this.reopenButton,valueAttribute:"data-reopen-text",inputAttribute:"data-alternative-text"}),e}}])&&k(t.prototype,n),i&&k(t,i),e}(),_=n(79),x=n(190),E=n(109),T=n(143),S=n(13),N=(n(125),n(20));function I(e,t,n){return(I=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&D(o,n.prototype),o}).apply(null,arguments)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function A(e,t,n){return t&&O(e.prototype,t),n&&O(e,n),e}function L(e){return e.replace(/\r\n/g,"\n")}n.d(t,"a",function(){return F}),window.autosize=d.a;var P=/^\/\w+.*$/gm,F=function(){function e(t,n,i,s){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.updateTargetButtons=this.updateTargetButtons.bind(this),this.updateComment=this.updateComment.bind(this),this.visibilityChange=this.visibilityChange.bind(this),this.cancelDiscussionForm=this.cancelDiscussionForm.bind(this),this.onAddDiffNote=this.onAddDiffNote.bind(this),this.onAddImageDiffNote=this.onAddImageDiffNote.bind(this),this.setupDiscussionNoteForm=this.setupDiscussionNoteForm.bind(this),this.onReplyToDiscussionNote=this.onReplyToDiscussionNote.bind(this),this.removeNote=this.removeNote.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.updateNote=this.updateNote.bind(this),this.addDiscussionNote=this.addDiscussionNote.bind(this),this.addNoteError=this.addNoteError.bind(this),this.addNote=this.addNote.bind(this),this.resetMainTargetForm=this.resetMainTargetForm.bind(this),this.refresh=this.refresh.bind(this),this.keydownNoteText=this.keydownNoteText.bind(this),this.toggleCommitList=this.toggleCommitList.bind(this),this.postComment=this.postComment.bind(this),this.clearFlashWrapper=this.clearFlash.bind(this),this.onHashChange=this.onHashChange.bind(this),this.notes_url=t,this.note_ids=n,this.enableGFM=a,this.updatedNotesTrackingMap={},this.last_fetched_at=i,this.noteable_url=document.URL,this.notesCountBadge||(this.notesCountBadge=o()(".issuable-details").find(".notes-tab .badge")),this.basePollingInterval=15e3,this.maxPollingSteps=4,this.$wrapperEl=Object(S.s)()?o()(document).find(".diffs"):o()(document),this.cleanBinding(),this.addBinding(),this.setPollingInterval(),this.setupMainTargetNoteForm(a),this.taskList=new T.a({dataType:"note",fieldName:"note",selector:".notes"}),this.collapseLongCommitList(),this.setViewType(s),"merge_requests"===Object(S.h)(1)&&o()(".note-edit-form").clone().addClass("mr-note-edit-form").insertAfter(".note-edit-form");var r=Object(v.a)(),c=r&&document.getElementById(r);c&&this.loadLazyDiff({currentTarget:c})}return A(e,null,[{key:"initialize",value:function(t,n,i,o,s){this.instance||(this.instance=new e(t,n,i,o,s))}},{key:"getInstance",value:function(){return this.instance}}]),A(e,[{key:"setViewType",value:function(e){this.view=c.a.get("diff_view")||e}},{key:"addBinding",value:function(){this.$wrapperEl.on("click",".js-note-edit",this.showEditForm.bind(this)),this.$wrapperEl.on("click",".note-edit-cancel",this.cancelEdit),this.$wrapperEl.on("click",".js-comment-submit-button",this.postComment),this.$wrapperEl.on("click",".js-comment-save-button",this.updateComment),this.$wrapperEl.on("keyup input",".js-note-text",this.updateTargetButtons),this.$wrapperEl.on("click",".js-comment-resolve-button",this.postComment),this.$wrapperEl.on("click",".js-note-delete",this.removeNote),this.$wrapperEl.on("click",".js-note-attachment-delete",this.removeAttachment),this.$wrapperEl.on("change",".js-note-attachment-input",this.updateFormAttachment),this.$wrapperEl.on("click",".js-discussion-reply-button",this.onReplyToDiscussionNote),this.$wrapperEl.on("click",".js-add-diff-note-button",this.onAddDiffNote),this.$wrapperEl.on("click",".js-add-image-diff-note-button",this.onAddImageDiffNote),this.$wrapperEl.on("click",".js-close-discussion-note-form",this.cancelDiscussionForm),this.$wrapperEl.on("click",".system-note-commit-list-toggler",this.toggleCommitList),this.$wrapperEl.on("click",".js-toggle-lazy-diff",this.loadLazyDiff),this.$wrapperEl.on("click",".js-toggle-lazy-diff-retry-button",this.onClickRetryLazyLoad.bind(this)),this.$wrapperEl.on("visibilitychange",this.visibilityChange),this.$wrapperEl.on("issuable:change",this.refresh),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.addNote),this.$wrapperEl.on("ajax:success",".js-discussion-note-form",this.addDiscussionNote),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.resetMainTargetForm),this.$wrapperEl.on("ajax:complete",".js-main-target-form",this.reenableTargetFormSubmitButton),this.$wrapperEl.on("keydown",".js-note-text",this.keydownNoteText),o()(window).on("hashchange",this.onHashChange)}},{key:"cleanBinding",value:function(){this.$wrapperEl.off("click",".js-note-edit"),this.$wrapperEl.off("click",".note-edit-cancel"),this.$wrapperEl.off("click",".js-note-delete"),this.$wrapperEl.off("click",".js-note-attachment-delete"),this.$wrapperEl.off("click",".js-discussion-reply-button"),this.$wrapperEl.off("click",".js-add-diff-note-button"),this.$wrapperEl.off("click",".js-add-image-diff-note-button"),this.$wrapperEl.off("visibilitychange"),this.$wrapperEl.off("keyup input",".js-note-text"),this.$wrapperEl.off("click",".js-note-target-reopen"),this.$wrapperEl.off("click",".js-note-target-close"),this.$wrapperEl.off("keydown",".js-note-text"),this.$wrapperEl.off("click",".js-comment-resolve-button"),this.$wrapperEl.off("click",".system-note-commit-list-toggler"),this.$wrapperEl.off("click",".js-toggle-lazy-diff"),this.$wrapperEl.off("click",".js-toggle-lazy-diff-retry-button"),this.$wrapperEl.off("ajax:success",".js-main-target-form"),this.$wrapperEl.off("ajax:success",".js-discussion-note-form"),this.$wrapperEl.off("ajax:complete",".js-main-target-form"),o()(window).off("hashchange",this.onHashChange)}},{key:"keydownNoteText",value:function(e){var t,n,i,s;if(!Object(S.w)(e))switch(t=o()(e.target),e.which){case 38:if(""!==t.val())return;if((s=o()("li.note[data-author-id='".concat(gon.current_user_id,"'][data-editable]:last"),t.closest(".note, .notes_holder, #notes"))).length)return s.find(".js-note-edit").trigger("click",[!0,s]);break;case 27:if((n=t.closest(".js-discussion-note-form")).length){if(""!==t.val()&&!window.confirm("Are you sure you want to cancel creating this comment?"))return;return void this.removeDiscussionNoteForm(n)}if((i=t.closest(".note")).length){if(t.closest("form").data("originalNote")!==t.val()&&!window.confirm("Are you sure you want to cancel editing this comment?"))return;return this.removeNoteEditForm(i)}}}},{key:"initRefresh",value:function(){return e.interval&&clearInterval(e.interval),e.interval=setInterval((t=this,function(){return t.refresh()}),this.pollingInterval);var t}},{key:"refresh",value:function(){if(!document.hidden)return this.getContent()}},{key:"getContent",value:function(){var e=this;this.refreshing||(this.refreshing=!0,m.a.get("".concat(this.notes_url,"?html=true"),{headers:{"X-Last-Fetched-At":this.last_fetched_at}}).then(function(t){var n=t.data,i=n.notes;e.last_fetched_at=n.last_fetched_at,e.setPollingInterval(n.notes.length),o.a.each(i,function(t,n){return e.renderNote(n)}),e.refreshing=!1}).catch(function(){e.refreshing=!1}))}},{key:"setPollingInterval",value:function(e){var t;return null==e&&(e=!0),t=this.basePollingInterval*Math.pow(2,this.maxPollingSteps-1),e?this.pollingInterval=this.basePollingInterval:this.pollingInterval<t&&(this.pollingInterval*=2),this.initRefresh()}},{key:"handleQuickActions",value:function(t){var n;t.commands_changes&&("merge"in t.commands_changes&&e.checkMergeRequestStatus(),"emoji_award"in t.commands_changes&&(n=o()(".js-awards-block").eq(0),Object(x.b)().then(function(e){e.addAwardToEmojiBar(n,t.commands_changes.emoji_award),e.scrollToAwards()}).catch(function(){})))}},{key:"setupNewNote",value:function(t){Object(N.i)(t.find(".js-timeago"),!1),this.collapseLongCommitList(),this.taskList.init(),e.updateNoteTargetSelector(t),this.$noteToCleanHighlight=t}},{key:"onHashChange",value:function(){this.$noteToCleanHighlight&&e.updateNoteTargetSelector(this.$noteToCleanHighlight),this.$noteToCleanHighlight=null}},{key:"renderNote",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o()(".main-notes-list");if(t.discussion_html)return this.renderDiscussionNote(t,n);if(t.valid){var s=i.find("#note_".concat(t.id));if(e.isNewNote(t,this.note_ids)){if(Object(S.s)())return;this.note_ids.push(t.id),i.length&&i.find(".system-note.being-posted").remove();var a=e.animateAppendNote(t.html,i);return this.setupNewNote(a),this.refresh(),this.updateNotesCount(1)}if(e.isUpdatedNote(t,s)){var r=s.hasClass("is-editing"),c=L(s.find(".original-note-content").text().trim()),l=s.find(".js-note-text"),d=l.val(),u=L(t.note),f=d===c||d===u;if(r&&f)l.val(t.note),this.updatedNotesTrackingMap[t.id]=t;else if(r&&!f)this.putConflictEditWarningInPlace(t,s),this.updatedNotesTrackingMap[t.id]=t;else{var h=e.animateUpdateNote(t.html,s);this.setupNewNote(h)}}}else t.errors&&t.errors.commands_only&&(t.commands_changes&&Object.keys(t.commands_changes).length>0&&i.find(".system-note.being-posted").remove(),this.addFlash(t.errors.commands_only,"notice",this.parentTimeline.get(0)),this.refresh())}},{key:"isParallelView",value:function(){return"parallel"===c.a.get("diff_view")}},{key:"renderDiscussionNote",value:function(t,n){var i,s,a,r,c;if(e.isNewNote(t,this.note_ids)){if(this.note_ids.push(t.id),a=(s=n||o()('.js-discussion-note-form[data-discussion-id="'.concat(t.discussion_id,'"]'))).length||!t.discussion_line_code?s.closest("tr"):o()("#".concat(t.discussion_line_code)),t.on_image&&(a=s),r=this.isParallelView()?s.find("#line_type").val():"old",c=a.prevAll(".line_holder").first().find(".js-avatar-container."+r+"_line"),(i=o()('.notes[data-discussion-id="'.concat(t.discussion_id,'"]'))).length||(i=s.closest(".discussion").find(".notes")),0===i.length)if(t.diff_discussion_html){var l=o()(t.diff_discussion_html).renderGFM();if(!this.isParallelView()||a.hasClass("js-temp-notes-holder")||t.on_image)a.after(l);else{var d=l.find('.notes[data-discussion-id="'.concat(t.discussion_id,'"]')),u="."+d.closest(".notes_content").attr("class").split(" ").join(".");a.find(u+" .content").append(d.closest(".content").children())}}else e.animateAppendNote(t.discussion_html,o()(".main-notes-list"));else e.animateAppendNote(t.html,i);return void 0!==gl.diffNotesCompileComponents&&t.discussion_resolvable&&(gl.diffNotesCompileComponents(),this.renderDiscussionAvatar(c,t)),Object(N.i)(o()(".js-timeago"),!1),e.checkMergeRequestStatus(),this.updateNotesCount(1)}}},{key:"getLineHolder",value:function(e){return o()(e).closest(".notes_holder").prevAll(".line_holder").first().get(0)}},{key:"renderDiscussionAvatar",value:function(e,t){var n=e.find(".diff-comment-avatar-holders");n.length||((n=document.createElement("diff-note-avatars")).setAttribute("discussion-id",t.discussion_id),e.append(n),gl.diffNotesCompileComponents())}},{key:"resetMainTargetForm",value:function(e){var t;(t=o()(".js-main-target-form")).find(".js-errors").remove(),t.find(".js-md-write-button").click(),t.find(".js-note-text").val("").trigger("input"),t.find(".js-note-text").data("autosave").reset();var n=document.createEvent("Event");n.initEvent("autosize:update",!0,!1),t.find(".js-autosize")[0].dispatchEvent(n),this.updateTargetButtons(e)}},{key:"reenableTargetFormSubmitButton",value:function(){return o()(".js-main-target-form").find(".js-note-text").trigger("input")}},{key:"setupMainTargetNoteForm",value:function(t){var n;n=o()(".js-new-note-form"),this.formClone=n.clone(),this.setupNoteForm(n,t),n.removeClass("js-new-note-form"),n.addClass("js-main-target-form"),n.find("#note_line_code").remove(),n.find("#note_position").remove(),n.find("#note_type").val(""),n.find("#note_project_id").remove(),n.find("#in_reply_to_discussion_id").remove(),n.find(".js-comment-resolve-button").closest("comment-and-resolve-btn").remove(),this.parentTimeline=n.parents(".timeline"),n.length&&e.initCommentTypeToggle(n.get(0))}},{key:"setupNoteForm",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.b;return this.glForm=new _.a(e,i),t=e.find(".js-note-text"),n=["Note",e.find("#note_noteable_type").val(),e.find("#note_noteable_id").val(),e.find("#note_commit_id").val(),e.find("#note_type").val(),e.find("#note_project_id").val(),e.find("#in_reply_to_discussion_id").val(),e.find("#note_line_code").val(),e.find("#note_position").val()],new E.a(t,n)}},{key:"addNote",value:function(e,t){return this.renderNote(t)}},{key:"addNoteError",value:function(e){var t;return e.hasClass("js-main-target-form")?t=e.parents(".timeline"):e.hasClass("js-discussion-note-form")&&(t=e.closest(".discussion-notes").find(".notes")),this.addFlash("Your comment could not be submitted! Please check your network connection and try again.","alert",t.get(0))}},{key:"updateNoteError",value:function(e){new g.a("Your comment could not be updated! Please check your network connection and try again.")}},{key:"addDiscussionNote",value:function(e,t,n){if(null!=e.attr("data-resolve-all")){e.data("projectPath");var i=e.data("discussionId"),o=e.data("noteableIid");null!=ResolveService&&ResolveService.toggleResolveForDiscussion(o,i)}this.renderNote(t,e),n&&this.removeDiscussionNoteForm(e)}},{key:"updateNote",value:function(e,t){var n;n=o()(e.html),this.revertNoteEditForm(t),n.renderGFM(),o()(".note-row-"+e.id).replaceWith(n),this.setupNewNote(n),void 0!==gl.diffNotesCompileComponents&&gl.diffNotesCompileComponents()}},{key:"checkContentToAllowEditing",value:function(e){var t=e.find(".original-note-content").text().trim(),n=!0;if(e.find(".js-note-text").val()===t)this.removeNoteEditForm(e);else{e.find(".note-form-actions");Object(S.u)(e.get(0))||Object(S.G)(e),e.find(".js-finish-edit-warning").show(),n=!1}return n}},{key:"showEditForm",value:function(e,t,n){e.preventDefault();var i=o()(e.target),s=o()(this.getEditFormSelector(i)),a=i.closest(".note"),r=o()(".note.is-editing:visible");if(r.length&&!this.checkContentToAllowEditing(r))return;a.find(".js-note-attachment-delete").show(),s.addClass("current-note-edit-form"),a.addClass("is-editing"),this.putEditFormInPlace(i)}},{key:"cancelEdit",value:function(e){e.preventDefault();var t=o()(e.target),n=t.closest(".note"),i=n.attr("data-note-id");if(this.revertNoteEditForm(t),this.updatedNotesTrackingMap[i]){var s=o()(this.updatedNotesTrackingMap[i].html);n.replaceWith(s),this.setupNewNote(s),delete this.updatedNotesTrackingMap[i]}else n.find(".js-finish-edit-warning").hide(),this.removeNoteEditForm(n)}},{key:"revertNoteEditForm",value:function(e){e=e||o()(".note.is-editing:visible");var t=this.getEditFormSelector(e),n=o()(t);n.insertBefore(".diffs"),n.find(".js-comment-save-button").enable(),n.find(".js-finish-edit-warning").hide()}},{key:"getEditFormSelector",value:function(e){var t=".note-edit-form:not(.mr-note-edit-form)";return e.parents("#diffs").length&&(t=".note-edit-form.mr-note-edit-form"),t}},{key:"removeNoteEditForm",value:function(e){var t=e.find(".diffs .current-note-edit-form");return e.removeClass("is-editing"),t.removeClass("current-note-edit-form"),t.find(".js-finish-edit-warning").hide(),t.find(".js-note-text").val(t.find("form.edit-note").data("originalNote"))}},{key:"removeNote",value:function(t){var n,i;return i=o()(t.currentTarget).closest(".note"),n=i.attr("id"),i.attr("data-note-id"),o()(t.currentTarget).closest(".notes[data-discussion-id]").closest(".notes_holder").prev(".line_holder"),o()('.note[id="'.concat(n,'"]')).each(function(e,t){var i,s;s=(i=o()(t)).closest(".discussion-notes");var a=o()(".notes",s).data("discussionId");if(void 0!==gl.diffNotesCompileComponents&&gl.diffNoteApps[n]&&gl.diffNoteApps[n].$destroy(),i.remove(),0===s.find(".note").length){var r=s.closest("tr");if(s.closest(".timeline-entry").remove(),o()(".js-diff-avatars-".concat(a)).trigger("remove.vue"),r.find(".discussion-notes").length>1||0===r.length){var c=s.closest(".diff-file");if(c.length>0){var l=new CustomEvent("removeBadge.imageDiff",{detail:{badgeNumber:s.index()+1}});c[0].dispatchEvent(l)}s.remove()}else r.length>0&&r.remove()}}),e.checkMergeRequestStatus(),this.updateNotesCount(-1)}},{key:"removeAttachment",value:function(){var e=o()(this).closest(".note");return e.find(".note-attachment").remove(),e.find(".note-body > .note-text").show(),e.find(".note-header").show(),e.find(".diffs .current-note-edit-form").remove()}},{key:"onReplyToDiscussionNote",value:function(e){this.replyToDiscussionNote(e.target)}},{key:"replyToDiscussionNote",value:function(e){var t,n;return t=this.cleanForm(this.formClone.clone()),(n=o()(e).closest(".js-discussion-reply-button")).closest(".discussion-reply-holder").hide().after(t),this.setupDiscussionNoteForm(n,t)}},{key:"setupDiscussionNoteForm",value:function(e,t){var n=e.closest(".text-file");0===n.length&&(n=e.closest(".image"));var i=e.data("discussionId");(i&&(t.attr("data-discussion-id",i),t.find("#in_reply_to_discussion_id").val(i)),t.find("#note_project_id").val(e.data("discussionProjectId")),t.attr("data-line-code",e.data("lineCode")),t.find("#line_type").val(e.data("lineType")),t.find("#note_noteable_type").val(n.data("noteableType")),t.find("#note_noteable_id").val(n.data("noteableId")),t.find("#note_commit_id").val(n.data("commitId")),t.find("#note_type").val(e.data("noteType")),t.find("#note_line_code").val(e.data("lineCode")),t.find("#note_position").val(e.attr("data-position")),t.find(".js-close-discussion-note-form").show().removeClass("hide"),t.find(".js-note-target-close").remove(),t.find(".js-note-new-discussion").remove(),this.setupNoteForm(t),t.removeClass("js-main-target-form").addClass("discussion-form js-discussion-note-form"),void 0!==gl.diffNotesCompileComponents)&&(t.find("comment-and-resolve-btn").attr(":discussion-id","'".concat(i,"'")),gl.diffNotesCompileComponents());t.find(".js-note-text").focus(),t.find(".js-comment-resolve-button").attr("data-discussion-id",i)}},{key:"onAddDiffNote",value:function(e){e.preventDefault();var t=e.currentTarget||e.target,n=o()(t),i=!n.hasClass("js-diff-comment-avatar");this.toggleDiffNote({target:n,lineType:t.dataset.lineType,showReplyInput:i})}},{key:"onAddImageDiffNote",value:function(e){var t,n=o()(e.currentTarget||e.target),i=n.closest(".diff-file"),s=new CustomEvent("click.imageDiff",{detail:e});i[0].dispatchEvent(s);var a=n.closest(".diff-viewer").find(".note-container"),r=a.find("> .discussion-form");0===r.length?(t=this.cleanForm(this.formClone.clone())).appendTo(a):t=r,this.setupDiscussionNoteForm(n,t)}},{key:"toggleDiffNote",value:function(e){var t,n,i,s,a,r,c,l=e.target,d=e.lineType,u=e.forceShow,f=e.showReplyInput,h=void 0!==f&&f,p=(r=(t=o()(l)).closest("tr")).next(),m=r;p.is(".notes_holder")&&(m=p),i=p.is(".notes_holder"),n=!1;var v="";c='<tr class="notes_holder js-temp-notes-holder"><td class="notes_content" colspan="3"><div class="content"></div></td></tr>',this.isParallelView()&&(v=".".concat(d),c='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line old"></td><td class="notes_content parallel old"><div class="content"></div></td><td class="notes_line new"></td><td class="notes_content parallel new"><div class="content"></div></td></tr>');var g=".notes_content".concat(v," .content"),y=m.find(g);if(i&&h)m.show(),(y=m.find(g)).length&&(y.show(),(a=y.find(".js-discussion-reply-button:visible")).length?this.replyToDiscussionNote(a[0]):0===y.find(".js-discussion-note-form").length&&(n=!0));else if(h)r.after(c),y=(m=r.next()).find(g),n=!0;else{var b=m.find(".content:not(:empty)").is(":visible"),w=!0===u||!b&&!(!0===u||!1===u);m.toggleClass("hide",!w),y.toggleClass("hide",!w)}if(n)return(s=this.cleanForm(this.formClone.clone())).appendTo(y),this.setupDiscussionNoteForm(t,s)}},{key:"removeDiscussionNoteForm",value:function(e){var t;return t=e.closest("tr"),e.data("glForm").destroy(),e.find(".js-note-text").data("autosave").reset(),e.prev(".discussion-reply-holder").show(),t.is(".js-temp-notes-holder")?t.remove():e.remove()}},{key:"cancelDiscussionForm",value:function(e){e.preventDefault();var t=o()(e.target).closest(".js-discussion-note-form");if(0===o()(e.target).closest(".discussion-notes").length){var n=t.closest(".diff-file");if(n.length>0){var i=new CustomEvent("blur.imageDiff",{detail:e});n[0].dispatchEvent(i)}}return this.removeDiscussionNoteForm(t)}},{key:"updateFormAttachment",value:function(){var e,t;return t=o()(this).closest("form"),e=o()(this).val().replace(/^.*[\\\/]/,""),t.find(".js-attachment-filename").text(e)}},{key:"visibilityChange",value:function(){return this.refresh()}},{key:"updateTargetButtons",value:function(e){var t,n,i,s,a,r;s=(i=(r=o()(e.target)).parents("form")).find(".js-note-target-reopen"),t=i.find(".js-note-target-close"),r.val().trim().length>0?(a=s.attr("data-alternative-text"),n=t.attr("data-alternative-text"),s.text()!==a&&s.text(a),t.text()!==n&&t.text(n),s.is(":not(.btn-comment-and-reopen)")&&s.addClass("btn-comment-and-reopen"),t.is(":not(.btn-comment-and-close)")&&t.addClass("btn-comment-and-close")):(a=s.data("originalText"),n=t.data("originalText"),s.text()!==a&&s.text(a),t.text()!==n&&t.text(n),s.is(".btn-comment-and-reopen")&&s.removeClass("btn-comment-and-reopen"),t.is(".btn-comment-and-close")&&t.removeClass("btn-comment-and-close"))}},{key:"putEditFormInPlace",value:function(e){var t=o()(this.getEditFormSelector(e)),n=e.closest(".note");t.insertAfter(n.find(".note-text"));var i=n.find(".original-note-content"),s=i.text().trim(),a=i.data("postUrl"),r=i.data("targetId"),c=i.data("targetType"),l=i.data("markdownVersion");this.glForm=new _.a(t.find("form"),this.enableGFM),t.find("form").attr("action","".concat(a,"?html=true")).attr("data-remote","true").attr("data-markdown-version",l),t.find(".js-form-target-id").val(r),t.find(".js-form-target-type").val(c),t.find(".js-note-text").focus().val(s),t.find(".js-md-write-button").trigger("click"),t.find(".referenced-users").hide()}},{key:"putConflictEditWarningInPlace",value:function(e,t){0===t.find(".js-conflict-edit-warning").length&&o()('<div class="js-conflict-edit-warning alert alert-danger">\n        This comment has changed since you started editing, please review the\n        <a href="#note_'.concat(e.id,'" target="_blank" rel="noopener noreferrer">\n          updated comment\n        </a>\n        to ensure information is not lost\n      </div>')).insertAfter(t.find(".note-text"))}},{key:"updateNotesCount",value:function(e){return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(),10)+e)}},{key:"onClickRetryLazyLoad",value:function(e){var t=o()(e.currentTarget);return t.prop("disabled",!0),this.loadLazyDiff(e).then(function(){t.prop("disabled",!1)})}},{key:"loadLazyDiff",value:function(t){var n=o()(t.currentTarget).closest(".js-toggle-container");if(e.renderPlaceholderComponent(n),n.find(".js-toggle-lazy-diff").removeClass("js-toggle-lazy-diff"),0!==n.find("tbody").length){var i=n.find(".file-holder").data("linesPath"),s=n.find(".js-error-lazy-load-diff"),a=n.find(".js-success-lazy-load");return i?m.a.get(i).then(function(t){var i=t.data;a.removeClass("hidden"),s.addClass("hidden"),e.renderDiffContent(n,i)}).catch(function(){a.addClass("hidden"),s.removeClass("hidden")}):Promise.resolve()}}},{key:"toggleCommitList",value:function(e){var t=o()(e.currentTarget),n=t.siblings(".system-note-commit-list");t.find(".fa").toggleClass("fa-angle-down").toggleClass("fa-angle-up"),n.toggleClass("hide-shade")}},{key:"collapseLongCommitList",value:function(){var e=o()("#notes-list").find("li.system-note").has("ul");o.a.each(e,function(e,t){var n=o()(t),i=n.find(".note-text").find("p:first").text().replace(":","");n.find(".note-header .system-note-message").html(i),n.find("li").length>3?(n.find(".note-text").addClass("system-note-commit-list"),n.find(".system-note-commit-list-toggler").show()):n.find(".note-text").addClass("system-note-commit-list hide-shade")})}},{key:"addFlash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.flashContainer=I(g.a,t)}},{key:"clearFlash",value:function(){this.flashContainer&&(this.flashContainer.style.display="none",this.flashContainer=null)}},{key:"cleanForm",value:function(e){return e.find(".js-comment-type-dropdown").removeClass("btn-group"),e.find(".dropdown-menu").remove(),e}},{key:"getFormData",value:function(e){var t=e.find(".js-note-text").val();return{formData:e.serialize(),formContent:a.a.escape(t),formAction:e.attr("action"),formContentOriginal:t}}},{key:"hasQuickActions",value:function(e){return P.test(e)}},{key:"stripQuickActions",value:function(e){return e.replace(P,"").trim()}},{key:"getQuickActionDescription",value:function(e){var t,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).filter(function(t,n){return new RegExp("/".concat(t.name)).test(e)});if(n&&n.length)if(n.length>1)t="Applying multiple commands";else{var i=n[0].description.toLowerCase();t="Applying command to ".concat(i)}else t="Applying command";return t}},{key:"createPlaceholderNote",value:function(e){var t=e.formContent,n=e.uniqueId,i=e.isDiscussionNote,s=e.currentUsername,r=e.currentUserFullname,c=e.currentUserAvatar,l=i?"discussion":"",d=o()('<li id="'.concat(n,'" class="note being-posted fade-in-half timeline-entry">\n         <div class="timeline-entry-inner">\n            <div class="timeline-icon">\n               <a href="/').concat(a.a.escape(s),'">\n                 <img class="avatar s40" src="').concat(c,'" />\n               </a>\n            </div>\n            <div class="timeline-content ').concat(l,'">\n               <div class="note-header">\n                  <div class="note-header-info">\n                     <a href="/').concat(a.a.escape(s),'">\n                       <span class="d-none d-sm-inline-block">').concat(a.a.escape(s),'</span>\n                       <span class="note-headline-light">').concat(a.a.escape(s),'</span>\n                     </a>\n                  </div>\n               </div>\n               <div class="note-body">\n                 <div class="note-text">\n                   <p>').concat(t,"</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>"));return d.find(".d-none.d-sm-inline-block").text(a.a.escape(r)),d.find(".note-headline-light").text("@".concat(a.a.escape(s))),d}},{key:"createPlaceholderSystemNote",value:function(e){var t=e.formContent,n=e.uniqueId;return o()('<li id="'.concat(n,'" class="note system-note timeline-entry being-posted fade-in-half">\n         <div class="timeline-entry-inner">\n           <div class="timeline-content">\n             <i>').concat(t,"</i>\n           </div>\n         </div>\n       </li>"))}},{key:"postComment",value:function(e){var t=this;e.preventDefault();var n=o()(e.target);n.prop("disabled",!0);var i,s,r,c,l=n.parents("form"),d=l.find(".js-note-target-close"),f="discussion"===n.parent().find("li.droplab-item-selected").attr("id"),h=l.hasClass("js-main-target-form"),p=l.hasClass("js-discussion-note-form"),v=n.hasClass("js-comment-resolve-button"),g=this.getFormData(l),y=g.formData,b=g.formContent,w=g.formAction,k=g.formContentOriginal,C=!1;return p?r=l.parent(".discussion-notes").find(".notes"):h&&(r=o()("ul.main-notes-list")),v&&l.find(".js-comment-submit-button").disable(),c=b,this.hasQuickActions(b)&&(c=this.stripQuickActions(b),C=!0),c&&(i=a.a.uniqueId("tempNote_"),r.append(this.createPlaceholderNote({formContent:c,uniqueId:i,isDiscussionNote:f,currentUsername:gon.current_username,currentUserFullname:gon.current_user_fullname,currentUserAvatar:gon.current_user_avatar_url}))),C&&(s=a.a.uniqueId("tempSystemNote_"),r.append(this.createPlaceholderSystemNote({formContent:this.getQuickActionDescription(b,u.a.get(gl.GfmAutoComplete.dataSources.commands)),uniqueId:s}))),r.length&&(h?this.resetMainTargetForm(e):p&&this.removeDiscussionNoteForm(l)),d.text(d.data("originalText")),m.a.post("".concat(w,"?html=true"),y).then(function(o){var s=o.data;n.prop("disabled",!1),r.find("#".concat(i)).remove();var a=l.closest(".diff-file");if(a.length>0){var c=new CustomEvent("blur.imageDiff",{detail:e});a[0].dispatchEvent(c)}if(C&&l.find("textarea.js-note-text").trigger("clear-commands-cache.atwho"),t.clearFlashWrapper(),p){r.find(".flash-container").remove(),v&&l.attr("data-discussion-id",n.data("discussionId")).attr("data-resolve-all","true").attr("data-project-path",n.data("projectPath"));var d=0===r.length;if(t.addDiscussionNote(l,s,d),d){var u=l.find("#note_position").val();if(a.length>0&&u.length>0){var f=JSON.parse(u),m=f.x,g=f.y,y=f.width,b=f.height,w=new CustomEvent("addBadge.imageDiff",{detail:{x:m,y:g,width:y,height:b,noteId:"note_".concat(s.id),discussionId:s.discussion_id}});a[0].dispatchEvent(w)}}r.length&&r.append('<div class="flash-container" style="display: none;"></div>')}else h&&(t.addNote(l,s),t.reenableTargetFormSubmitButton(e));s.commands_changes&&t.handleQuickActions(s),l.trigger("ajax:success",[s])}).catch(function(){r.find("#".concat(i)).remove(),n.prop("disabled",!1);var o=new CustomEvent("blur.imageDiff",{detail:e}),a=l.closest(".diff-file");if(a.length&&a[0].dispatchEvent(o),C&&r.find("#".concat(s)).remove(),p&&r.length){var c=r.parent().find(".js-discussion-reply-button");t.replyToDiscussionNote(c[0]),l=r.parent().find("form")}l.find(".js-note-text").val(k),t.reenableTargetFormSubmitButton(e),t.addNoteError(l)})}},{key:"updateComment",value:function(e){var t=this;e.preventDefault();var n=o()(e.target).parents("form"),i=n.find(".js-note-target-close"),s=n.parents(".note.is-editing"),r=s.find(".js-task-list-container").find(".note-text"),c=this.getFormData(n),l=c.formData,d=c.formContent,u=c.formAction,f=(n.closest(".diff-file"),n.closest(".notes"),r.html());return r.html(d),s.removeClass("is-editing fade-in-full").addClass("being-posted fade-in-half"),s.find(".note-headline-meta a").html('<i class="fa fa-spinner fa-spin" aria-label="Comment is being updated" aria-hidden="true"></i>'),m.a.post("".concat(u,"?html=true"),l).then(function(e){var n=e.data;t.updateNote(n,s)}).catch(function(){r.html(a.a.escape(f)),s.removeClass("being-posted fade-in"),s.find(".fa.fa-spinner").remove(),t.updateNoteError()}),i.text(i.data("originalText"))}}],[{key:"initCommentTypeToggle",value:function(e){var t=e.querySelector(".js-comment-type-dropdown .dropdown-toggle"),n=e.querySelector(".js-comment-type-dropdown .dropdown-menu"),i=e.querySelector("#note_type"),o=e.querySelector(".js-comment-type-dropdown .js-comment-submit-button"),s=e.querySelector(".js-note-target-close"),a=e.querySelector(".js-note-target-reopen");new j({dropdownTrigger:t,dropdownList:n,noteTypeInput:i,submitButton:o,closeButton:s,reopenButton:a}).initDroplab()}},{key:"updateNoteTargetSelector",value:function(e){var t=Object(v.a)(),n=Boolean(t&&e.filter("#".concat(t)).length>0);e.toggleClass("target",n)}},{key:"renderPlaceholderComponent",value:function(e){var t=e.find(".js-code-placeholder").get(0);new f.default({el:t,components:{GlSkeletonLoading:p.k},render:function(e){return e("gl-skeleton-loading")}})}},{key:"renderDiffContent",value:function(e,t){var n=t.discussion_html,i=o()(n).find(".line_holder");i.addClass("fade-in"),e.find(".diff-content > table > tbody").prepend(i);var s=e.find(".file-holder");e.find(".line-holder-placeholder").remove(),Object(h.a)(s)}},{key:"isNewNote",value:function(e,t){return-1===o.a.inArray(e.id,t)}},{key:"isUpdatedNote",value:function(e,t){return L(e.note.trim())!==L(t.find(".original-note-content").first().text().trim())}},{key:"checkMergeRequestStatus",value:function(){"merge_requests"===Object(S.h)(1)&&gl.mrWidget&&gl.mrWidget.checkStatus()}},{key:"animateAppendNote",value:function(e,t){var n=o()(e);return n.addClass("fade-in-full").renderGFM(),t.append(n),n}},{key:"animateUpdateNote",value:function(e,t){var n=o()(e);return n.addClass("fade-in").renderGFM(),t.replaceWith(n),n}}]),e}();window.Notes=F},261:function(e,t,n){(function(t){var n;n=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,n){var i,o,s,a,r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};i=function(e){return Array.prototype.slice.apply(e)},s=function(e,t){for(;e&&!e.classList.contains(t);)e=e.parentNode;return e},a=function(e,t){var n;return"function"==typeof Event?(n=new Event(e,{bubbles:!0,cancelable:!0})).detail=t:(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t),n},o=function(){function e(e){var t;this.el=e,this.container=s(this.el,"js-task-list-container"),this.field=this.container.querySelector(".js-task-list-field"),this.container.addEventListener("change",(t=this,function(e){if(e.target.classList.contains("task-list-item-checkbox"))return t.updateTaskList(e.target)})),this.enable()}return e.prototype.enable=function(){var e;if(this.container.querySelectorAll(".js-task-list-field").length>0)return i(this.container.querySelectorAll(".task-list-item")).forEach(function(e){return e.classList.add("enabled")}),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach(function(e){return e.disabled=!1}),this.container.classList.add("is-task-list-enabled"),e=a("tasklist:enabled"),this.container.dispatchEvent(e)},e.prototype.disable=function(){var e;return i(this.container.querySelectorAll(".task-list-item")).forEach(function(e){return e.classList.remove("enabled")}),i(this.container.querySelectorAll(".task-list-item-checkbox")).forEach(function(e){return e.disabled=!0}),this.container.classList.remove("is-task-list-enabled"),e=a("tasklist:disabled"),this.container.dispatchEvent(e)},e.prototype.updateTaskList=function(t){var n,o,s,r;if(s=this.container.querySelectorAll(".task-list-item-checkbox"),r=1+i(s).indexOf(t),n=a("tasklist:change",{index:r,checked:t.checked}),this.field.dispatchEvent(n),!n.defaultPrevented)return this.field.value=e.updateSource(this.field.value,r,t.checked),n=a("change"),this.field.dispatchEvent(n),o=a("tasklist:changed",{index:r,checked:t.checked}),this.field.dispatchEvent(o)},e.incomplete="[ ]",e.complete="[x]",e.escapePattern=function(e){return e.replace(/([\[\]])/g,"\\$1").replace(/\s/,"\\s").replace("x","[xX]")},e.incompletePattern=RegExp(""+e.escapePattern(e.incomplete)),e.completePattern=RegExp(""+e.escapePattern(e.complete)),e.itemPattern=RegExp("^(?:\\s*(?:>\\s*)*(?:[-+*]|(?:\\d+\\.)))\\s*("+e.escapePattern(e.complete)+"|"+e.escapePattern(e.incomplete)+")\\s+(?!\\(.*?\\))(?=(?:\\[.*?\\]\\s*(?:\\[.*?\\]|\\(.*?\\))\\s*)*(?:[^\\[]|$))"),e.startFencesPattern=/^`{3}.*$/,e.endFencesPattern=/^`{3}$/,e.itemsInParasPattern=RegExp("^("+e.escapePattern(e.complete)+"|"+e.escapePattern(e.incomplete)+").+$","g"),e.updateSource=function(e,t,n){var i,o,s,a;return i=e.replace(/\r/g,"").replace(this.itemsInParasPattern,"").split("\n"),s=0,o=!1,function(){var c,l,d,u;for(u=[],c=0,l=(d=e.split("\n")).length;c<l;c++)a=d[c],o?a.match(this.endFencesPattern)&&(o=!1):a.match(this.startFencesPattern)?o=!0:r.call(i,a)>=0&&a.match(this.itemPattern)&&(s+=1)===t&&(a=n?a.replace(this.incompletePattern,this.complete):a.replace(this.completePattern,this.incomplete)),u.push(a);return u}.call(this).join("\n")},e}(),void 0!==t&&(t.fn.taskList=function(e){return this.each(function(n,i){var s;if((s=t(i).data("task-list"))||(s=new o(i),t(i).data("task-list",s),e&&"enable"!==e))return s[e||"enable"]()})}),e.exports=o}])},e.exports=n()}).call(this,n(0))},27:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(2),o=n.n(i),s=n(4),a=n(43);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=c(this,l(t).call(this)),o.a.bind("g p",function(){return Object(s.a)(".shortcuts-project")}),o.a.bind("g v",function(){return Object(s.a)(".shortcuts-project-activity")}),o.a.bind("g r",function(){return Object(s.a)(".shortcuts-project-releases")}),o.a.bind("g f",function(){return Object(s.a)(".shortcuts-tree")}),o.a.bind("g c",function(){return Object(s.a)(".shortcuts-commits")}),o.a.bind("g j",function(){return Object(s.a)(".shortcuts-builds")}),o.a.bind("g n",function(){return Object(s.a)(".shortcuts-network")}),o.a.bind("g d",function(){return Object(s.a)(".shortcuts-repository-charts")}),o.a.bind("g i",function(){return Object(s.a)(".shortcuts-issues")}),o.a.bind("g b",function(){return Object(s.a)(".shortcuts-issue-boards")}),o.a.bind("g m",function(){return Object(s.a)(".shortcuts-merge_requests")}),o.a.bind("g w",function(){return Object(s.a)(".shortcuts-wiki")}),o.a.bind("g s",function(){return Object(s.a)(".shortcuts-snippets")}),o.a.bind("g k",function(){return Object(s.a)(".shortcuts-kubernetes")}),o.a.bind("g e",function(){return Object(s.a)(".shortcuts-environments")}),o.a.bind("g l",function(){return Object(s.a)(".shortcuts-metrics")}),o.a.bind("i",function(){return Object(s.a)(".shortcuts-new-issue")}),e.enabledHelp.push(".hidden-shortcut.project"),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,a["a"]),t}()},28:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(12),a=n(31);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.projectSelectInput=o()(t),this.newItemBtn=o()(".new-project-item-link"),this.resourceType=this.newItemBtn.data("type"),this.resourceLabel=this.newItemBtn.data("label"),this.formattedText=this.deriveTextVariants(),this.groupId=this.projectSelectInput.data("groupId"),this.bindEvents(),this.initLocalStorage()}var t,n,i;return t=e,(n=[{key:"bindEvents",value:function(){var e=this;this.projectSelectInput.siblings(".new-project-item-select-button").on("click",function(t){return e.openDropdown(t)}),this.newItemBtn.on("click",function(t){e.getProjectFromLocalStorage()||(t.preventDefault(),e.openDropdown(t))}),this.projectSelectInput.on("change",function(){return e.selectProject()})}},{key:"initLocalStorage",value:function(){a.a.isLocalStorageAccessSafe()&&(this.localStorageKey=["group",this.groupId,this.formattedText.localStorageItemType,"recent-project"].join("-"),this.setBtnTextFromLocalStorage())}},{key:"openDropdown",value:function(e){o()(e.currentTarget).siblings(".project-item-select").select2("open")}},{key:"selectProject",value:function(){var e=JSON.parse(this.projectSelectInput.val()),t={url:"".concat(e.url,"/").concat(this.projectSelectInput.data("relativePath")),name:e.name};this.setNewItemBtnAttributes(t),this.setProjectInLocalStorage(t)}},{key:"setBtnTextFromLocalStorage",value:function(){var e=this.getProjectFromLocalStorage();this.setNewItemBtnAttributes(e)}},{key:"setNewItemBtnAttributes",value:function(e){e?(this.newItemBtn.attr("href",e.url),this.newItemBtn.text("".concat(this.formattedText.defaultTextPrefix," in ").concat(e.name))):this.newItemBtn.text("Select project to create ".concat(this.formattedText.presetTextSuffix))}},{key:"getProjectFromLocalStorage",value:function(){var e=localStorage.getItem(this.localStorageKey);return JSON.parse(e)}},{key:"setProjectInLocalStorage",value:function(e){var t=JSON.stringify(e);localStorage.setItem(this.localStorageKey,t)}},{key:"deriveTextVariants",value:function(){var e=this.resourceLabel;return{localStorageItemType:"new-".concat(this.resourceType.split("_").join("-").slice(0,-1)),defaultTextPrefix:e,presetTextSuffix:this.resourceType.split("_").join(" ").slice(0,-1)}}}])&&r(t.prototype,n),i&&r(t,i),e}();function l(){o()(".ajax-project-select").each(function(e,t){var n,i,a=o()(t).data("simpleFilter")||!1;return this.groupId=o()(t).data("groupId"),this.includeGroups=o()(t).data("includeGroups"),this.allProjects=o()(t).data("allProjects")||!1,this.orderBy=o()(t).data("orderBy")||"id",this.withIssuesEnabled=o()(t).data("withIssuesEnabled"),this.withMergeRequestsEnabled=o()(t).data("withMergeRequestsEnabled"),this.withShared=void 0===o()(t).data("withShared")||o()(t).data("withShared"),this.includeProjectsInSubgroups=o()(t).data("includeProjectsInSubgroups")||!1,this.allowClear=o()(t).data("allowClear")||!1,n="Search for project",this.includeGroups&&(n+=" or group"),o()(t).select2({placeholder:n,minimumInputLength:0,query:(i=this,function(e){var t,n;return t=function(t){var n;return n={results:t},e.callback(n)},n=i.includeGroups?function(n){var i;return i=function(e){var i;return i=e.concat(n),t(i)},s.a.groups(e.term,{},i)}:t,i.groupId?s.a.groupProjects(i.groupId,e.term,{with_issues_enabled:i.withIssuesEnabled,with_merge_requests_enabled:i.withMergeRequestsEnabled,with_shared:i.withShared,include_subgroups:i.includeProjectsInSubgroups},n):s.a.projects(e.term,{order_by:i.orderBy,with_issues_enabled:i.withIssuesEnabled,with_merge_requests_enabled:i.withMergeRequestsEnabled,membership:!i.allProjects},n)}),id:function(e){return a?e.id:JSON.stringify({name:e.name,url:e.web_url})},text:function(e){return e.name_with_namespace||e.name},initSelection:function(e,t){return s.a.project(e.val()).then(function(e){var n=e.data;return t(n)})},allowClear:this.allowClear,dropdownCssClass:"ajax-project-dropdown"}),a?t:new c(t)})}n.d(t,"a",function(){return l})},29:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(0),o=n.n(i),s=n(14),a=n.n(s),r=n(1),c=n(19),l=n(6),d=n(7),u=n(28);function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=o()("ul.clone-options-dropdown"),n=o()("#project_clone"),i=o()(".js-git-clone-holder .js-clone-dropdown-label"),s=document.querySelector(".js-mobile-git-clone .js-clone-dropdown-label"),r=i.text().trim();r.length>0&&o()("a:contains('".concat(r,"')"),t).addClass("is-active"),o()("a",t).on("click",function(e){e.preventDefault();var i=o()(e.currentTarget),a=i.attr("href"),r=i.data("cloneType");o()(".is-active",t).removeClass("is-active"),o()('a[data-clone-type="'.concat(r,'"]')).each(function(){var e=o()(this),t=e.find(".dropdown-menu-inner-title").text(),n=e.closest(".project-clone-holder").find(".js-clone-dropdown-label");e.toggleClass("is-active"),n.text(t)}),s?s.dataset.clipboardText=a:n.val(a),o()(".js-git-empty .js-clone").text(a)}),e.initRefSwitcher(),o()(".project-refs-select").on("change",function(){return o()(this).parents("form").submit()}),o()(".hide-no-ssh-message").on("click",function(e){return a.a.set("hide_no_ssh_message","false"),o()(this).parents(".no-ssh-key-message").remove(),e.preventDefault()}),o()(".hide-no-password-message").on("click",function(e){return a.a.set("hide_no_password_message","false"),o()(this).parents(".no-password-message").remove(),e.preventDefault()}),o()(".hide-auto-devops-implicitly-enabled-banner").on("click",function(e){var t=o()(this).data("project-id"),n="hide_auto_devops_implicitly_enabled_banner_".concat(t);return a.a.set(n,"false"),o()(this).parents(".auto-devops-implicitly-enabled-banner").remove(),e.preventDefault()}),e.projectSelectDropdown()}var t,n,i;return t=e,i=[{key:"projectSelectDropdown",value:function(){Object(u.a)(),o()(".project-item-select").on("click",function(t){return e.changeProject(o()(t.currentTarget).val())})}},{key:"changeProject",value:function(e){return window.location=e}},{key:"initRefSwitcher",value:function(){var e=document.createElement("li"),t=document.createElement("a");return t.href="#",o()(".js-project-refs-dropdown").each(function(){var n,i;return n=o()(this),i=n.data("selected"),n.glDropdown({data:function(e,t){l.a.get(n.data("refsUrl"),{params:{ref:n.data("ref"),search:e}}).then(function(e){var n=e.data;return t(n)}).catch(function(){return Object(d.a)(Object(r.a)("An error occurred while getting projects"))})},selectable:!0,filterable:!0,filterRemote:!0,filterByText:!0,inputFieldName:n.data("inputFieldName"),fieldName:n.data("fieldName"),renderRow:function(n){var o=e.cloneNode(!1);if(null!=n.header)o.className="dropdown-header",o.textContent=n.header;else{var s=t.cloneNode(!1);n===i&&(s.className="is-active"),s.textContent=n,s.dataset.ref=n,o.appendChild(s)}return o},id:function(e,t){return t.attr("data-ref")},toggleLabel:function(e,t){return t.text().trim()},clicked:function(e){if(e.e.preventDefault(),o()('input[name="ref"]').length){var t=n.closest("form"),i=n.data("visit"),s=!!i||i,a=t.attr("action"),r=-1===a.indexOf("?")?"?":"&";s&&Object(c.g)("".concat(a).concat(r).concat(t.serialize()))}}})})}}],(n=null)&&f(t.prototype,n),i&&f(t,i),e}()},295:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(160);t.a=function(e){Object(s.b)(document.querySelector(".js-diff-files-changed"),e),o()(".js-diff-stats-dropdown").glDropdown({filterable:!0,remoteFilter:!1})}},360:function(e,t,n){"use strict";var i=n(224);t.a=function(){var e=document.querySelector(".js-notes-data"),t=JSON.parse(e.innerHTML),n=t.notesUrl,o=t.notesIds,s=t.now,a=t.diffView,r=t.enableGFM;i.a.initialize(n,o,s,a,r)}},44:function(e,t,n){"use strict";n.r(t);var i=n(38),o=n(36),s=n(29),a=n(27);document.addEventListener("DOMContentLoaded",function(){var e=document.body.dataset.page;if(["projects:clusters:new","projects:clusters:create_gcp","projects:clusters:create_user"].indexOf(e)>-1){var t=document.querySelector(".gcp-signup-offer");t&&new o.a(t),Object(i.a)()}new s.a,new a.a})},485:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(0),o=n.n(i),s=n(7),a=n(6);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t.container||"",this.dropdownListSelector=".js-builds-dropdown-container",this.getBuildsList=this.getBuildsList.bind(this)}var t,n,i;return t=e,(n=[{key:"bindEvents",value:function(){o()(document).off("shown.bs.dropdown",this.container).on("shown.bs.dropdown",this.container,this.getBuildsList)}},{key:"stopDropdownClickPropagation",value:function(){o()(document).on("click","".concat(this.container," .js-builds-dropdown-list a.mini-pipeline-graph-dropdown-item"),function(e){e.stopPropagation()})}},{key:"renderBuildsList",value:function(e,t){e.parentElement.querySelector("".concat(this.dropdownListSelector," .js-builds-dropdown-list ul")).innerHTML=t}},{key:"getBuildsList",value:function(e){var t=this,n=e.relatedTarget,i=n.dataset.stageEndpoint;this.renderBuildsList(n,""),this.toggleLoading(n),a.a.get(i).then(function(e){var i=e.data;t.toggleLoading(n),t.renderBuildsList(n,i.html),t.stopDropdownClickPropagation()}).catch(function(){t.toggleLoading(n),o()(n).parent().hasClass("open")&&o()(n).dropdown("toggle"),Object(s.a)("An error occurred while fetching the builds.","alert")})}},{key:"toggleLoading",value:function(e){e.parentElement.querySelector("".concat(this.dropdownListSelector," .js-builds-dropdown-loading")).classList.toggle("hidden")}}])&&r(t.prototype,n),i&&r(t,i),e}()},79:function(e,t,n){"use strict";var i=n(0),o=n.n(i),s=n(62),a=n.n(s),r=n(66),c=n(32),l=n.n(c),d=n(5),u=n.n(d),f=(n(173),n(75)),h=n(6);function p(e){var t,n,i,s,a,r,c,d=e.find(".button-attach-file"),p=e.find(".attaching-file-message"),m=e.find(".button-cancel-uploading-files"),v=e.find(".retry-uploading-link"),g=e.find(".uploading-progress"),y=e.find(".uploading-error-container"),b=e.find(".uploading-error-message"),w=e.find(".uploading-progress-container"),k=e.data("uploads-path")||window.uploads_path||null,C=gon.max_file_size||10,j=e.find(".js-gfm-input");j.wrap('<div class="div-dropzone"></div>'),j.on("paste",function(e){return t(e)});var _=j.closest(".md-area");e.setupMarkdownPreview();var x=e.find(".div-dropzone");if(x.parent().addClass("div-dropzone-wrapper"),x.append('<div class="div-dropzone-hover"></div>'),x.find(".div-dropzone-hover").append('<i class="fa fa-paperclip div-dropzone-icon"></i>'),!k)return x.addClass("js-invalid-dropzone"),null;var E=x.dropzone({url:k,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:C,uploadMultiple:!1,headers:f.a.headers,previewContainer:!1,processing:function(){return o()(".div-dropzone-alert").alert("close")},dragover:function(){_.addClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){_.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0)},drop:function(){_.removeClass("is-dropzone-hover"),e.find(".div-dropzone-hover").css("opacity",0),j.focus()},success:function(e,t){var o=this.getQueuedFiles().length+this.getUploadingFiles().length,s=o>=1;n(t.link.markdown,s),o||d.removeClass("hide"),i(t.link.url)},error:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Attaching the file failed.",i=arguments.length>2?arguments[2]:void 0,o=!(t=n||i.responseText)||u.a.isString(t)?t:t.message;y.removeClass("hide"),b.html(o),d.addClass("hide"),m.addClass("hide")},totaluploadprogress:function(e){s(this.files,p),g.text("".concat(Math.round(e),"%"))},sending:function(){d.addClass("hide"),y.addClass("hide"),w.removeClass("hide"),m.removeClass("hide")},removedfile:function(){d.removeClass("hide"),m.addClass("hide"),w.addClass("hide"),y.addClass("hide")},queuecomplete:function(){o()(".dz-preview").remove(),o()(".markdown-area").trigger("input"),w.addClass("hide"),m.addClass("hide")}}),T=o()(E[0]).children("textarea");m.on("click",function(e){e.preventDefault(),e.stopPropagation(),l.a.forElement(x.get(0)).removeAllFiles(!0)}),v.on("click",function(e){var t=l.a.forElement(e.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=t.files;e.preventDefault(),t.removeAllFiles(!0),n.map(function(e){var n=e;return n.status===l.a.ERROR&&(n.status=void 0,n.accepted=void 0),t.addFile(n)})}),t=function(e){var t=e.originalEvent;if(t.clipboardData&&t.clipboardData.items){var i=a(t);if(i){e.preventDefault();var o=r(t)||"image.png",s="{{".concat(o,"}}");return n(s),c(i.getAsFile(),o)}}},a=function(e){for(var t=0;t<e.clipboardData.items.length;){var n=e.clipboardData.items[t];if(-1!==n.type.indexOf("image"))return n;t+=1}return!1},n=function(e,t){var n=e;t&&(n+="\n\n");var i=T.get(0),s=i.selectionStart,a=i.selectionEnd,r=o()(T).val().length,c=o()(T).val().substring(0,s),l=o()(T).val().substring(a,r);return o()(T).val(c+n+l),i.setSelectionRange(s+n.length,a+n.length),i.style.height="".concat(i.scrollHeight,"px"),j.get(0).dispatchEvent(new Event("input")),j.trigger("input")},i=function(t){o()(e).append('<input type="hidden" name="files[]" value="'.concat(u.a.escape(t),'">'))},r=function(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),(t=t.split("\r"))[0]};var S=function(){return w.addClass("hide")};return c=function(t,n){var i=new FormData;i.append("file",t,n),w.removeClass("hide"),e.find(".div-dropzone-alert").alert("close"),h.a.post(k,i).then(function(e){var t=e.data.link.markdown;!function(e,t){var n=o()(T);n.val(function(n,i){return i.replace("{{".concat(e,"}}"),t)}),n.trigger("change")}(n,t),S()}).catch(function(e){var t;t=e.response.data.message,y.removeClass("hide"),b.html(t),S()})},s=function(e,t){var n,i=e.filter(function(e){return"uploading"===e.status||"queued"===e.status}).length;n=i>1?"Attaching ".concat(i," files -"):"Attaching a file -",t.text(n)},e.find(".markdown-selector").click(function(e){e.preventDefault(),o()(this).closest(".gfm-form").find(".div-dropzone").click(),j.focus()}),l.a.forElement(x.get(0))}l.a.autoDiscover=!1;var m=n(76);function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"a",function(){return g});var g=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM=Object.assign({},r.b,i);var o=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach(function(e){"emojis"!==e&&(n.enableGFM[e]=!!o[e])}),this.destroy(),this.setupForm(),this.form.data("glForm",this)}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.form.data("glForm",null)}},{key:"setupForm",value:function(){var e=this.form.is(":not(.gfm-form)");this.form.removeClass("js-new-note-form"),e&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),gl.utils.disableButtonIfEmptyField(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new r.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),p(this.form),a()(this.textarea)),this.addEventListeners(),Object(m.b)(this.form),this.form.show(),this.isAutosizeable&&this.setupAutosize()}},{key:"setupAutosize",value:function(){var e=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout(function(){a()(e.textarea),e.textarea.css("resize","vertical")},0)}},{key:"setHeightData",value:function(){this.textarea.data("height",this.textarea.outerHeight())}},{key:"destroyAutosize",value:function(){var e=this.textarea.outerHeight();this.textarea.data("height")!==e&&(a.a.destroy(this.textarea),this.textarea.data("height",e),this.textarea.outerHeight(e),this.textarea.css("max-height",window.outerHeight))}},{key:"clearEventListeners",value:function(){this.textarea.off("focus"),this.textarea.off("blur"),Object(m.c)(this.form)}},{key:"addEventListeners",value:function(){this.textarea.on("focus",function(){o()(this).closest(".md-area").addClass("is-focused")}),this.textarea.on("blur",function(){o()(this).closest(".md-area").removeClass("is-focused")})}}])&&v(t.prototype,n),i&&v(t,i),e}()},800:function(e,t){e.exports='<svg width="11" height="11" viewBox="0 0 9 13"><path d="M2.57568253,6.49866948 C2.50548852,6.57199715 2.44637866,6.59708255 2.39835118,6.57392645 C2.3503237,6.55077034 2.32631032,6.48902165 2.32631032,6.38867852 L2.32631032,-2.13272614 C2.32631032,-2.23306927 2.3503237,-2.29481796 2.39835118,-2.31797406 C2.44637866,-2.34113017 2.50548852,-2.31604477 2.57568253,-2.24271709 L6.51022184,1.86747129 C6.53977721,1.8983461 6.56379059,1.93500939 6.5822627,1.97746225 L6.5822627,2.27849013 C6.56379059,2.31708364 6.53977721,2.35374693 6.51022184,2.38848109 L2.57568253,6.49866948 Z" transform="translate(4.454287, 2.127976) rotate(90.000000) translate(-4.454287, -2.127976) "></path><path d="M3.74312342,2.09553332 C3.74312342,1.99519019 3.77821989,1.9083561 3.8484139,1.83502843 C3.91860791,1.76170075 4.00173115,1.72503747 4.09778611,1.72503747 L4.80711151,1.72503747 C4.90316647,1.72503747 4.98628971,1.76170075 5.05648372,1.83502843 C5.12667773,1.9083561 5.16177421,1.99519019 5.16177421,2.09553332 L5.16177421,10.2464421 C5.16177421,10.3467853 5.12667773,10.4336194 5.05648372,10.506947 C4.98628971,10.5802747 4.90316647,10.616938 4.80711151,10.616938 L4.09778611,10.616938 C4.00173115,10.616938 3.91860791,10.5802747 3.8484139,10.506947 C3.77821989,10.4336194 3.74312342,10.3467853 3.74312342,10.2464421 L3.74312342,2.09553332 Z" transform="translate(4.452449, 6.170988) rotate(-90.000000) translate(-4.452449, -6.170988) "></path><path d="M2.57568253,14.6236695 C2.50548852,14.6969971 2.44637866,14.7220826 2.39835118,14.6989264 C2.3503237,14.6757703 2.32631032,14.6140216 2.32631032,14.5136785 L2.32631032,5.99227386 C2.32631032,5.89193073 2.3503237,5.83018204 2.39835118,5.80702594 C2.44637866,5.78386983 2.50548852,5.80895523 2.57568253,5.88228291 L6.51022184,9.99247129 C6.53977721,10.0233461 6.56379059,10.0600094 6.5822627,10.1024622 L6.5822627,10.4034901 C6.56379059,10.4420836 6.53977721,10.4787469 6.51022184,10.5134811 L2.57568253,14.6236695 Z" transform="translate(4.454287, 10.252976) scale(1, -1) rotate(90.000000) translate(-4.454287, -10.252976) "></path></svg>\n'},85:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(0),o=n.n(i),s=(n(172),n(32)),a=n.n(s),r=n(2),c=n.n(r);n(111);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}a.a.autoDiscover=!1;var d=function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_backdrop=null,this.active_textarea=null,o()(document).on("click",".js-zen-enter",function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:enter")}),o()(document).on("click",".js-zen-leave",function(e){return e.preventDefault(),o()(e.currentTarget).trigger("zen_mode:leave")}),o()(document).on("zen_mode:enter",(t=this,function(e){return t.enter(o()(e.target).closest(".md-area").find(".zen-backdrop"))})),o()(document).on("zen_mode:leave",function(e){return function(t){return e.exit()}}(this)),o()(document).on("keydown",function(e){if(27===e.keyCode)return e.preventDefault(),o()(document).trigger("zen_mode:leave")})}var t,n,i;return t=e,(n=[{key:"enter",value:function(e){c.a.pause(),this.active_backdrop=o()(e),this.active_backdrop.addClass("fullscreen"),this.active_textarea=this.active_backdrop.find("textarea"),this.active_textarea.removeAttr("style"),this.active_textarea.focus()}},{key:"exit",value:function(){if(this.active_textarea){c.a.unpause(),this.active_textarea.closest(".zen-backdrop").removeClass("fullscreen"),this.scrollTo(this.active_textarea),this.active_textarea=null,this.active_backdrop=null;var e=o()(".div-dropzone");e&&!e.hasClass("js-invalid-dropzone")&&a.a.forElement(".div-dropzone").enable()}}},{key:"scrollTo",value:function(e){return o.a.scrollTo(e,0,{offset:-150})}}])&&l(t.prototype,n),i&&l(t,i),e}()}},[[1236,1,0,2,3]]]);
//# sourceMappingURL=pages.projects.commit.show.299aa377.chunk.js.map