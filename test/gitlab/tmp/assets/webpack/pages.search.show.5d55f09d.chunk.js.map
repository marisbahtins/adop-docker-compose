{"version":3,"sources":["webpack:///./pages/search/show/search.js","webpack:///./pages/search/show/index.js"],"names":["Search","_this","this","_classCallCheck","$groupDropdown","$","$projectDropdown","searchInput","searchClear","groupId","data","eventListeners","glDropdown","selectable","filterable","filterRemote","fieldName","search","fields","term","callback","Api","groups","unshift","full_name","splice","id","obj","text","toggleLabel","concat","clicked","submitSearch","getProjectsData","then","name_with_namespace","catch","Flash","submit","document","off","on","searchKeyUp","clearSearchField","bind","val","addClass","removeClass","trigger","focus","_this2","Promise","resolve","groupProjects","projects","order_by","addEventListener"],"mappings":"2VAIqBA,aACnB,SAAAA,IAAc,IAAAC,EAAAC,kGAAAC,CAAAD,KAAAF,GACZ,IAAMI,EAAiBC,IAAE,6BACnBC,EAAmBD,IAAE,+BAE3BH,KAAKK,YAAc,mBACnBL,KAAKM,YAAc,mBAEnBN,KAAKO,QAAUL,EAAeM,KAAK,WACnCR,KAAKS,iBAELP,EAAeQ,YACbC,YAAY,EACZC,YAAY,EACZC,cAAc,EACdC,UAAW,WACXC,QACEC,QAAS,cAEXR,KARwB,SAQnBS,EAAMC,GACT,OAAOC,IAAIC,OAAOH,KAAU,SAAAT,GAK1B,OAJAA,EAAKa,SACHC,UAAW,QAEbd,EAAKe,OAAO,EAAG,EAAG,WACXL,EAASV,MAGpBgB,GAjBwB,SAiBrBC,GACD,OAAOA,EAAID,IAEbE,KApBwB,SAoBnBD,GACH,OAAOA,EAAIH,WAEbK,YAvBwB,SAuBZF,GACV,SAAAG,OAAU1B,EAAeM,KAAK,gBAA9B,KAAAoB,OAAiDH,EAAIH,YAEvDO,QAAS,kBAAM/B,EAAOgC,kBAGxB1B,EAAiBM,YACfC,YAAY,EACZC,YAAY,EACZC,cAAc,EACdC,UAAW,aACXC,QACEC,QAAS,SAEXR,KAAM,SAACS,EAAMC,GACXnB,EAAKgC,gBAAgBd,GAClBe,KAAK,SAAAxB,GAMJ,OALAA,EAAKa,SACHY,oBAAqB,QAEvBzB,EAAKe,OAAO,EAAG,EAAG,WAEXf,IAERwB,KAAK,SAAAxB,GAAI,OAAIU,EAASV,KACtB0B,MAAM,kBAAM,IAAIC,IAAM,8BAE3BX,GArB0B,SAqBvBC,GACD,OAAOA,EAAID,IAEbE,KAxB0B,SAwBrBD,GACH,OAAOA,EAAIQ,qBAEbN,YA3B0B,SA2BdF,GACV,SAAAG,OAAUxB,EAAiBI,KAAK,gBAAhC,KAAAoB,OAAmDH,EAAIQ,sBAEzDJ,QAAS,kBAAM/B,EAAOgC,+EAcxB,OAAO3B,IAAE,mBAAmBiC,uDAT5BjC,IAAEkC,UACCC,IAAI,QAAStC,KAAKK,aAClBkC,GAAG,QAASvC,KAAKK,YAAaL,KAAKwC,aACtCrC,IAAEkC,UACCC,IAAI,QAAStC,KAAKM,aAClBiC,GAAG,QAASvC,KAAKM,YAAaN,KAAKyC,iBAAiBC,KAAK1C,6CASvC,KADNG,IAAEH,MACN2C,MACTxC,IAAE,oBAAoByC,SAAS,UAE/BzC,IAAE,oBAAoB0C,YAAY,qDAKpC,OAAO1C,IAAEH,KAAKK,aACXsC,IAAI,IACJG,QAAQ,SACRC,gDAGW9B,GAAM,IAAA+B,EAAAhD,KACpB,OAAO,IAAIiD,QAAQ,SAAAC,GACbF,EAAKzC,QACPY,IAAIgC,cAAcH,EAAKzC,QAASU,KAAUiC,GAE1C/B,IAAIiC,SACFnC,GAEEoC,SAAU,MAEZH,0CCnHVb,SAASiB,iBAAiB,mBAAoB,kBAAM,IAAIxD","file":"pages.search.show.5d55f09d.chunk.js","sourcesContent":["import $ from 'jquery';\nimport Flash from '~/flash';\nimport Api from '~/api';\n\nexport default class Search {\n  constructor() {\n    const $groupDropdown = $('.js-search-group-dropdown');\n    const $projectDropdown = $('.js-search-project-dropdown');\n\n    this.searchInput = '.js-search-input';\n    this.searchClear = '.js-search-clear';\n\n    this.groupId = $groupDropdown.data('groupId');\n    this.eventListeners();\n\n    $groupDropdown.glDropdown({\n      selectable: true,\n      filterable: true,\n      filterRemote: true,\n      fieldName: 'group_id',\n      search: {\n        fields: ['full_name'],\n      },\n      data(term, callback) {\n        return Api.groups(term, {}, data => {\n          data.unshift({\n            full_name: 'Any',\n          });\n          data.splice(1, 0, 'divider');\n          return callback(data);\n        });\n      },\n      id(obj) {\n        return obj.id;\n      },\n      text(obj) {\n        return obj.full_name;\n      },\n      toggleLabel(obj) {\n        return `${$groupDropdown.data('defaultLabel')} ${obj.full_name}`;\n      },\n      clicked: () => Search.submitSearch(),\n    });\n\n    $projectDropdown.glDropdown({\n      selectable: true,\n      filterable: true,\n      filterRemote: true,\n      fieldName: 'project_id',\n      search: {\n        fields: ['name'],\n      },\n      data: (term, callback) => {\n        this.getProjectsData(term)\n          .then(data => {\n            data.unshift({\n              name_with_namespace: 'Any',\n            });\n            data.splice(1, 0, 'divider');\n\n            return data;\n          })\n          .then(data => callback(data))\n          .catch(() => new Flash('Error fetching projects'));\n      },\n      id(obj) {\n        return obj.id;\n      },\n      text(obj) {\n        return obj.name_with_namespace;\n      },\n      toggleLabel(obj) {\n        return `${$projectDropdown.data('defaultLabel')} ${obj.name_with_namespace}`;\n      },\n      clicked: () => Search.submitSearch(),\n    });\n  }\n\n  eventListeners() {\n    $(document)\n      .off('keyup', this.searchInput)\n      .on('keyup', this.searchInput, this.searchKeyUp);\n    $(document)\n      .off('click', this.searchClear)\n      .on('click', this.searchClear, this.clearSearchField.bind(this));\n  }\n\n  static submitSearch() {\n    return $('.js-search-form').submit();\n  }\n\n  searchKeyUp() {\n    const $input = $(this);\n    if ($input.val() === '') {\n      $('.js-search-clear').addClass('hidden');\n    } else {\n      $('.js-search-clear').removeClass('hidden');\n    }\n  }\n\n  clearSearchField() {\n    return $(this.searchInput)\n      .val('')\n      .trigger('keyup')\n      .focus();\n  }\n\n  getProjectsData(term) {\n    return new Promise(resolve => {\n      if (this.groupId) {\n        Api.groupProjects(this.groupId, term, {}, resolve);\n      } else {\n        Api.projects(\n          term,\n          {\n            order_by: 'id',\n          },\n          resolve,\n        );\n      }\n    });\n  }\n}\n","import Search from './search';\n\ndocument.addEventListener('DOMContentLoaded', () => new Search());\n"],"sourceRoot":""}