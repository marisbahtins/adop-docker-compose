{"version":3,"sources":["webpack:///./autosave.js","webpack:////home/git/gitlab/node_modules/mousetrap/plugins/pause/mousetrap-pause.js","webpack:///./image_diff/helpers/badge_helper.js","webpack:///./image_diff/helpers/comment_indicator_helper.js","webpack:///./image_diff/image_badge.js","webpack:///./image_diff/image_diff.js","webpack:///./lib/utils/image_utility.js","webpack:///./image_diff/view_types.js","webpack:///./image_diff/replaced_image_diff.js","webpack:///./commit/image_file.js","webpack:///./image_diff/helpers/index.js","webpack:///./image_diff/helpers/dom_helper.js","webpack:///./image_diff/helpers/utils_helper.js","webpack:///./pages/projects/snippets/show/index.js","webpack:///./task_list.js","webpack:///./droplab/plugins/input_setter.js","webpack:///./blob/viewer/index.js","webpack:///./comment_type_toggle.js","webpack:///./notes.js","webpack:////home/git/gitlab/node_modules/deckar01-task_list/dist/task_list.js","webpack:///./behaviors/shortcuts/shortcuts_navigation.js","webpack:///./project_select_combo_button.js","webpack:///./project_select.js","webpack:///./pages/projects/project.js","webpack:///./line_highlighter.js","webpack:///./init_notes.js","webpack:///./pages/projects/index.js","webpack:///./snippet/snippet_embed.js","webpack:///./dropzone_input.js","webpack:///./gl_form.js","webpack:///./zen_mode.js"],"names":["Autosave","field","key","_this","this","_classCallCheck","isLocalStorageAvailable","AccessorUtilities","isLocalStorageAccessSafe","join","data","restore","on","save","length","text","window","localStorage","getItem","val","trigger","event","Event","bubbles","cancelable","get","dispatchEvent","setItem","reset","removeItem","off","Mousetrap","self","_originalStopCallback","stopCallback","enabled","e","element","combo","pause","unpause","createImageBadge","noteId","_ref","x","y","classNames","arguments","undefined","buttonEl","document","createElement","concat","forEach","className","classList","add","setAttribute","dataset","style","left","top","addCommentIndicator","containerEl","innerHTML","gl","utils","spriteIcon","appendChild","defaultMeta","width","height","ImageBadge","options","discussionId","actual","browser","imageEl","imageDiffHelper","resizeCoordinatesToImageElement","ImageDiff","el","image_diff_classCallCheck","canCreateNote","renderCommentBadge","$noteContainer","$","imageBadges","imageFrameEl","querySelector","bindEvents","imageClickedWrapper","imageClicked","bind","imageBlurredWrapper","removeCommentIndicator","addBadgeWrapper","addBadge","removeBadgeWrapper","removeBadge","renderBadgesWrapper","renderBadges","complete","naturalHeight","addEventListener","toggleCollapsed","commentIndicatorOnClick","customEvent","detail","selection","getTargetSelection","currentTarget","setPositionDataAttribute","showCommentIndicator","_toConsumableArray","querySelectorAll","renderBadge","discussionEl","index","imageBadge","generateBadgeFromDiscussionDOM","push","coordinate","addImageCommentBadge","numberBadgeOptions","Object","assign","badgeText","addImageBadge","_event$detail","addAvatarBadge","badgeNumber","updateDiscussionBadgeNumber","indexToRemove","imageBadgeEls","badge","updatedBadgeNumber","innerText","updateDiscussionAvatarBadgeNumber","splice","remove","viewTypes","TWO_UP","SWIPE","ONION_SKIN","ReplacedImageDiff","_this$imageFrameEls","_this$viewModesEls","defaultViewType","imageFrameEls","_defineProperty","viewModesEl","viewModesEls","currentView","generateImageEls","imageEls","getOwnPropertyNames","viewType","_get","_getPrototypeOf","prototype","call","changeToViewTwoUp","changeView","changeToViewSwipe","changeToViewOnionSkin","newView","validate","find","indicator","replaced_image_diff_toConsumableArray","map","setTimeout","renderNewView","removed","normalizedIndicator","image","availWidth","viewModes","ImageFile","file","image_file_classCallCheck","two-up","each","wrap","requestImageInfo","removeClass","swipe","maxHeight","maxWidth","view","_ref2","$swipeWrap","$swipeBar","$swipeFrame","wrapPadding","_slicedToArray","prepareFrames","css","parseInt","replace","initDraggable","onion-skin","dragTrackWidth","_ref4","$frame","$track","$dragger","$frameAdded","framePadding","opacity","deletedWidth","deletedHeight","initViewModes","waitForImages","initView","viewMode","hasClass","activateViewMode","filter","addClass","fadeOut","fadeIn","views","$el","padding","callback","dragging","$body","$offsetEl","parent","pageX","offset","frame","img","domImg","naturalWidth","helpers","__webpack_exports__","commentIndicatorHelper","commentIndicatorEl","willRemove","meta","stopPropagation","closest","focus","_ref3","avatarBadgeEl","position","positionObject","JSON","parse","stringify","newBadgeNumber","discussionNotesEl","formEl","isCollapsed","contains","display","imageWidth","imageHeight","widthRatio","heightRatio","Math","round","firstNoteEl","id","offsetX","offsetY","actualWidth","actualHeight","normalizedX","max","min","normalizedY","initImageDiff","fileEl","diff","init","__webpack_require__","r","_init_notes__WEBPACK_IMPORTED_MODULE_0__","_zen_mode__WEBPACK_IMPORTED_MODULE_1__","_line_highlighter__WEBPACK_IMPORTED_MODULE_2__","_blob_viewer__WEBPACK_IMPORTED_MODULE_3__","_snippet_snippet_embed__WEBPACK_IMPORTED_MODULE_4__","LineHighlighter","BlobViewer","initNotes","ZenMode","snippetEmbed","TaskList","selector","dataType","fieldName","onSuccess","onError","errorMessages","response","_typeof","errors","Flash","disable","taskList","update","$target","target","patchData","axios","patch","attr","then","catch","err","InputSetter","hook","destroyed","config","eventWrapper","addEvents","setInputs","list","removeEvents","removeEventListener","selectedItem","selected","Array","isArray","setInput","input","newValue","getAttribute","valueAttribute","inputAttribute","hasAttribute","tagName","value","textContent","destroy","initAuxiliaryViewer","initRichViewer","initMainViewers","auxiliaryViewer","loadViewer","viewer","richType","initViewer","promise","module","default","error","Promise","all","viewerParam","url","resolve","html","$fileHolder","switcher","switcherBtns","copySourceBtn","simpleViewer","richViewer","initBindings","switchToInitialViewer","initialViewerName","location","hash","indexOf","switchToViewer","from","switchViewHandler","blur","preventDefault","activeViewer","tooltip","name","_this2","newViewer","oldButton","newButton","oldViewer","toggleCopyButtonState","renderGFM","handleLocationHash","ISetter","CommentTypeToggle","opts","dropdownTrigger","dropdownList","noteTypeInput","submitButton","closeButton","reopenButton","droplab","DropLab","setConfig","normalizeNewlines","str","autosize","Autosize","REGEX_QUICK_ACTIONS","Notes","notes_url","note_ids","last_fetched_at","enableGFM","defaultAutocompleteConfig","notes_classCallCheck","updateTargetButtons","updateComment","visibilityChange","cancelDiscussionForm","onAddDiffNote","onAddImageDiffNote","setupDiscussionNoteForm","onReplyToDiscussionNote","removeNote","cancelEdit","updateNote","addDiscussionNote","addNoteError","addNote","resetMainTargetForm","refresh","keydownNoteText","toggleCommitList","postComment","clearFlashWrapper","clearFlash","onHashChange","updatedNotesTrackingMap","noteable_url","URL","notesCountBadge","basePollingInterval","maxPollingSteps","$wrapperEl","isInMRPage","cleanBinding","addBinding","setPollingInterval","setupMainTargetNoteForm","collapseLongCommitList","setViewType","getPagePath","clone","insertAfter","getLocationHash","$anchor","getElementById","loadLazyDiff","instance","Cookies","showEditForm","removeAttachment","updateFormAttachment","onClickRetryLazyLoad","reenableTargetFormSubmitButton","$textarea","discussionNoteForm","editNote","myLastNote","isMetaKey","which","gon","current_user_id","confirm","removeDiscussionNoteForm","removeNoteEditForm","interval","clearInterval","setInterval","pollingInterval","hidden","getContent","refreshing","headers","X-Last-Fetched-At","notes","i","note","renderNote","shouldReset","nthInterval","pow","initRefresh","noteEntity","votesBlock","commands_changes","checkMergeRequestStatus","eq","loadAwardsHandler","awardsHandler","addAwardToEmojiBar","emoji_award","scrollToAwards","$note","localTimeAgo","updateNoteTargetSelector","$noteToCleanHighlight","$form","$notesList","discussion_html","renderDiscussionNote","valid","isNewNote","$newNote","animateAppendNote","setupNewNote","updateNotesCount","isUpdatedNote","isEditing","initialContent","trim","currentContent","sanitizedNoteNote","isTextareaUntouched","putConflictEditWarningInPlace","$updatedNote","animateUpdateNote","commands_only","keys","addFlash","parentTimeline","discussionContainer","form","row","lineType","diffAvatarContainer","discussion_id","discussion_line_code","on_image","isParallelView","prevAll","first","diff_discussion_html","$discussion","after","$notes","contentContainerClass","split","append","children","diffNotesCompileComponents","discussion_resolvable","renderDiscussionAvatar","changesDiscussionContainer","avatarHolder","click","createEvent","initEvent","formClone","setupNoteForm","parents","initCommentTypeToggle","textarea","glForm","GLForm","formParentTimeline","$parentTimeline","isNewDiffComment","mergeRequestId","ResolveService","toggleResolveForDiscussion","$targetNote","$noteEntityEl","revertNoteEditForm","replaceWith","isAllowed","isInViewport","scrollToElement","show","scrollTo","$editForm","getEditFormSelector","$currentlyEditing","checkContentToAllowEditing","putEditFormInPlace","hide","insertBefore","enable","noteElId","prev","diffNoteApps","$destroy","notesTr","$diffFile","removeBadgeEvent","CustomEvent","replyToDiscussionNote","replyLink","cleanForm","dataHolder","diffFileData","discussionID","link","$link","showReplyInput","toggleDiffNote","newForm","clickEvent","appendTo","addForm","hasNotes","replyButton","rowCssToAdd","forceShow","_ref2$showReplyInput","nextRow","next","targetRow","is","lineTypeSelector","notesContentSelector","notesContent","isCurrentlyShown","showNow","toggleClass","blurEvent","filename","closebtn","closetext","reopenbtn","reopentext","$originalContentEl","originalContent","postUrl","targetId","targetType","markdownVersion","updateCount","$retryButton","prop","$container","renderPlaceholderComponent","$errorContainer","$successContainer","renderDiffContent","$element","$closestSystemCommitList","siblings","systemNotes","has","systemNote","$systemNote","headerMessage","_len","flashParams","_key","flashContainer","_construct","content","formData","serialize","formContent","_","escape","formAction","formContentOriginal","test","tempFormContent","executedCommands","command","RegExp","commandDescription","description","toLowerCase","uniqueId","isDiscussionNote","currentUsername","currentUserFullname","currentUserAvatar","discussionClass","$tempNote","_ref5","_this3","$submitBtn","noteUniqueId","systemNoteUniqueId","$notesContainer","$closeBtn","isMainForm","isDiscussionForm","isDiscussionResolve","_this$getFormData","getFormData","hasQuickActions","stripQuickActions","createPlaceholderNote","current_username","current_user_fullname","current_user_avatar_url","createPlaceholderSystemNote","getQuickActionDescription","AjaxCache","GfmAutoComplete","dataSources","commands","post","res","notePosition","_JSON$parse","addBadgeEvent","handleQuickActions","closestDiffFile","_this4","$editingNote","$noteBodyText","_this$getFormData2","cachedNoteBodyText","_ref6","updateNoteError","initDroplab","addTargetClass","Boolean","Vue","components","GlSkeletonLoading","render","lines","prepend","fileHolder","syntaxHighlight","noteIds","inArray","mrWidget","checkStatus","noteHtml","jQuery","factory","modules","installedModules","moduleId","exports","l","m","c","d","getter","o","defineProperty","configurable","enumerable","n","__esModule","object","property","hasOwnProperty","p","s","NodeArray","item","nodeList","slice","apply","parentNode","eventName","initCustomEvent","el1","container","updateTaskList","checkbox","disabled","changeEvent","changedEvent","checkboxes","checked","defaultPrevented","updateSource","incomplete","escapePattern","incompletePattern","completePattern","itemPattern","startFencesPattern","endFencesPattern","itemsInParasPattern","source","itemIndex","clean","inCodeBlock","line","len","ref","results","match","fn","method","ShortcutsNavigation","_possibleConstructorReturn","findAndFollowLink","enabledHelp","Shortcuts","ProjectSelectComboButton","select","projectSelectInput","newItemBtn","resourceType","resourceLabel","formattedText","deriveTextVariants","groupId","initLocalStorage","openDropdown","getProjectFromLocalStorage","selectProject","localStorageKey","localStorageItemType","setBtnTextFromLocalStorage","select2","selectedProjectData","projectMeta","setNewItemBtnAttributes","setProjectInLocalStorage","cachedProjectData","project","defaultTextPrefix","presetTextSuffix","projectString","projectSelect","placeholder","simpleFilter","includeGroups","allProjects","orderBy","withIssuesEnabled","withMergeRequestsEnabled","withShared","includeProjectsInSubgroups","allowClear","minimumInputLength","query","finalCallback","projectsCallback","projects","groupsCallback","groups","Api","term","groupProjects","with_issues_enabled","with_merge_requests_enabled","with_shared","include_subgroups","order_by","membership","web_url","name_with_namespace","initSelection","dropdownCssClass","Project","$cloneOptions","$projectCloneField","$cloneBtnLabel","mobileCloneField","selectedCloneOption","$this","cloneType","activeText","$label","clipboardText","initRefSwitcher","submit","set","projectId","cookieKey","projectSelectDropdown","changeProject","refListItem","refLink","href","$dropdown","glDropdown","params","search","flash","__","selectable","filterable","filterRemote","filterByText","inputFieldName","renderRow","li","cloneNode","header","obj","toggleLabel","clicked","$visit","shouldVisit","action","divider","visitUrl","jquery__WEBPACK_IMPORTED_MODULE_0__","jquery__WEBPACK_IMPORTED_MODULE_0___default","highlightLineClass","fileHolderSelector","scrollFileHolder","_hash","setHash","highlightLine","clickHandler","highlightHash","newHash","range","clearHighlight","hashToRange","highlightRange","lineSelector","scrollOptions","current","lineNumber","shiftKey","matches","reverse","firstLineNumber","lastLineNumber","__setLocationHash__","history","pushState","title","_notes__WEBPACK_IMPORTED_MODULE_0__","dataEl","notesUrl","notesIds","now","diffView","initialize","_projects_gke_cluster_dropdowns__WEBPACK_IMPORTED_MODULE_0__","_persistent_user_callout__WEBPACK_IMPORTED_MODULE_1__","_project__WEBPACK_IMPORTED_MODULE_2__","_behaviors_shortcuts_shortcuts_navigation__WEBPACK_IMPORTED_MODULE_3__","page","body","callout","PersistentUserCallout","initGkeDropdowns","_window$location","protocol","host","pathname","shareBtn","embedBtn","snippetUrlArea","embedAction","scriptTag","dropzoneInput","handlePaste","pasteText","addFileToForm","updateAttachingMessage","isImage","getFilename","uploadFile","$attachButton","$attachingFileMessage","$cancelButton","$retryLink","$uploadProgress","$uploadingErrorContainer","$uploadingErrorMessage","$uploadingProgressContainer","uploadsPath","uploads_path","maxFileSize","max_file_size","formTextarea","$mdArea","setupMarkdownPreview","$formDropzone","dropzone","dictDefaultMessage","clickable","paramName","maxFilesize","uploadMultiple","csrf","previewContainer","processing","alert","dragover","dragleave","drop","success","processingFileCount","getQueuedFiles","getUploadingFiles","shouldPad","markdown","errorMessage","xhr","message","responseText","isString","totaluploadprogress","totalUploadProgress","files","sending","removedfile","queuecomplete","child","Dropzone","forElement","removeAllFiles","dropzoneInstance","failedFiles","failedFile","status","ERROR","accepted","addFile","pasteEvent","originalEvent","clipboardData","items","getAsFile","type","caretStart","selectionStart","caretEnd","selectionEnd","textEnd","beforeSelection","substring","afterSelection","setSelectionRange","scrollHeight","path","getData","closeSpinner","FormData","md","$child","insertToTextArea","messageContainer","attachingMessage","filesCount","autoDiscover","GFMConfig","setupForm","clearEventListeners","autoComplete","isNewForm","disableButtonIfEmptyField","setup","addEventListeners","addMarkdownListeners","isAutosizeable","setupAutosize","setHeightData","destroyAutosize","outerHeight","removeMarkdownListeners","active_backdrop","active_textarea","enter","exit","keyCode","backdrop","removeAttr","$dropzone","zen_area"],"mappings":"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","file":"pages.projects.snippets.show.740f9c49.chunk.js","sourcesContent":["/* eslint-disable no-param-reassign, prefer-template, no-void, consistent-return */\n\nimport AccessorUtilities from './lib/utils/accessor';\n\nexport default class Autosave {\n  constructor(field, key) {\n    this.field = field;\n\n    this.isLocalStorageAvailable = AccessorUtilities.isLocalStorageAccessSafe();\n    if (key.join != null) {\n      key = key.join('/');\n    }\n    this.key = 'autosave/' + key;\n    this.field.data('autosave', this);\n    this.restore();\n    this.field.on('input', () => this.save());\n  }\n\n  restore() {\n    if (!this.isLocalStorageAvailable) return;\n    if (!this.field.length) return;\n\n    const text = window.localStorage.getItem(this.key);\n\n    if ((text != null ? text.length : void 0) > 0) {\n      this.field.val(text);\n    }\n\n    this.field.trigger('input');\n    // v-model does not update with jQuery trigger\n    // https://github.com/vuejs/vue/issues/2804#issuecomment-216968137\n    const event = new Event('change', { bubbles: true, cancelable: false });\n    const field = this.field.get(0);\n    if (field) {\n      field.dispatchEvent(event);\n    }\n  }\n\n  save() {\n    if (!this.field.length) return;\n\n    const text = this.field.val();\n\n    if (this.isLocalStorageAvailable && (text != null ? text.length : void 0) > 0) {\n      return window.localStorage.setItem(this.key, text);\n    }\n\n    return this.reset();\n  }\n\n  reset() {\n    if (!this.isLocalStorageAvailable) return;\n\n    return window.localStorage.removeItem(this.key);\n  }\n\n  dispose() {\n    this.field.off('input');\n  }\n}\n","/**\n * adds a pause and unpause method to Mousetrap\n * this allows you to enable or disable keyboard shortcuts\n * without having to reset Mousetrap and rebind everything\n */\n/* global Mousetrap:true */\nMousetrap = (function(Mousetrap) {\n    var self = Mousetrap,\n        _originalStopCallback = self.stopCallback,\n        enabled = true;\n\n    self.stopCallback = function(e, element, combo) {\n        if (!enabled) {\n            return true;\n        }\n\n        return _originalStopCallback(e, element, combo);\n    };\n\n    self.pause = function() {\n        enabled = false;\n    };\n\n    self.unpause = function() {\n        enabled = true;\n    };\n\n    return self;\n}) (Mousetrap);\n","export function createImageBadge(noteId, { x, y }, classNames = []) {\n  const buttonEl = document.createElement('button');\n  const classList = classNames.concat(['js-image-badge']);\n  classList.forEach(className => buttonEl.classList.add(className));\n  buttonEl.setAttribute('type', 'button');\n  buttonEl.setAttribute('disabled', true);\n  buttonEl.dataset.noteId = noteId;\n  buttonEl.style.left = `${x}px`;\n  buttonEl.style.top = `${y}px`;\n\n  return buttonEl;\n}\n\nexport function addImageBadge(containerEl, { coordinate, badgeText, noteId }) {\n  const buttonEl = createImageBadge(noteId, coordinate, ['badge', 'badge-pill']);\n  buttonEl.innerText = badgeText;\n\n  containerEl.appendChild(buttonEl);\n}\n\nexport function addImageCommentBadge(containerEl, { coordinate, noteId }) {\n  const buttonEl = createImageBadge(noteId, coordinate, ['image-comment-badge']);\n  buttonEl.innerHTML = gl.utils.spriteIcon('image-comment-dark');\n\n  containerEl.appendChild(buttonEl);\n}\n\nexport function addAvatarBadge(el, event) {\n  const { noteId, badgeNumber } = event.detail;\n\n  // Add badge to new comment\n  const avatarBadgeEl = el.querySelector(`#${noteId} .badge`);\n  avatarBadgeEl.innerText = badgeNumber;\n  avatarBadgeEl.classList.remove('hidden');\n}\n","export function addCommentIndicator(containerEl, { x, y }) {\n  const buttonEl = document.createElement('button');\n  buttonEl.classList.add('btn-transparent');\n  buttonEl.classList.add('comment-indicator');\n  buttonEl.setAttribute('type', 'button');\n  buttonEl.style.left = `${x}px`;\n  buttonEl.style.top = `${y}px`;\n\n  buttonEl.innerHTML = gl.utils.spriteIcon('image-comment-dark');\n\n  containerEl.appendChild(buttonEl);\n}\n\nexport function removeCommentIndicator(imageFrameEl) {\n  const commentIndicatorEl = imageFrameEl.querySelector('.comment-indicator');\n  const imageEl = imageFrameEl.querySelector('img');\n  const willRemove = !!commentIndicatorEl;\n  let meta = {};\n\n  if (willRemove) {\n    meta = {\n      x: parseInt(commentIndicatorEl.style.left, 10),\n      y: parseInt(commentIndicatorEl.style.top, 10),\n      image: {\n        width: imageEl.width,\n        height: imageEl.height,\n      },\n    };\n\n    commentIndicatorEl.remove();\n  }\n\n  return Object.assign({}, meta, {\n    removed: willRemove,\n  });\n}\n\nexport function showCommentIndicator(imageFrameEl, coordinate) {\n  const { x, y } = coordinate;\n  const commentIndicatorEl = imageFrameEl.querySelector('.comment-indicator');\n\n  if (commentIndicatorEl) {\n    commentIndicatorEl.style.left = `${x}px`;\n    commentIndicatorEl.style.top = `${y}px`;\n  } else {\n    addCommentIndicator(imageFrameEl, coordinate);\n  }\n}\n\nexport function commentIndicatorOnClick(event) {\n  // Prevent from triggering onAddImageDiffNote in notes.js\n  event.stopPropagation();\n\n  const buttonEl = event.currentTarget;\n  const diffViewerEl = buttonEl.closest('.diff-viewer');\n  const textareaEl = diffViewerEl.querySelector('.note-container .note-textarea');\n  textareaEl.focus();\n}\n","import imageDiffHelper from './helpers/index';\n\nconst defaultMeta = {\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n};\n\nexport default class ImageBadge {\n  constructor(options) {\n    const { noteId, discussionId } = options;\n\n    this.actual = options.actual || defaultMeta;\n    this.browser = options.browser || defaultMeta;\n    this.noteId = noteId;\n    this.discussionId = discussionId;\n\n    if (options.imageEl && !options.browser) {\n      this.browser = imageDiffHelper.resizeCoordinatesToImageElement(options.imageEl, this.actual);\n    }\n  }\n}\n","import $ from 'jquery';\nimport imageDiffHelper from './helpers/index';\nimport ImageBadge from './image_badge';\nimport { isImageLoaded } from '../lib/utils/image_utility';\n\nexport default class ImageDiff {\n  constructor(el, options) {\n    this.el = el;\n    this.canCreateNote = !!(options && options.canCreateNote);\n    this.renderCommentBadge = !!(options && options.renderCommentBadge);\n    this.$noteContainer = $('.note-container', this.el);\n    this.imageBadges = [];\n  }\n\n  init() {\n    this.imageFrameEl = this.el.querySelector('.diff-file .js-image-frame');\n    this.imageEl = this.imageFrameEl.querySelector('img');\n\n    this.bindEvents();\n  }\n\n  bindEvents() {\n    this.imageClickedWrapper = this.imageClicked.bind(this);\n    this.imageBlurredWrapper = imageDiffHelper.removeCommentIndicator.bind(null, this.imageFrameEl);\n    this.addBadgeWrapper = this.addBadge.bind(this);\n    this.removeBadgeWrapper = this.removeBadge.bind(this);\n    this.renderBadgesWrapper = this.renderBadges.bind(this);\n\n    // Render badges\n    if (isImageLoaded(this.imageEl)) {\n      this.renderBadges();\n    } else {\n      this.imageEl.addEventListener('load', this.renderBadgesWrapper);\n    }\n\n    // jquery makes the event delegation here much simpler\n    this.$noteContainer.on('click', '.js-diff-notes-toggle', imageDiffHelper.toggleCollapsed);\n    $(this.el).on('click', '.comment-indicator', imageDiffHelper.commentIndicatorOnClick);\n\n    if (this.canCreateNote) {\n      this.el.addEventListener('click.imageDiff', this.imageClickedWrapper);\n      this.el.addEventListener('blur.imageDiff', this.imageBlurredWrapper);\n      this.el.addEventListener('addBadge.imageDiff', this.addBadgeWrapper);\n      this.el.addEventListener('removeBadge.imageDiff', this.removeBadgeWrapper);\n    }\n  }\n\n  imageClicked(event) {\n    const customEvent = event.detail;\n    const selection = imageDiffHelper.getTargetSelection(customEvent);\n    const el = customEvent.currentTarget;\n\n    imageDiffHelper.setPositionDataAttribute(el, selection.actual);\n    imageDiffHelper.showCommentIndicator(this.imageFrameEl, selection.browser);\n  }\n\n  renderBadges() {\n    const discussionsEls = this.el.querySelectorAll('.note-container .discussion-notes .notes');\n    [...discussionsEls].forEach(this.renderBadge.bind(this));\n  }\n\n  renderBadge(discussionEl, index) {\n    const imageBadge = imageDiffHelper.generateBadgeFromDiscussionDOM(\n      this.imageFrameEl,\n      discussionEl,\n    );\n\n    this.imageBadges.push(imageBadge);\n\n    const options = {\n      coordinate: imageBadge.browser,\n      noteId: imageBadge.noteId,\n    };\n\n    if (this.renderCommentBadge) {\n      imageDiffHelper.addImageCommentBadge(this.imageFrameEl, options);\n    } else {\n      const numberBadgeOptions = Object.assign({}, options, {\n        badgeText: index + 1,\n      });\n\n      imageDiffHelper.addImageBadge(this.imageFrameEl, numberBadgeOptions);\n    }\n  }\n\n  addBadge(event) {\n    const { x, y, width, height, noteId, discussionId } = event.detail;\n    const badgeText = this.imageBadges.length + 1;\n    const imageBadge = new ImageBadge({\n      actual: {\n        x,\n        y,\n        width,\n        height,\n      },\n      imageEl: this.imageFrameEl.querySelector('img'),\n      noteId,\n      discussionId,\n    });\n\n    this.imageBadges.push(imageBadge);\n\n    imageDiffHelper.addImageBadge(this.imageFrameEl, {\n      coordinate: imageBadge.browser,\n      badgeText,\n      noteId,\n    });\n\n    imageDiffHelper.addAvatarBadge(this.el, {\n      detail: {\n        noteId,\n        badgeNumber: badgeText,\n      },\n    });\n\n    const discussionEl = this.el.querySelector(`#discussion_${discussionId}`);\n    imageDiffHelper.updateDiscussionBadgeNumber(discussionEl, badgeText);\n  }\n\n  removeBadge(event) {\n    const { badgeNumber } = event.detail;\n    const indexToRemove = badgeNumber - 1;\n    const imageBadgeEls = this.imageFrameEl.querySelectorAll('.badge');\n\n    if (this.imageBadges.length !== badgeNumber) {\n      // Cascade badges count numbers for (avatar badges + image badges)\n      this.imageBadges.forEach((badge, index) => {\n        if (index > indexToRemove) {\n          const { discussionId } = badge;\n          const updatedBadgeNumber = index;\n          const discussionEl = this.el.querySelector(`#discussion_${discussionId}`);\n\n          imageBadgeEls[index].innerText = updatedBadgeNumber;\n\n          imageDiffHelper.updateDiscussionBadgeNumber(discussionEl, updatedBadgeNumber);\n          imageDiffHelper.updateDiscussionAvatarBadgeNumber(discussionEl, updatedBadgeNumber);\n        }\n      });\n    }\n\n    this.imageBadges.splice(indexToRemove, 1);\n\n    const imageBadgeEl = imageBadgeEls[indexToRemove];\n    imageBadgeEl.remove();\n  }\n}\n","/* eslint-disable import/prefer-default-export */\n\nexport function isImageLoaded(element) {\n  return element.complete && element.naturalHeight !== 0;\n}\n","export const viewTypes = {\n  TWO_UP: 'TWO_UP',\n  SWIPE: 'SWIPE',\n  ONION_SKIN: 'ONION_SKIN',\n};\n\nexport function isValidViewType(validate) {\n  return !!Object.getOwnPropertyNames(viewTypes).find(viewType => viewType === validate);\n}\n","import imageDiffHelper from './helpers/index';\nimport { viewTypes, isValidViewType } from './view_types';\nimport ImageDiff from './image_diff';\n\nexport default class ReplacedImageDiff extends ImageDiff {\n  init(defaultViewType = viewTypes.TWO_UP) {\n    this.imageFrameEls = {\n      [viewTypes.TWO_UP]: this.el.querySelector('.two-up .js-image-frame'),\n      [viewTypes.SWIPE]: this.el.querySelector('.swipe .js-image-frame'),\n      [viewTypes.ONION_SKIN]: this.el.querySelector('.onion-skin .js-image-frame'),\n    };\n\n    const viewModesEl = this.el.querySelector('.view-modes-menu');\n    this.viewModesEls = {\n      [viewTypes.TWO_UP]: viewModesEl.querySelector('.two-up'),\n      [viewTypes.SWIPE]: viewModesEl.querySelector('.swipe'),\n      [viewTypes.ONION_SKIN]: viewModesEl.querySelector('.onion-skin'),\n    };\n\n    this.currentView = defaultViewType;\n    this.generateImageEls();\n    this.bindEvents();\n  }\n\n  generateImageEls() {\n    this.imageEls = {};\n\n    const viewTypeNames = Object.getOwnPropertyNames(viewTypes);\n    viewTypeNames.forEach(viewType => {\n      this.imageEls[viewType] = this.imageFrameEls[viewType].querySelector('img');\n    });\n  }\n\n  bindEvents() {\n    super.bindEvents();\n\n    this.changeToViewTwoUp = this.changeView.bind(this, viewTypes.TWO_UP);\n    this.changeToViewSwipe = this.changeView.bind(this, viewTypes.SWIPE);\n    this.changeToViewOnionSkin = this.changeView.bind(this, viewTypes.ONION_SKIN);\n\n    this.viewModesEls[viewTypes.TWO_UP].addEventListener('click', this.changeToViewTwoUp);\n    this.viewModesEls[viewTypes.SWIPE].addEventListener('click', this.changeToViewSwipe);\n    this.viewModesEls[viewTypes.ONION_SKIN].addEventListener('click', this.changeToViewOnionSkin);\n  }\n\n  get imageEl() {\n    return this.imageEls[this.currentView];\n  }\n\n  get imageFrameEl() {\n    return this.imageFrameEls[this.currentView];\n  }\n\n  changeView(newView) {\n    if (!isValidViewType(newView)) {\n      return;\n    }\n\n    const indicator = imageDiffHelper.removeCommentIndicator(this.imageFrameEl);\n\n    this.currentView = newView;\n\n    // Clear existing badges on new view\n    const existingBadges = this.imageFrameEl.querySelectorAll('.badge');\n    [...existingBadges].map(badge => badge.remove());\n\n    // Remove existing references to old view image badges\n    this.imageBadges = [];\n\n    // Image_file.js has a fade animation of 200ms for loading the view\n    // Need to wait an additional 250ms for the images to be displayed\n    // on window in order to re-normalize their dimensions\n    setTimeout(this.renderNewView.bind(this, indicator), 250);\n  }\n\n  renderNewView(indicator) {\n    // Generate badge coordinates on new view\n    this.renderBadges();\n\n    // Re-render indicator in new view\n    if (indicator.removed) {\n      const normalizedIndicator = imageDiffHelper.resizeCoordinatesToImageElement(this.imageEl, {\n        x: indicator.x,\n        y: indicator.y,\n        width: indicator.image.width,\n        height: indicator.image.height,\n      });\n      imageDiffHelper.showCommentIndicator(this.imageFrameEl, normalizedIndicator);\n    }\n  }\n}\n","/* eslint-disable func-names, no-var, prefer-arrow-callback, no-else-return, consistent-return, prefer-template, one-var, no-unused-vars, no-return-assign, no-unused-expressions, no-sequences */\n\nimport $ from 'jquery';\n\n// Width where images must fits in, for 2-up this gets divided by 2\nconst availWidth = 900;\nconst viewModes = ['two-up', 'swipe'];\n\nexport default class ImageFile {\n  constructor(file) {\n    this.file = file;\n    this.requestImageInfo(\n      $('.two-up.view .frame.deleted img', this.file),\n      (function(_this) {\n        return function(deletedWidth, deletedHeight) {\n          return _this.requestImageInfo($('.two-up.view .frame.added img', _this.file), function(\n            width,\n            height,\n          ) {\n            _this.initViewModes();\n\n            // Load two-up view after images are loaded\n            // so that we can display the correct width and height information\n            const $images = $('.two-up.view img', _this.file);\n\n            $images.waitForImages(function() {\n              _this.initView('two-up');\n            });\n          });\n        };\n      })(this),\n    );\n  }\n\n  initViewModes() {\n    const viewMode = viewModes[0];\n    $('.view-modes', this.file).removeClass('hide');\n    $('.view-modes-menu', this.file).on(\n      'click',\n      'li',\n      (function(_this) {\n        return function(event) {\n          if (!$(event.currentTarget).hasClass('active')) {\n            return _this.activateViewMode(event.currentTarget.className);\n          }\n        };\n      })(this),\n    );\n    return this.activateViewMode(viewMode);\n  }\n\n  activateViewMode(viewMode) {\n    $('.view-modes-menu li', this.file)\n      .removeClass('active')\n      .filter('.' + viewMode)\n      .addClass('active');\n    return $('.view:visible:not(.' + viewMode + ')', this.file).fadeOut(\n      200,\n      (function(_this) {\n        return function() {\n          $('.view.' + viewMode, _this.file).fadeIn(200);\n          return _this.initView(viewMode);\n        };\n      })(this),\n    );\n  }\n\n  initView(viewMode) {\n    return this.views[viewMode].call(this);\n  }\n  // eslint-disable-next-line class-methods-use-this\n  initDraggable($el, padding, callback) {\n    var dragging = false;\n    var $body = $('body');\n    var $offsetEl = $el.parent();\n\n    $el.off('mousedown').on('mousedown', function() {\n      dragging = true;\n      $body.css('user-select', 'none');\n    });\n\n    $body\n      .off('mouseup')\n      .off('mousemove')\n      .on('mouseup', function() {\n        dragging = false;\n        $body.css('user-select', '');\n      })\n      .on('mousemove', function(e) {\n        var left;\n        if (!dragging) return;\n\n        left = e.pageX - ($offsetEl.offset().left + padding);\n\n        callback(e, left);\n      });\n  }\n\n  prepareFrames(view) {\n    var maxHeight, maxWidth;\n    maxWidth = 0;\n    maxHeight = 0;\n    $('.frame', view)\n      .each(\n        (function(_this) {\n          return function(index, frame) {\n            var height, width;\n            width = $(frame).width();\n            height = $(frame).height();\n            maxWidth = width > maxWidth ? width : maxWidth;\n            return (maxHeight = height > maxHeight ? height : maxHeight);\n          };\n        })(this),\n      )\n      .css({\n        width: maxWidth,\n        height: maxHeight,\n      });\n    return [maxWidth, maxHeight];\n  }\n\n  views = {\n    'two-up': function() {\n      return $('.two-up.view .wrap', this.file).each(\n        (function(_this) {\n          return function(index, wrap) {\n            $('img', wrap).each(function() {\n              var currentWidth;\n              currentWidth = $(this).width();\n              if (currentWidth > availWidth / 2) {\n                return $(this).width(availWidth / 2);\n              }\n            });\n            return _this.requestImageInfo($('img', wrap), function(width, height) {\n              $('.image-info .meta-width', wrap).text(width + 'px');\n              $('.image-info .meta-height', wrap).text(height + 'px');\n              return $('.image-info', wrap).removeClass('hide');\n            });\n          };\n        })(this),\n      );\n    },\n    swipe() {\n      var maxHeight, maxWidth;\n      maxWidth = 0;\n      maxHeight = 0;\n      return $('.swipe.view', this.file).each(\n        (function(_this) {\n          return function(index, view) {\n            var $swipeWrap, $swipeBar, $swipeFrame, wrapPadding, ref;\n            (ref = _this.prepareFrames(view)), ([maxWidth, maxHeight] = ref);\n            $swipeFrame = $('.swipe-frame', view);\n            $swipeWrap = $('.swipe-wrap', view);\n            $swipeBar = $('.swipe-bar', view);\n\n            $swipeFrame.css({\n              width: maxWidth + 16,\n              height: maxHeight + 28,\n            });\n            $swipeWrap.css({\n              width: maxWidth + 1,\n              height: maxHeight + 2,\n            });\n            // Set swipeBar left position to match image frame\n            $swipeBar.css({\n              left: 1,\n            });\n\n            wrapPadding = parseInt($swipeWrap.css('right').replace('px', ''), 10);\n\n            _this.initDraggable($swipeBar, wrapPadding, function(e, left) {\n              if (left > 0 && left < $swipeFrame.width() - wrapPadding * 2) {\n                $swipeWrap.width(maxWidth + 1 - left);\n                $swipeBar.css('left', left);\n              }\n            });\n          };\n        })(this),\n      );\n    },\n    'onion-skin': function() {\n      var dragTrackWidth, maxHeight, maxWidth;\n      maxWidth = 0;\n      maxHeight = 0;\n      dragTrackWidth = $('.drag-track', this.file).width() - $('.dragger', this.file).width();\n      return $('.onion-skin.view', this.file).each(\n        (function(_this) {\n          return function(index, view) {\n            var $frame,\n              $track,\n              $dragger,\n              $frameAdded,\n              framePadding,\n              ref,\n              dragging = false;\n            (ref = _this.prepareFrames(view)), ([maxWidth, maxHeight] = ref);\n            $frame = $('.onion-skin-frame', view);\n            $frameAdded = $('.frame.added', view);\n            $track = $('.drag-track', view);\n            $dragger = $('.dragger', $track);\n\n            $frame.css({\n              width: maxWidth + 16,\n              height: maxHeight + 28,\n            });\n            $('.swipe-wrap', view).css({\n              width: maxWidth + 1,\n              height: maxHeight + 2,\n            });\n            $dragger.css({\n              left: dragTrackWidth,\n            });\n\n            $frameAdded.css('opacity', 1);\n            framePadding = parseInt($frameAdded.css('right').replace('px', ''), 10);\n\n            _this.initDraggable($dragger, framePadding, function(e, left) {\n              var opacity = left / dragTrackWidth;\n\n              if (opacity >= 0 && opacity <= 1) {\n                $dragger.css('left', left);\n                $frameAdded.css('opacity', opacity);\n              }\n            });\n          };\n        })(this),\n      );\n    },\n  };\n\n  requestImageInfo(img, callback) {\n    const domImg = img.get(0);\n    if (domImg) {\n      if (domImg.complete) {\n        return callback.call(this, domImg.naturalWidth, domImg.naturalHeight);\n      } else {\n        return img.on(\n          'load',\n          (function(_this) {\n            return function() {\n              return callback.call(_this, domImg.naturalWidth, domImg.naturalHeight);\n            };\n          })(this),\n        );\n      }\n    }\n  }\n}\n","import * as badgeHelper from './badge_helper';\nimport * as commentIndicatorHelper from './comment_indicator_helper';\nimport * as domHelper from './dom_helper';\nimport * as utilsHelper from './utils_helper';\n\nexport default {\n  addCommentIndicator: commentIndicatorHelper.addCommentIndicator,\n  removeCommentIndicator: commentIndicatorHelper.removeCommentIndicator,\n  showCommentIndicator: commentIndicatorHelper.showCommentIndicator,\n  commentIndicatorOnClick: commentIndicatorHelper.commentIndicatorOnClick,\n\n  addImageBadge: badgeHelper.addImageBadge,\n  addImageCommentBadge: badgeHelper.addImageCommentBadge,\n  addAvatarBadge: badgeHelper.addAvatarBadge,\n\n  setPositionDataAttribute: domHelper.setPositionDataAttribute,\n  updateDiscussionAvatarBadgeNumber: domHelper.updateDiscussionAvatarBadgeNumber,\n  updateDiscussionBadgeNumber: domHelper.updateDiscussionBadgeNumber,\n  toggleCollapsed: domHelper.toggleCollapsed,\n\n  resizeCoordinatesToImageElement: utilsHelper.resizeCoordinatesToImageElement,\n  generateBadgeFromDiscussionDOM: utilsHelper.generateBadgeFromDiscussionDOM,\n  getTargetSelection: utilsHelper.getTargetSelection,\n  initImageDiff: utilsHelper.initImageDiff,\n};\n","export function setPositionDataAttribute(el, options) {\n  // Update position data attribute so that the\n  // new comment form can use this data for ajax request\n  const { x, y, width, height } = options;\n  const { position } = el.dataset;\n\n  const positionObject = Object.assign({}, JSON.parse(position), {\n    x,\n    y,\n    width,\n    height,\n  });\n\n  el.setAttribute('data-position', JSON.stringify(positionObject));\n}\n\nexport function updateDiscussionAvatarBadgeNumber(discussionEl, newBadgeNumber) {\n  const avatarBadgeEl = discussionEl.querySelector('.image-diff-avatar-link .badge');\n  avatarBadgeEl.innerText = newBadgeNumber;\n}\n\nexport function updateDiscussionBadgeNumber(discussionEl, newBadgeNumber) {\n  const discussionBadgeEl = discussionEl.querySelector('.badge');\n  discussionBadgeEl.innerText = newBadgeNumber;\n}\n\nexport function toggleCollapsed(event) {\n  const toggleButtonEl = event.currentTarget;\n  const discussionNotesEl = toggleButtonEl.closest('.discussion-notes');\n  const formEl = discussionNotesEl.querySelector('.discussion-form');\n  const isCollapsed = discussionNotesEl.classList.contains('collapsed');\n\n  if (isCollapsed) {\n    discussionNotesEl.classList.remove('collapsed');\n  } else {\n    discussionNotesEl.classList.add('collapsed');\n  }\n\n  // Override the inline display style set in notes.js\n  if (formEl && !isCollapsed) {\n    formEl.style.display = 'none';\n  } else if (formEl && isCollapsed) {\n    formEl.style.display = 'block';\n  }\n}\n","import ImageBadge from '../image_badge';\nimport ImageDiff from '../image_diff';\nimport ReplacedImageDiff from '../replaced_image_diff';\nimport ImageFile from '../../commit/image_file';\n\nexport function resizeCoordinatesToImageElement(imageEl, meta) {\n  const { x, y, width, height } = meta;\n\n  const imageWidth = imageEl.width;\n  const imageHeight = imageEl.height;\n\n  const widthRatio = imageWidth / width;\n  const heightRatio = imageHeight / height;\n\n  return {\n    x: Math.round(x * widthRatio),\n    y: Math.round(y * heightRatio),\n    width: imageWidth,\n    height: imageHeight,\n  };\n}\n\nexport function generateBadgeFromDiscussionDOM(imageFrameEl, discussionEl) {\n  const position = JSON.parse(discussionEl.dataset.position);\n  const firstNoteEl = discussionEl.querySelector('.note');\n  const badge = new ImageBadge({\n    actual: position,\n    imageEl: imageFrameEl.querySelector('img'),\n    noteId: firstNoteEl.id,\n    discussionId: discussionEl.dataset.discussionId,\n  });\n\n  return badge;\n}\n\nexport function getTargetSelection(event) {\n  const containerEl = event.currentTarget;\n  const imageEl = containerEl.querySelector('img');\n\n  const x = event.offsetX;\n  const y = event.offsetY;\n\n  const { width, height } = imageEl;\n\n  const actualWidth = imageEl.naturalWidth;\n  const actualHeight = imageEl.naturalHeight;\n\n  const widthRatio = actualWidth / width;\n  const heightRatio = actualHeight / height;\n\n  // Browser will include the frame as a clickable target,\n  // which would result in potential 1px out of bounds value\n  // This bound the coordinates to inside the frame\n  const normalizedX = Math.max(0, x) && Math.min(x, width);\n  const normalizedY = Math.max(0, y) && Math.min(y, height);\n\n  return {\n    browser: {\n      x: normalizedX,\n      y: normalizedY,\n      width,\n      height,\n    },\n    actual: {\n      // Round x, y so that we don't need to deal with decimals\n      x: Math.round(normalizedX * widthRatio),\n      y: Math.round(normalizedY * heightRatio),\n      width: actualWidth,\n      height: actualHeight,\n    },\n  };\n}\n\nexport function initImageDiff(fileEl, canCreateNote, renderCommentBadge) {\n  const options = {\n    canCreateNote,\n    renderCommentBadge,\n  };\n  let diff;\n\n  // ImageFile needs to be invoked before initImageDiff so that badges\n  // can mount to the correct location\n  new ImageFile(fileEl); // eslint-disable-line no-new\n\n  if (fileEl.querySelector('.diff-file .js-single-image')) {\n    diff = new ImageDiff(fileEl, options);\n    diff.init();\n  } else if (fileEl.querySelector('.diff-file .js-replaced-image')) {\n    diff = new ReplacedImageDiff(fileEl, options);\n    diff.init();\n  }\n\n  return diff;\n}\n","import initNotes from '~/init_notes';\nimport ZenMode from '~/zen_mode';\nimport LineHighlighter from '~/line_highlighter';\nimport BlobViewer from '~/blob/viewer';\nimport snippetEmbed from '~/snippet/snippet_embed';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  new LineHighlighter(); // eslint-disable-line no-new\n  new BlobViewer(); // eslint-disable-line no-new\n  initNotes();\n  new ZenMode(); // eslint-disable-line no-new\n  snippetEmbed();\n});\n","import $ from 'jquery';\nimport 'deckar01-task_list';\nimport axios from './lib/utils/axios_utils';\nimport Flash from './flash';\n\nexport default class TaskList {\n  constructor(options = {}) {\n    this.selector = options.selector;\n    this.dataType = options.dataType;\n    this.fieldName = options.fieldName;\n    this.onSuccess = options.onSuccess || (() => {});\n    this.onError = function showFlash(e) {\n      let errorMessages = '';\n\n      if (e.response.data && typeof e.response.data === 'object') {\n        errorMessages = e.response.data.errors.join(' ');\n      }\n\n      return new Flash(errorMessages || 'Update failed', 'alert');\n    };\n\n    this.init();\n  }\n\n  init() {\n    // Prevent duplicate event bindings\n    this.disable();\n    $(`${this.selector} .js-task-list-container`).taskList('enable');\n    $(document).on(\n      'tasklist:changed',\n      `${this.selector} .js-task-list-container`,\n      this.update.bind(this),\n    );\n  }\n\n  disable() {\n    $(`${this.selector} .js-task-list-container`).taskList('disable');\n    $(document).off('tasklist:changed', `${this.selector} .js-task-list-container`);\n  }\n\n  update(e) {\n    const $target = $(e.target);\n    const patchData = {};\n    patchData[this.dataType] = {\n      [this.fieldName]: $target.val(),\n    };\n\n    return axios\n      .patch($target.data('updateUrl') || $('form.js-issuable-update').attr('action'), patchData)\n      .then(({ data }) => this.onSuccess(data))\n      .catch(err => this.onError(err));\n  }\n}\n","/* eslint-disable */\n\nconst InputSetter = {\n  init(hook) {\n    this.hook = hook;\n    this.destroyed = false;\n    this.config = hook.config.InputSetter || (this.hook.config.InputSetter = {});\n\n    this.eventWrapper = {};\n\n    this.addEvents();\n  },\n\n  addEvents() {\n    this.eventWrapper.setInputs = this.setInputs.bind(this);\n    this.hook.list.list.addEventListener('click.dl', this.eventWrapper.setInputs);\n  },\n\n  removeEvents() {\n    this.hook.list.list.removeEventListener('click.dl', this.eventWrapper.setInputs);\n  },\n\n  setInputs(e) {\n    if (this.destroyed) return;\n\n    const selectedItem = e.detail.selected;\n\n    if (!Array.isArray(this.config)) this.config = [this.config];\n\n    this.config.forEach(config => this.setInput(config, selectedItem));\n  },\n\n  setInput(config, selectedItem) {\n    const input = config.input || this.hook.trigger;\n    const newValue = selectedItem.getAttribute(config.valueAttribute);\n    const inputAttribute = config.inputAttribute;\n\n    if (input.hasAttribute(inputAttribute)) return input.setAttribute(inputAttribute, newValue);\n    if (input.tagName === 'INPUT') return (input.value = newValue);\n    return (input.textContent = newValue);\n  },\n\n  destroy() {\n    this.destroyed = true;\n\n    this.removeEvents();\n  },\n};\n\nexport default InputSetter;\n","import $ from 'jquery';\nimport Flash from '../../flash';\nimport { handleLocationHash } from '../../lib/utils/common_utils';\nimport axios from '../../lib/utils/axios_utils';\n\nexport default class BlobViewer {\n  constructor() {\n    BlobViewer.initAuxiliaryViewer();\n    BlobViewer.initRichViewer();\n\n    this.initMainViewers();\n  }\n\n  static initAuxiliaryViewer() {\n    const auxiliaryViewer = document.querySelector('.blob-viewer[data-type=\"auxiliary\"]');\n    if (!auxiliaryViewer) return;\n\n    BlobViewer.loadViewer(auxiliaryViewer);\n  }\n\n  static initRichViewer() {\n    const viewer = document.querySelector('.blob-viewer[data-type=\"rich\"]');\n    if (!viewer || !viewer.dataset.richType) return;\n\n    const initViewer = promise =>\n      promise\n        .then(module => module.default(viewer))\n        .catch(error => {\n          Flash('Error loading file viewer.');\n          throw error;\n        });\n\n    switch (viewer.dataset.richType) {\n      case 'balsamiq':\n        initViewer(import(/* webpackChunkName: 'balsamiq_viewer' */ '../balsamiq_viewer'));\n        break;\n      case 'notebook':\n        initViewer(import(/* webpackChunkName: 'notebook_viewer' */ '../notebook_viewer'));\n        break;\n      case 'pdf':\n        initViewer(import(/* webpackChunkName: 'pdf_viewer' */ '../pdf_viewer'));\n        break;\n      case 'sketch':\n        initViewer(import(/* webpackChunkName: 'sketch_viewer' */ '../sketch_viewer'));\n        break;\n      case 'stl':\n        initViewer(import(/* webpackChunkName: 'stl_viewer' */ '../stl_viewer'));\n        break;\n      default:\n        break;\n    }\n  }\n\n  initMainViewers() {\n    this.$fileHolder = $('.file-holder');\n    if (!this.$fileHolder.length) return;\n\n    this.switcher = document.querySelector('.js-blob-viewer-switcher');\n    this.switcherBtns = document.querySelectorAll('.js-blob-viewer-switch-btn');\n    this.copySourceBtn = document.querySelector('.js-copy-blob-source-btn');\n\n    this.simpleViewer = this.$fileHolder[0].querySelector('.blob-viewer[data-type=\"simple\"]');\n    this.richViewer = this.$fileHolder[0].querySelector('.blob-viewer[data-type=\"rich\"]');\n\n    this.initBindings();\n\n    this.switchToInitialViewer();\n  }\n\n  switchToInitialViewer() {\n    const initialViewer = this.$fileHolder[0].querySelector('.blob-viewer:not(.hidden)');\n    let initialViewerName = initialViewer.getAttribute('data-type');\n\n    if (this.switcher && window.location.hash.indexOf('#L') === 0) {\n      initialViewerName = 'simple';\n    }\n\n    this.switchToViewer(initialViewerName);\n  }\n\n  initBindings() {\n    if (this.switcherBtns.length) {\n      Array.from(this.switcherBtns).forEach(el => {\n        el.addEventListener('click', this.switchViewHandler.bind(this));\n      });\n    }\n\n    if (this.copySourceBtn) {\n      this.copySourceBtn.addEventListener('click', () => {\n        if (this.copySourceBtn.classList.contains('disabled')) return this.copySourceBtn.blur();\n\n        return this.switchToViewer('simple');\n      });\n    }\n  }\n\n  switchViewHandler(e) {\n    const target = e.currentTarget;\n\n    e.preventDefault();\n\n    this.switchToViewer(target.getAttribute('data-viewer'));\n  }\n\n  toggleCopyButtonState() {\n    if (!this.copySourceBtn) return;\n\n    if (this.simpleViewer.getAttribute('data-loaded')) {\n      this.copySourceBtn.setAttribute('title', 'Copy source to clipboard');\n      this.copySourceBtn.classList.remove('disabled');\n    } else if (this.activeViewer === this.simpleViewer) {\n      this.copySourceBtn.setAttribute(\n        'title',\n        'Wait for the source to load to copy it to the clipboard',\n      );\n      this.copySourceBtn.classList.add('disabled');\n    } else {\n      this.copySourceBtn.setAttribute('title', 'Switch to the source to copy it to the clipboard');\n      this.copySourceBtn.classList.add('disabled');\n    }\n\n    $(this.copySourceBtn).tooltip('_fixTitle');\n  }\n\n  switchToViewer(name) {\n    const newViewer = this.$fileHolder[0].querySelector(`.blob-viewer[data-type='${name}']`);\n    if (this.activeViewer === newViewer) return;\n\n    const oldButton = document.querySelector('.js-blob-viewer-switch-btn.active');\n    const newButton = document.querySelector(`.js-blob-viewer-switch-btn[data-viewer='${name}']`);\n    const oldViewer = this.$fileHolder[0].querySelector(`.blob-viewer:not([data-type='${name}'])`);\n\n    if (oldButton) {\n      oldButton.classList.remove('active');\n    }\n\n    if (newButton) {\n      newButton.classList.add('active');\n      newButton.blur();\n    }\n\n    if (oldViewer) {\n      oldViewer.classList.add('hidden');\n    }\n\n    newViewer.classList.remove('hidden');\n\n    this.activeViewer = newViewer;\n\n    this.toggleCopyButtonState();\n\n    BlobViewer.loadViewer(newViewer)\n      .then(viewer => {\n        $(viewer).renderGFM();\n\n        this.$fileHolder.trigger('highlight:line');\n        handleLocationHash();\n\n        this.toggleCopyButtonState();\n      })\n      .catch(() => new Flash('Error loading viewer'));\n  }\n\n  static loadViewer(viewerParam) {\n    const viewer = viewerParam;\n    const url = viewer.getAttribute('data-url');\n\n    if (!url || viewer.getAttribute('data-loaded') || viewer.getAttribute('data-loading')) {\n      return Promise.resolve(viewer);\n    }\n\n    viewer.setAttribute('data-loading', 'true');\n\n    return axios.get(url).then(({ data }) => {\n      viewer.innerHTML = data.html;\n      viewer.setAttribute('data-loaded', 'true');\n\n      return viewer;\n    });\n  }\n}\n","import DropLab from './droplab/drop_lab';\nimport ISetter from './droplab/plugins/input_setter';\n\n// Todo: Remove this when fixing issue in input_setter plugin\nconst InputSetter = Object.assign({}, ISetter);\n\nclass CommentTypeToggle {\n  constructor(opts = {}) {\n    this.dropdownTrigger = opts.dropdownTrigger;\n    this.dropdownList = opts.dropdownList;\n    this.noteTypeInput = opts.noteTypeInput;\n    this.submitButton = opts.submitButton;\n    this.closeButton = opts.closeButton;\n    this.reopenButton = opts.reopenButton;\n  }\n\n  initDroplab() {\n    this.droplab = new DropLab();\n\n    const config = this.setConfig();\n\n    this.droplab.init(this.dropdownTrigger, this.dropdownList, [InputSetter], config);\n  }\n\n  setConfig() {\n    const config = {\n      InputSetter: [\n        {\n          input: this.noteTypeInput,\n          valueAttribute: 'data-value',\n        },\n        {\n          input: this.submitButton,\n          valueAttribute: 'data-submit-text',\n        },\n      ],\n    };\n\n    if (this.closeButton) {\n      config.InputSetter.push(\n        {\n          input: this.closeButton,\n          valueAttribute: 'data-close-text',\n        },\n        {\n          input: this.closeButton,\n          valueAttribute: 'data-close-text',\n          inputAttribute: 'data-alternative-text',\n        },\n      );\n    }\n\n    if (this.reopenButton) {\n      config.InputSetter.push(\n        {\n          input: this.reopenButton,\n          valueAttribute: 'data-reopen-text',\n        },\n        {\n          input: this.reopenButton,\n          valueAttribute: 'data-reopen-text',\n          inputAttribute: 'data-alternative-text',\n        },\n      );\n    }\n\n    return config;\n  }\n}\n\nexport default CommentTypeToggle;\n","/* eslint-disable no-restricted-properties, func-names, no-var, camelcase,\nno-unused-expressions, one-var, default-case,\nprefer-template, consistent-return, no-alert, no-return-assign,\nno-param-reassign, prefer-arrow-callback, no-else-return, vars-on-top,\nno-unused-vars, no-shadow, no-useless-escape, class-methods-use-this */\n\n/* global ResolveService */\n/* global mrRefreshWidgetUrl */\n\nimport $ from 'jquery';\nimport _ from 'underscore';\nimport Cookies from 'js-cookie';\nimport Autosize from 'autosize';\nimport 'vendor/jquery.caret'; // required by jquery.atwho\nimport 'vendor/jquery.atwho';\nimport AjaxCache from '~/lib/utils/ajax_cache';\nimport Vue from 'vue';\nimport syntaxHighlight from '~/syntax_highlight';\nimport { GlSkeletonLoading } from '@gitlab/ui';\nimport axios from './lib/utils/axios_utils';\nimport { getLocationHash } from './lib/utils/url_utility';\nimport Flash from './flash';\nimport { defaultAutocompleteConfig } from './gfm_auto_complete';\nimport CommentTypeToggle from './comment_type_toggle';\nimport GLForm from './gl_form';\nimport loadAwardsHandler from './awards_handler';\nimport Autosave from './autosave';\nimport TaskList from './task_list';\nimport {\n  isInViewport,\n  getPagePath,\n  scrollToElement,\n  isMetaKey,\n  isInMRPage,\n} from './lib/utils/common_utils';\nimport imageDiffHelper from './image_diff/helpers/index';\nimport { localTimeAgo } from './lib/utils/datetime_utility';\n\nwindow.autosize = Autosize;\n\nfunction normalizeNewlines(str) {\n  return str.replace(/\\r\\n/g, '\\n');\n}\n\nconst MAX_VISIBLE_COMMIT_LIST_COUNT = 3;\nconst REGEX_QUICK_ACTIONS = /^\\/\\w+.*$/gm;\n\nexport default class Notes {\n  static initialize(notes_url, note_ids, last_fetched_at, view, enableGFM) {\n    if (!this.instance) {\n      this.instance = new Notes(notes_url, note_ids, last_fetched_at, view, enableGFM);\n    }\n  }\n\n  static getInstance() {\n    return this.instance;\n  }\n\n  constructor(notes_url, note_ids, last_fetched_at, view, enableGFM = defaultAutocompleteConfig) {\n    this.updateTargetButtons = this.updateTargetButtons.bind(this);\n    this.updateComment = this.updateComment.bind(this);\n    this.visibilityChange = this.visibilityChange.bind(this);\n    this.cancelDiscussionForm = this.cancelDiscussionForm.bind(this);\n    this.onAddDiffNote = this.onAddDiffNote.bind(this);\n    this.onAddImageDiffNote = this.onAddImageDiffNote.bind(this);\n    this.setupDiscussionNoteForm = this.setupDiscussionNoteForm.bind(this);\n    this.onReplyToDiscussionNote = this.onReplyToDiscussionNote.bind(this);\n    this.removeNote = this.removeNote.bind(this);\n    this.cancelEdit = this.cancelEdit.bind(this);\n    this.updateNote = this.updateNote.bind(this);\n    this.addDiscussionNote = this.addDiscussionNote.bind(this);\n    this.addNoteError = this.addNoteError.bind(this);\n    this.addNote = this.addNote.bind(this);\n    this.resetMainTargetForm = this.resetMainTargetForm.bind(this);\n    this.refresh = this.refresh.bind(this);\n    this.keydownNoteText = this.keydownNoteText.bind(this);\n    this.toggleCommitList = this.toggleCommitList.bind(this);\n    this.postComment = this.postComment.bind(this);\n    this.clearFlashWrapper = this.clearFlash.bind(this);\n    this.onHashChange = this.onHashChange.bind(this);\n\n    this.notes_url = notes_url;\n    this.note_ids = note_ids;\n    this.enableGFM = enableGFM;\n    // Used to keep track of updated notes while people are editing things\n    this.updatedNotesTrackingMap = {};\n    this.last_fetched_at = last_fetched_at;\n    this.noteable_url = document.URL;\n    this.notesCountBadge ||\n      (this.notesCountBadge = $('.issuable-details').find('.notes-tab .badge'));\n    this.basePollingInterval = 15000;\n    this.maxPollingSteps = 4;\n\n    this.$wrapperEl = isInMRPage() ? $(document).find('.diffs') : $(document);\n    this.cleanBinding();\n    this.addBinding();\n    this.setPollingInterval();\n    this.setupMainTargetNoteForm(enableGFM);\n    this.taskList = new TaskList({\n      dataType: 'note',\n      fieldName: 'note',\n      selector: '.notes',\n    });\n    this.collapseLongCommitList();\n    this.setViewType(view);\n\n    // We are in the Merge Requests page so we need another edit form for Changes tab\n    if (getPagePath(1) === 'merge_requests') {\n      $('.note-edit-form')\n        .clone()\n        .addClass('mr-note-edit-form')\n        .insertAfter('.note-edit-form');\n    }\n\n    const hash = getLocationHash();\n    const $anchor = hash && document.getElementById(hash);\n\n    if ($anchor) {\n      this.loadLazyDiff({ currentTarget: $anchor });\n    }\n  }\n\n  setViewType(view) {\n    this.view = Cookies.get('diff_view') || view;\n  }\n\n  addBinding() {\n    // Edit note link\n    this.$wrapperEl.on('click', '.js-note-edit', this.showEditForm.bind(this));\n    this.$wrapperEl.on('click', '.note-edit-cancel', this.cancelEdit);\n    // Reopen and close actions for Issue/MR combined with note form submit\n    this.$wrapperEl.on('click', '.js-comment-submit-button', this.postComment);\n    this.$wrapperEl.on('click', '.js-comment-save-button', this.updateComment);\n    this.$wrapperEl.on('keyup input', '.js-note-text', this.updateTargetButtons);\n    // resolve a discussion\n    this.$wrapperEl.on('click', '.js-comment-resolve-button', this.postComment);\n    // remove a note (in general)\n    this.$wrapperEl.on('click', '.js-note-delete', this.removeNote);\n    // delete note attachment\n    this.$wrapperEl.on('click', '.js-note-attachment-delete', this.removeAttachment);\n    // update the file name when an attachment is selected\n    this.$wrapperEl.on('change', '.js-note-attachment-input', this.updateFormAttachment);\n    // reply to diff/discussion notes\n    this.$wrapperEl.on('click', '.js-discussion-reply-button', this.onReplyToDiscussionNote);\n    // add diff note\n    this.$wrapperEl.on('click', '.js-add-diff-note-button', this.onAddDiffNote);\n    // add diff note for images\n    this.$wrapperEl.on('click', '.js-add-image-diff-note-button', this.onAddImageDiffNote);\n    // hide diff note form\n    this.$wrapperEl.on('click', '.js-close-discussion-note-form', this.cancelDiscussionForm);\n    // toggle commit list\n    this.$wrapperEl.on('click', '.system-note-commit-list-toggler', this.toggleCommitList);\n\n    this.$wrapperEl.on('click', '.js-toggle-lazy-diff', this.loadLazyDiff);\n    this.$wrapperEl.on(\n      'click',\n      '.js-toggle-lazy-diff-retry-button',\n      this.onClickRetryLazyLoad.bind(this),\n    );\n\n    // fetch notes when tab becomes visible\n    this.$wrapperEl.on('visibilitychange', this.visibilityChange);\n    // when issue status changes, we need to refresh data\n    this.$wrapperEl.on('issuable:change', this.refresh);\n    // ajax:events that happen on Form when actions like Reopen, Close are performed on Issues and MRs.\n    this.$wrapperEl.on('ajax:success', '.js-main-target-form', this.addNote);\n    this.$wrapperEl.on('ajax:success', '.js-discussion-note-form', this.addDiscussionNote);\n    this.$wrapperEl.on('ajax:success', '.js-main-target-form', this.resetMainTargetForm);\n    this.$wrapperEl.on(\n      'ajax:complete',\n      '.js-main-target-form',\n      this.reenableTargetFormSubmitButton,\n    );\n    // when a key is clicked on the notes\n    this.$wrapperEl.on('keydown', '.js-note-text', this.keydownNoteText);\n    // When the URL fragment/hash has changed, `#note_xxx`\n    $(window).on('hashchange', this.onHashChange);\n  }\n\n  cleanBinding() {\n    this.$wrapperEl.off('click', '.js-note-edit');\n    this.$wrapperEl.off('click', '.note-edit-cancel');\n    this.$wrapperEl.off('click', '.js-note-delete');\n    this.$wrapperEl.off('click', '.js-note-attachment-delete');\n    this.$wrapperEl.off('click', '.js-discussion-reply-button');\n    this.$wrapperEl.off('click', '.js-add-diff-note-button');\n    this.$wrapperEl.off('click', '.js-add-image-diff-note-button');\n    this.$wrapperEl.off('visibilitychange');\n    this.$wrapperEl.off('keyup input', '.js-note-text');\n    this.$wrapperEl.off('click', '.js-note-target-reopen');\n    this.$wrapperEl.off('click', '.js-note-target-close');\n    this.$wrapperEl.off('keydown', '.js-note-text');\n    this.$wrapperEl.off('click', '.js-comment-resolve-button');\n    this.$wrapperEl.off('click', '.system-note-commit-list-toggler');\n    this.$wrapperEl.off('click', '.js-toggle-lazy-diff');\n    this.$wrapperEl.off('click', '.js-toggle-lazy-diff-retry-button');\n    this.$wrapperEl.off('ajax:success', '.js-main-target-form');\n    this.$wrapperEl.off('ajax:success', '.js-discussion-note-form');\n    this.$wrapperEl.off('ajax:complete', '.js-main-target-form');\n    $(window).off('hashchange', this.onHashChange);\n  }\n\n  static initCommentTypeToggle(form) {\n    const dropdownTrigger = form.querySelector('.js-comment-type-dropdown .dropdown-toggle');\n    const dropdownList = form.querySelector('.js-comment-type-dropdown .dropdown-menu');\n    const noteTypeInput = form.querySelector('#note_type');\n    const submitButton = form.querySelector('.js-comment-type-dropdown .js-comment-submit-button');\n    const closeButton = form.querySelector('.js-note-target-close');\n    const reopenButton = form.querySelector('.js-note-target-reopen');\n\n    const commentTypeToggle = new CommentTypeToggle({\n      dropdownTrigger,\n      dropdownList,\n      noteTypeInput,\n      submitButton,\n      closeButton,\n      reopenButton,\n    });\n\n    commentTypeToggle.initDroplab();\n  }\n\n  keydownNoteText(e) {\n    var $textarea,\n      discussionNoteForm,\n      editNote,\n      myLastNote,\n      myLastNoteEditBtn,\n      newText,\n      originalText;\n    if (isMetaKey(e)) {\n      return;\n    }\n\n    $textarea = $(e.target);\n    // Edit previous note when UP arrow is hit\n    switch (e.which) {\n      case 38:\n        if ($textarea.val() !== '') {\n          return;\n        }\n        myLastNote = $(\n          `li.note[data-author-id='${gon.current_user_id}'][data-editable]:last`,\n          $textarea.closest('.note, .notes_holder, #notes'),\n        );\n        if (myLastNote.length) {\n          myLastNoteEditBtn = myLastNote.find('.js-note-edit');\n          return myLastNoteEditBtn.trigger('click', [true, myLastNote]);\n        }\n        break;\n      // Cancel creating diff note or editing any note when ESCAPE is hit\n      case 27:\n        discussionNoteForm = $textarea.closest('.js-discussion-note-form');\n        if (discussionNoteForm.length) {\n          if ($textarea.val() !== '') {\n            if (!window.confirm('Are you sure you want to cancel creating this comment?')) {\n              return;\n            }\n          }\n          this.removeDiscussionNoteForm(discussionNoteForm);\n          return;\n        }\n        editNote = $textarea.closest('.note');\n        if (editNote.length) {\n          originalText = $textarea.closest('form').data('originalNote');\n          newText = $textarea.val();\n          if (originalText !== newText) {\n            if (!window.confirm('Are you sure you want to cancel editing this comment?')) {\n              return;\n            }\n          }\n          return this.removeNoteEditForm(editNote);\n        }\n    }\n  }\n\n  initRefresh() {\n    if (Notes.interval) {\n      clearInterval(Notes.interval);\n    }\n    return (Notes.interval = setInterval(\n      (function(_this) {\n        return function() {\n          return _this.refresh();\n        };\n      })(this),\n      this.pollingInterval,\n    ));\n  }\n\n  refresh() {\n    if (!document.hidden) {\n      return this.getContent();\n    }\n  }\n\n  getContent() {\n    if (this.refreshing) {\n      return;\n    }\n\n    this.refreshing = true;\n\n    axios\n      .get(`${this.notes_url}?html=true`, {\n        headers: {\n          'X-Last-Fetched-At': this.last_fetched_at,\n        },\n      })\n      .then(({ data }) => {\n        const { notes } = data;\n        this.last_fetched_at = data.last_fetched_at;\n        this.setPollingInterval(data.notes.length);\n        $.each(notes, (i, note) => this.renderNote(note));\n\n        this.refreshing = false;\n      })\n      .catch(() => {\n        this.refreshing = false;\n      });\n  }\n\n  /**\n   * Increase @pollingInterval up to 120 seconds on every function call,\n   * if `shouldReset` has a truthy value, 'null' or 'undefined' the variable\n   * will reset to @basePollingInterval.\n   *\n   * Note: this function is used to gradually increase the polling interval\n   * if there aren't new notes coming from the server\n   */\n  setPollingInterval(shouldReset) {\n    var nthInterval;\n    if (shouldReset == null) {\n      shouldReset = true;\n    }\n    nthInterval = this.basePollingInterval * Math.pow(2, this.maxPollingSteps - 1);\n    if (shouldReset) {\n      this.pollingInterval = this.basePollingInterval;\n    } else if (this.pollingInterval < nthInterval) {\n      this.pollingInterval *= 2;\n    }\n    return this.initRefresh();\n  }\n\n  handleQuickActions(noteEntity) {\n    var votesBlock;\n    if (noteEntity.commands_changes) {\n      if ('merge' in noteEntity.commands_changes) {\n        Notes.checkMergeRequestStatus();\n      }\n\n      if ('emoji_award' in noteEntity.commands_changes) {\n        votesBlock = $('.js-awards-block').eq(0);\n\n        loadAwardsHandler()\n          .then(awardsHandler => {\n            awardsHandler.addAwardToEmojiBar(votesBlock, noteEntity.commands_changes.emoji_award);\n            awardsHandler.scrollToAwards();\n          })\n          .catch(() => {\n            // ignore\n          });\n      }\n    }\n  }\n\n  setupNewNote($note) {\n    // Update datetime format on the recent note\n    localTimeAgo($note.find('.js-timeago'), false);\n\n    this.collapseLongCommitList();\n    this.taskList.init();\n\n    // This stops the note highlight, #note_xxx`, from being removed after real time update\n    // The `:target` selector does not re-evaluate after we replace element in the DOM\n    Notes.updateNoteTargetSelector($note);\n    this.$noteToCleanHighlight = $note;\n  }\n\n  onHashChange() {\n    if (this.$noteToCleanHighlight) {\n      Notes.updateNoteTargetSelector(this.$noteToCleanHighlight);\n    }\n\n    this.$noteToCleanHighlight = null;\n  }\n\n  static updateNoteTargetSelector($note) {\n    const hash = getLocationHash();\n    // Needs to be an explicit true/false for the jQuery `toggleClass(force)`\n    const addTargetClass = Boolean(hash && $note.filter(`#${hash}`).length > 0);\n    $note.toggleClass('target', addTargetClass);\n  }\n\n  /**\n   * Render note in main comments area.\n   *\n   * Note: for rendering inline notes use renderDiscussionNote\n   */\n  renderNote(noteEntity, $form, $notesList = $('.main-notes-list')) {\n    if (noteEntity.discussion_html) {\n      return this.renderDiscussionNote(noteEntity, $form);\n    }\n\n    if (!noteEntity.valid) {\n      if (noteEntity.errors && noteEntity.errors.commands_only) {\n        if (noteEntity.commands_changes && Object.keys(noteEntity.commands_changes).length > 0) {\n          $notesList.find('.system-note.being-posted').remove();\n        }\n        this.addFlash(noteEntity.errors.commands_only, 'notice', this.parentTimeline.get(0));\n        this.refresh();\n      }\n      return;\n    }\n\n    const $note = $notesList.find(`#note_${noteEntity.id}`);\n    if (Notes.isNewNote(noteEntity, this.note_ids)) {\n      if (isInMRPage()) {\n        return;\n      }\n\n      this.note_ids.push(noteEntity.id);\n\n      if ($notesList.length) {\n        $notesList.find('.system-note.being-posted').remove();\n      }\n      const $newNote = Notes.animateAppendNote(noteEntity.html, $notesList);\n\n      this.setupNewNote($newNote);\n      this.refresh();\n      return this.updateNotesCount(1);\n    } else if (Notes.isUpdatedNote(noteEntity, $note)) {\n      // The server can send the same update multiple times so we need to make sure to only update once per actual update.\n      const isEditing = $note.hasClass('is-editing');\n      const initialContent = normalizeNewlines(\n        $note\n          .find('.original-note-content')\n          .text()\n          .trim(),\n      );\n      const $textarea = $note.find('.js-note-text');\n      const currentContent = $textarea.val();\n      // There can be CRLF vs LF mismatches if we don't sanitize and compare the same way\n      const sanitizedNoteNote = normalizeNewlines(noteEntity.note);\n      const isTextareaUntouched =\n        currentContent === initialContent || currentContent === sanitizedNoteNote;\n\n      if (isEditing && isTextareaUntouched) {\n        $textarea.val(noteEntity.note);\n        this.updatedNotesTrackingMap[noteEntity.id] = noteEntity;\n      } else if (isEditing && !isTextareaUntouched) {\n        this.putConflictEditWarningInPlace(noteEntity, $note);\n        this.updatedNotesTrackingMap[noteEntity.id] = noteEntity;\n      } else {\n        const $updatedNote = Notes.animateUpdateNote(noteEntity.html, $note);\n        this.setupNewNote($updatedNote);\n      }\n    }\n  }\n\n  isParallelView() {\n    return Cookies.get('diff_view') === 'parallel';\n  }\n\n  /**\n   * Render note in discussion area. To render inline notes use renderDiscussionNote.\n   */\n  renderDiscussionNote(noteEntity, $form) {\n    var discussionContainer, form, row, lineType, diffAvatarContainer;\n\n    if (!Notes.isNewNote(noteEntity, this.note_ids)) {\n      return;\n    }\n    this.note_ids.push(noteEntity.id);\n\n    form = $form || $(`.js-discussion-note-form[data-discussion-id=\"${noteEntity.discussion_id}\"]`);\n    row =\n      form.length || !noteEntity.discussion_line_code\n        ? form.closest('tr')\n        : $(`#${noteEntity.discussion_line_code}`);\n\n    if (noteEntity.on_image) {\n      row = form;\n    }\n\n    lineType = this.isParallelView() ? form.find('#line_type').val() : 'old';\n    diffAvatarContainer = row\n      .prevAll('.line_holder')\n      .first()\n      .find('.js-avatar-container.' + lineType + '_line');\n    // is this the first note of discussion?\n    discussionContainer = $(`.notes[data-discussion-id=\"${noteEntity.discussion_id}\"]`);\n    if (!discussionContainer.length) {\n      discussionContainer = form.closest('.discussion').find('.notes');\n    }\n    if (discussionContainer.length === 0) {\n      if (noteEntity.diff_discussion_html) {\n        var $discussion = $(noteEntity.diff_discussion_html).renderGFM();\n\n        if (!this.isParallelView() || row.hasClass('js-temp-notes-holder') || noteEntity.on_image) {\n          // insert the note and the reply button after the temp row\n          row.after($discussion);\n        } else {\n          // Merge new discussion HTML in\n          var $notes = $discussion.find(`.notes[data-discussion-id=\"${noteEntity.discussion_id}\"]`);\n          var contentContainerClass =\n            '.' +\n            $notes\n              .closest('.notes_content')\n              .attr('class')\n              .split(' ')\n              .join('.');\n\n          row\n            .find(contentContainerClass + ' .content')\n            .append($notes.closest('.content').children());\n        }\n      } else {\n        Notes.animateAppendNote(noteEntity.discussion_html, $('.main-notes-list'));\n      }\n    } else {\n      // append new note to all matching discussions\n      Notes.animateAppendNote(noteEntity.html, discussionContainer);\n    }\n\n    if (typeof gl.diffNotesCompileComponents !== 'undefined' && noteEntity.discussion_resolvable) {\n      gl.diffNotesCompileComponents();\n\n      this.renderDiscussionAvatar(diffAvatarContainer, noteEntity);\n    }\n\n    localTimeAgo($('.js-timeago'), false);\n    Notes.checkMergeRequestStatus();\n    return this.updateNotesCount(1);\n  }\n\n  getLineHolder(changesDiscussionContainer) {\n    return $(changesDiscussionContainer)\n      .closest('.notes_holder')\n      .prevAll('.line_holder')\n      .first()\n      .get(0);\n  }\n\n  renderDiscussionAvatar(diffAvatarContainer, noteEntity) {\n    var avatarHolder = diffAvatarContainer.find('.diff-comment-avatar-holders');\n\n    if (!avatarHolder.length) {\n      avatarHolder = document.createElement('diff-note-avatars');\n      avatarHolder.setAttribute('discussion-id', noteEntity.discussion_id);\n\n      diffAvatarContainer.append(avatarHolder);\n\n      gl.diffNotesCompileComponents();\n    }\n  }\n\n  /**\n   * Called in response the main target form has been successfully submitted.\n   *\n   * Removes any errors.\n   * Resets text and preview.\n   * Resets buttons.\n   */\n  resetMainTargetForm(e) {\n    var form;\n    form = $('.js-main-target-form');\n    // remove validation errors\n    form.find('.js-errors').remove();\n    // reset text and preview\n    form.find('.js-md-write-button').click();\n    form\n      .find('.js-note-text')\n      .val('')\n      .trigger('input');\n    form\n      .find('.js-note-text')\n      .data('autosave')\n      .reset();\n\n    var event = document.createEvent('Event');\n    event.initEvent('autosize:update', true, false);\n    form.find('.js-autosize')[0].dispatchEvent(event);\n\n    this.updateTargetButtons(e);\n  }\n\n  reenableTargetFormSubmitButton() {\n    var form;\n    form = $('.js-main-target-form');\n    return form.find('.js-note-text').trigger('input');\n  }\n\n  /**\n   * Shows the main form and does some setup on it.\n   *\n   * Sets some hidden fields in the form.\n   */\n  setupMainTargetNoteForm(enableGFM) {\n    var form;\n    // find the form\n    form = $('.js-new-note-form');\n    // Set a global clone of the form for later cloning\n    this.formClone = form.clone();\n    // show the form\n    this.setupNoteForm(form, enableGFM);\n    // fix classes\n    form.removeClass('js-new-note-form');\n    form.addClass('js-main-target-form');\n    form.find('#note_line_code').remove();\n    form.find('#note_position').remove();\n    form.find('#note_type').val('');\n    form.find('#note_project_id').remove();\n    form.find('#in_reply_to_discussion_id').remove();\n    form\n      .find('.js-comment-resolve-button')\n      .closest('comment-and-resolve-btn')\n      .remove();\n    this.parentTimeline = form.parents('.timeline');\n\n    if (form.length) {\n      Notes.initCommentTypeToggle(form.get(0));\n    }\n  }\n\n  /**\n   * General note form setup.\n   *\n   * deactivates the submit button when text is empty\n   * hides the preview button when text is empty\n   * set up GFM auto complete\n   * show the form\n   */\n  setupNoteForm(form, enableGFM = defaultAutocompleteConfig) {\n    var textarea, key;\n    this.glForm = new GLForm(form, enableGFM);\n    textarea = form.find('.js-note-text');\n    key = [\n      'Note',\n      form.find('#note_noteable_type').val(),\n      form.find('#note_noteable_id').val(),\n      form.find('#note_commit_id').val(),\n      form.find('#note_type').val(),\n      form.find('#note_project_id').val(),\n      form.find('#in_reply_to_discussion_id').val(),\n\n      // LegacyDiffNote\n      form.find('#note_line_code').val(),\n\n      // DiffNote\n      form.find('#note_position').val(),\n    ];\n    return new Autosave(textarea, key);\n  }\n\n  /**\n   * Called in response to the new note form being submitted\n   *\n   * Adds new note to list.\n   */\n  addNote($form, note) {\n    return this.renderNote(note);\n  }\n\n  addNoteError($form) {\n    let formParentTimeline;\n    if ($form.hasClass('js-main-target-form')) {\n      formParentTimeline = $form.parents('.timeline');\n    } else if ($form.hasClass('js-discussion-note-form')) {\n      formParentTimeline = $form.closest('.discussion-notes').find('.notes');\n    }\n    return this.addFlash(\n      'Your comment could not be submitted! Please check your network connection and try again.',\n      'alert',\n      formParentTimeline.get(0),\n    );\n  }\n\n  updateNoteError($parentTimeline) {\n    // eslint-disable-next-line no-new\n    new Flash(\n      'Your comment could not be updated! Please check your network connection and try again.',\n    );\n  }\n\n  /**\n   * Called in response to the new note form being submitted\n   *\n   * Adds new note to list.\n   */\n  addDiscussionNote($form, note, isNewDiffComment) {\n    if ($form.attr('data-resolve-all') != null) {\n      var projectPath = $form.data('projectPath');\n      var discussionId = $form.data('discussionId');\n      var mergeRequestId = $form.data('noteableIid');\n\n      if (ResolveService != null) {\n        ResolveService.toggleResolveForDiscussion(mergeRequestId, discussionId);\n      }\n    }\n\n    this.renderNote(note, $form);\n    // cleanup after successfully creating a diff/discussion note\n    if (isNewDiffComment) {\n      this.removeDiscussionNoteForm($form);\n    }\n  }\n\n  /**\n   * Called in response to the edit note form being submitted\n   *\n   * Updates the current note field.\n   */\n  updateNote(noteEntity, $targetNote) {\n    var $noteEntityEl, $note_li;\n    // Convert returned HTML to a jQuery object so we can modify it further\n    $noteEntityEl = $(noteEntity.html);\n    this.revertNoteEditForm($targetNote);\n    $noteEntityEl.renderGFM();\n    // Find the note's `li` element by ID and replace it with the updated HTML\n    $note_li = $('.note-row-' + noteEntity.id);\n\n    $note_li.replaceWith($noteEntityEl);\n    this.setupNewNote($noteEntityEl);\n\n    if (typeof gl.diffNotesCompileComponents !== 'undefined') {\n      gl.diffNotesCompileComponents();\n    }\n  }\n\n  checkContentToAllowEditing($el) {\n    var initialContent = $el\n      .find('.original-note-content')\n      .text()\n      .trim();\n    var currentContent = $el.find('.js-note-text').val();\n    var isAllowed = true;\n\n    if (currentContent === initialContent) {\n      this.removeNoteEditForm($el);\n    } else {\n      var $buttons = $el.find('.note-form-actions');\n      var isWidgetVisible = isInViewport($el.get(0));\n\n      if (!isWidgetVisible) {\n        scrollToElement($el);\n      }\n\n      $el.find('.js-finish-edit-warning').show();\n      isAllowed = false;\n    }\n\n    return isAllowed;\n  }\n\n  /**\n   * Called in response to clicking the edit note link\n   *\n   * Replaces the note text with the note edit form\n   * Adds a data attribute to the form with the original content of the note for cancellations\n   */\n  showEditForm(e, scrollTo, myLastNote) {\n    e.preventDefault();\n\n    var $target = $(e.target);\n    var $editForm = $(this.getEditFormSelector($target));\n    var $note = $target.closest('.note');\n    var $currentlyEditing = $('.note.is-editing:visible');\n\n    if ($currentlyEditing.length) {\n      var isEditAllowed = this.checkContentToAllowEditing($currentlyEditing);\n\n      if (!isEditAllowed) {\n        return;\n      }\n    }\n\n    $note.find('.js-note-attachment-delete').show();\n    $editForm.addClass('current-note-edit-form');\n    $note.addClass('is-editing');\n    this.putEditFormInPlace($target);\n  }\n\n  /**\n   * Called in response to clicking the edit note link\n   *\n   * Hides edit form and restores the original note text to the editor textarea.\n   */\n  cancelEdit(e) {\n    e.preventDefault();\n    const $target = $(e.target);\n    const $note = $target.closest('.note');\n    const noteId = $note.attr('data-note-id');\n\n    this.revertNoteEditForm($target);\n\n    if (this.updatedNotesTrackingMap[noteId]) {\n      const $newNote = $(this.updatedNotesTrackingMap[noteId].html);\n      $note.replaceWith($newNote);\n      this.setupNewNote($newNote);\n      // Now that we have taken care of the update, clear it out\n      delete this.updatedNotesTrackingMap[noteId];\n    } else {\n      $note.find('.js-finish-edit-warning').hide();\n      this.removeNoteEditForm($note);\n    }\n  }\n\n  revertNoteEditForm($target) {\n    $target = $target || $('.note.is-editing:visible');\n    var selector = this.getEditFormSelector($target);\n    var $editForm = $(selector);\n\n    $editForm.insertBefore('.diffs');\n    $editForm.find('.js-comment-save-button').enable();\n    $editForm.find('.js-finish-edit-warning').hide();\n  }\n\n  getEditFormSelector($el) {\n    var selector = '.note-edit-form:not(.mr-note-edit-form)';\n\n    if ($el.parents('#diffs').length) {\n      selector = '.note-edit-form.mr-note-edit-form';\n    }\n\n    return selector;\n  }\n\n  removeNoteEditForm($note) {\n    var form = $note.find('.diffs .current-note-edit-form');\n\n    $note.removeClass('is-editing');\n    form.removeClass('current-note-edit-form');\n    form.find('.js-finish-edit-warning').hide();\n    // Replace markdown textarea text with original note text.\n    return form.find('.js-note-text').val(form.find('form.edit-note').data('originalNote'));\n  }\n\n  /**\n   * Called in response to deleting a note of any kind.\n   *\n   * Removes the actual note from view.\n   * Removes the whole discussion if the last note is being removed.\n   */\n  removeNote(e) {\n    var noteElId, noteId, dataNoteId, $note, lineHolder;\n    $note = $(e.currentTarget).closest('.note');\n    noteElId = $note.attr('id');\n    noteId = $note.attr('data-note-id');\n    lineHolder = $(e.currentTarget)\n      .closest('.notes[data-discussion-id]')\n      .closest('.notes_holder')\n      .prev('.line_holder');\n    $(`.note[id=\"${noteElId}\"]`).each(\n      (function(_this) {\n        // A same note appears in the \"Discussion\" and in the \"Changes\" tab, we have\n        // to remove all. Using $('.note[id='noteId']') ensure we get all the notes,\n        // where $('#noteId') would return only one.\n        return function(i, el) {\n          var $note, $notes;\n          $note = $(el);\n          $notes = $note.closest('.discussion-notes');\n          const discussionId = $('.notes', $notes).data('discussionId');\n\n          if (typeof gl.diffNotesCompileComponents !== 'undefined') {\n            if (gl.diffNoteApps[noteElId]) {\n              gl.diffNoteApps[noteElId].$destroy();\n            }\n          }\n\n          $note.remove();\n\n          // check if this is the last note for this line\n          if ($notes.find('.note').length === 0) {\n            var notesTr = $notes.closest('tr');\n\n            // \"Discussions\" tab\n            $notes.closest('.timeline-entry').remove();\n\n            $(`.js-diff-avatars-${discussionId}`).trigger('remove.vue');\n\n            // The notes tr can contain multiple lists of notes, like on the parallel diff\n            // notesTr does not exist for image diffs\n            if (notesTr.find('.discussion-notes').length > 1 || notesTr.length === 0) {\n              const $diffFile = $notes.closest('.diff-file');\n              if ($diffFile.length > 0) {\n                const removeBadgeEvent = new CustomEvent('removeBadge.imageDiff', {\n                  detail: {\n                    // badgeNumber's start with 1 and index starts with 0\n                    badgeNumber: $notes.index() + 1,\n                  },\n                });\n\n                $diffFile[0].dispatchEvent(removeBadgeEvent);\n              }\n\n              $notes.remove();\n            } else if (notesTr.length > 0) {\n              notesTr.remove();\n            }\n          }\n        };\n      })(this),\n    );\n\n    Notes.checkMergeRequestStatus();\n    return this.updateNotesCount(-1);\n  }\n\n  /**\n   * Called in response to clicking the delete attachment link\n   *\n   * Removes the attachment wrapper view, including image tag if it exists\n   * Resets the note editing form\n   */\n  removeAttachment() {\n    const $note = $(this).closest('.note');\n    $note.find('.note-attachment').remove();\n    $note.find('.note-body > .note-text').show();\n    $note.find('.note-header').show();\n    return $note.find('.diffs .current-note-edit-form').remove();\n  }\n\n  /**\n   * Called when clicking on the \"reply\" button for a diff line.\n   *\n   * Shows the note form below the notes.\n   */\n  onReplyToDiscussionNote(e) {\n    this.replyToDiscussionNote(e.target);\n  }\n\n  replyToDiscussionNote(target) {\n    var form, replyLink;\n    form = this.cleanForm(this.formClone.clone());\n    replyLink = $(target).closest('.js-discussion-reply-button');\n    // insert the form after the button\n    replyLink\n      .closest('.discussion-reply-holder')\n      .hide()\n      .after(form);\n    // show the form\n    return this.setupDiscussionNoteForm(replyLink, form);\n  }\n\n  /**\n   * Shows the diff or discussion form and does some setup on it.\n   *\n   * Sets some hidden fields in the form.\n   *\n   * Note: dataHolder must have the \"discussionId\" and \"lineCode\" data attributes set.\n   */\n  setupDiscussionNoteForm(dataHolder, form) {\n    // set up note target\n    let diffFileData = dataHolder.closest('.text-file');\n\n    if (diffFileData.length === 0) {\n      diffFileData = dataHolder.closest('.image');\n    }\n\n    var discussionID = dataHolder.data('discussionId');\n\n    if (discussionID) {\n      form.attr('data-discussion-id', discussionID);\n      form.find('#in_reply_to_discussion_id').val(discussionID);\n    }\n\n    form.find('#note_project_id').val(dataHolder.data('discussionProjectId'));\n\n    form.attr('data-line-code', dataHolder.data('lineCode'));\n    form.find('#line_type').val(dataHolder.data('lineType'));\n\n    form.find('#note_noteable_type').val(diffFileData.data('noteableType'));\n    form.find('#note_noteable_id').val(diffFileData.data('noteableId'));\n    form.find('#note_commit_id').val(diffFileData.data('commitId'));\n\n    form.find('#note_type').val(dataHolder.data('noteType'));\n\n    // LegacyDiffNote\n    form.find('#note_line_code').val(dataHolder.data('lineCode'));\n\n    // DiffNote\n    form.find('#note_position').val(dataHolder.attr('data-position'));\n\n    form\n      .find('.js-close-discussion-note-form')\n      .show()\n      .removeClass('hide');\n    form.find('.js-note-target-close').remove();\n    form.find('.js-note-new-discussion').remove();\n    this.setupNoteForm(form);\n\n    form.removeClass('js-main-target-form').addClass('discussion-form js-discussion-note-form');\n\n    if (typeof gl.diffNotesCompileComponents !== 'undefined') {\n      var $commentBtn = form.find('comment-and-resolve-btn');\n      $commentBtn.attr(':discussion-id', `'${discussionID}'`);\n\n      gl.diffNotesCompileComponents();\n    }\n\n    form.find('.js-note-text').focus();\n    form.find('.js-comment-resolve-button').attr('data-discussion-id', discussionID);\n  }\n\n  /**\n   * Called when clicking on the \"add a comment\" button on the side of a diff line.\n   *\n   * Inserts a temporary row for the form below the line.\n   * Sets up the form and shows it.\n   */\n  onAddDiffNote(e) {\n    e.preventDefault();\n    const link = e.currentTarget || e.target;\n    const $link = $(link);\n    const showReplyInput = !$link.hasClass('js-diff-comment-avatar');\n    this.toggleDiffNote({\n      target: $link,\n      lineType: link.dataset.lineType,\n      showReplyInput,\n    });\n  }\n\n  onAddImageDiffNote(e) {\n    const $link = $(e.currentTarget || e.target);\n    const $diffFile = $link.closest('.diff-file');\n\n    const clickEvent = new CustomEvent('click.imageDiff', {\n      detail: e,\n    });\n\n    $diffFile[0].dispatchEvent(clickEvent);\n\n    // Set up comment form\n    let newForm;\n    const $noteContainer = $link.closest('.diff-viewer').find('.note-container');\n    const $form = $noteContainer.find('> .discussion-form');\n\n    if ($form.length === 0) {\n      newForm = this.cleanForm(this.formClone.clone());\n      newForm.appendTo($noteContainer);\n    } else {\n      newForm = $form;\n    }\n\n    this.setupDiscussionNoteForm($link, newForm);\n  }\n\n  toggleDiffNote({ target, lineType, forceShow, showReplyInput = false }) {\n    var $link,\n      addForm,\n      hasNotes,\n      newForm,\n      noteForm,\n      replyButton,\n      row,\n      rowCssToAdd,\n      targetContent,\n      isDiffCommentAvatar;\n    $link = $(target);\n    row = $link.closest('tr');\n    const nextRow = row.next();\n    let targetRow = row;\n    if (nextRow.is('.notes_holder')) {\n      targetRow = nextRow;\n    }\n\n    hasNotes = nextRow.is('.notes_holder');\n    addForm = false;\n    let lineTypeSelector = '';\n    rowCssToAdd =\n      '<tr class=\"notes_holder js-temp-notes-holder\"><td class=\"notes_content\" colspan=\"3\"><div class=\"content\"></div></td></tr>';\n    // In parallel view, look inside the correct left/right pane\n    if (this.isParallelView()) {\n      lineTypeSelector = `.${lineType}`;\n      rowCssToAdd =\n        '<tr class=\"notes_holder js-temp-notes-holder\"><td class=\"notes_line old\"></td><td class=\"notes_content parallel old\"><div class=\"content\"></div></td><td class=\"notes_line new\"></td><td class=\"notes_content parallel new\"><div class=\"content\"></div></td></tr>';\n    }\n    const notesContentSelector = `.notes_content${lineTypeSelector} .content`;\n    let notesContent = targetRow.find(notesContentSelector);\n\n    if (hasNotes && showReplyInput) {\n      targetRow.show();\n      notesContent = targetRow.find(notesContentSelector);\n      if (notesContent.length) {\n        notesContent.show();\n        replyButton = notesContent.find('.js-discussion-reply-button:visible');\n        if (replyButton.length) {\n          this.replyToDiscussionNote(replyButton[0]);\n        } else {\n          // In parallel view, the form may not be present in one of the panes\n          noteForm = notesContent.find('.js-discussion-note-form');\n          if (noteForm.length === 0) {\n            addForm = true;\n          }\n        }\n      }\n    } else if (showReplyInput) {\n      // add a notes row and insert the form\n      row.after(rowCssToAdd);\n      targetRow = row.next();\n      notesContent = targetRow.find(notesContentSelector);\n      addForm = true;\n    } else {\n      const isCurrentlyShown = targetRow.find('.content:not(:empty)').is(':visible');\n      const isForced = forceShow === true || forceShow === false;\n      const showNow = forceShow === true || (!isCurrentlyShown && !isForced);\n\n      targetRow.toggleClass('hide', !showNow);\n      notesContent.toggleClass('hide', !showNow);\n    }\n\n    if (addForm) {\n      newForm = this.cleanForm(this.formClone.clone());\n      newForm.appendTo(notesContent);\n      // show the form\n      return this.setupDiscussionNoteForm($link, newForm);\n    }\n  }\n\n  /**\n   * Called in response to \"cancel\" on a diff note form.\n   *\n   * Shows the reply button again.\n   * Removes the form and if necessary it's temporary row.\n   */\n  removeDiscussionNoteForm(form) {\n    var glForm, row;\n    row = form.closest('tr');\n    glForm = form.data('glForm');\n    glForm.destroy();\n    form\n      .find('.js-note-text')\n      .data('autosave')\n      .reset();\n    // show the reply button (will only work for replies)\n    form.prev('.discussion-reply-holder').show();\n    if (row.is('.js-temp-notes-holder')) {\n      // remove temporary row for diff lines\n      return row.remove();\n    } else {\n      // only remove the form\n      return form.remove();\n    }\n  }\n\n  cancelDiscussionForm(e) {\n    e.preventDefault();\n    const $form = $(e.target).closest('.js-discussion-note-form');\n    const $discussionNote = $(e.target).closest('.discussion-notes');\n\n    if ($discussionNote.length === 0) {\n      // Only send blur event when the discussion form\n      // is not part of a discussion note\n      const $diffFile = $form.closest('.diff-file');\n\n      if ($diffFile.length > 0) {\n        const blurEvent = new CustomEvent('blur.imageDiff', {\n          detail: e,\n        });\n\n        $diffFile[0].dispatchEvent(blurEvent);\n      }\n    }\n\n    return this.removeDiscussionNoteForm($form);\n  }\n\n  /**\n   * Called after an attachment file has been selected.\n   *\n   * Updates the file name for the selected attachment.\n   */\n  updateFormAttachment() {\n    var filename, form;\n    form = $(this).closest('form');\n    // get only the basename\n    filename = $(this)\n      .val()\n      .replace(/^.*[\\\\\\/]/, '');\n    return form.find('.js-attachment-filename').text(filename);\n  }\n\n  /**\n   * Called when the tab visibility changes\n   */\n  visibilityChange() {\n    return this.refresh();\n  }\n\n  updateTargetButtons(e) {\n    var closebtn, closetext, form, reopenbtn, reopentext, textarea;\n    textarea = $(e.target);\n    form = textarea.parents('form');\n    reopenbtn = form.find('.js-note-target-reopen');\n    closebtn = form.find('.js-note-target-close');\n\n    if (textarea.val().trim().length > 0) {\n      reopentext = reopenbtn.attr('data-alternative-text');\n      closetext = closebtn.attr('data-alternative-text');\n      if (reopenbtn.text() !== reopentext) {\n        reopenbtn.text(reopentext);\n      }\n      if (closebtn.text() !== closetext) {\n        closebtn.text(closetext);\n      }\n      if (reopenbtn.is(':not(.btn-comment-and-reopen)')) {\n        reopenbtn.addClass('btn-comment-and-reopen');\n      }\n      if (closebtn.is(':not(.btn-comment-and-close)')) {\n        closebtn.addClass('btn-comment-and-close');\n      }\n    } else {\n      reopentext = reopenbtn.data('originalText');\n      closetext = closebtn.data('originalText');\n      if (reopenbtn.text() !== reopentext) {\n        reopenbtn.text(reopentext);\n      }\n      if (closebtn.text() !== closetext) {\n        closebtn.text(closetext);\n      }\n      if (reopenbtn.is('.btn-comment-and-reopen')) {\n        reopenbtn.removeClass('btn-comment-and-reopen');\n      }\n      if (closebtn.is('.btn-comment-and-close')) {\n        closebtn.removeClass('btn-comment-and-close');\n      }\n    }\n  }\n\n  putEditFormInPlace($el) {\n    var $editForm = $(this.getEditFormSelector($el));\n    var $note = $el.closest('.note');\n\n    $editForm.insertAfter($note.find('.note-text'));\n\n    var $originalContentEl = $note.find('.original-note-content');\n    var originalContent = $originalContentEl.text().trim();\n    var postUrl = $originalContentEl.data('postUrl');\n    var targetId = $originalContentEl.data('targetId');\n    var targetType = $originalContentEl.data('targetType');\n    var markdownVersion = $originalContentEl.data('markdownVersion');\n\n    this.glForm = new GLForm($editForm.find('form'), this.enableGFM);\n\n    $editForm\n      .find('form')\n      .attr('action', `${postUrl}?html=true`)\n      .attr('data-remote', 'true')\n      .attr('data-markdown-version', markdownVersion);\n    $editForm.find('.js-form-target-id').val(targetId);\n    $editForm.find('.js-form-target-type').val(targetType);\n    $editForm\n      .find('.js-note-text')\n      .focus()\n      .val(originalContent);\n    $editForm.find('.js-md-write-button').trigger('click');\n    $editForm.find('.referenced-users').hide();\n  }\n\n  putConflictEditWarningInPlace(noteEntity, $note) {\n    if ($note.find('.js-conflict-edit-warning').length === 0) {\n      const $alert = $(`<div class=\"js-conflict-edit-warning alert alert-danger\">\n        This comment has changed since you started editing, please review the\n        <a href=\"#note_${noteEntity.id}\" target=\"_blank\" rel=\"noopener noreferrer\">\n          updated comment\n        </a>\n        to ensure information is not lost\n      </div>`);\n      $alert.insertAfter($note.find('.note-text'));\n    }\n  }\n\n  updateNotesCount(updateCount) {\n    return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(), 10) + updateCount);\n  }\n\n  static renderPlaceholderComponent($container) {\n    const el = $container.find('.js-code-placeholder').get(0);\n    // eslint-disable-next-line no-new\n    new Vue({\n      el,\n      components: {\n        GlSkeletonLoading,\n      },\n      render(createElement) {\n        return createElement('gl-skeleton-loading');\n      },\n    });\n  }\n\n  static renderDiffContent($container, data) {\n    const { discussion_html } = data;\n    const lines = $(discussion_html).find('.line_holder');\n    lines.addClass('fade-in');\n    $container.find('.diff-content > table > tbody').prepend(lines);\n    const fileHolder = $container.find('.file-holder');\n    $container.find('.line-holder-placeholder').remove();\n    syntaxHighlight(fileHolder);\n  }\n\n  onClickRetryLazyLoad(e) {\n    const $retryButton = $(e.currentTarget);\n\n    $retryButton.prop('disabled', true);\n\n    return this.loadLazyDiff(e).then(() => {\n      $retryButton.prop('disabled', false);\n    });\n  }\n\n  loadLazyDiff(e) {\n    const $container = $(e.currentTarget).closest('.js-toggle-container');\n    Notes.renderPlaceholderComponent($container);\n\n    $container.find('.js-toggle-lazy-diff').removeClass('js-toggle-lazy-diff');\n\n    const $tableEl = $container.find('tbody');\n    if ($tableEl.length === 0) return;\n\n    const fileHolder = $container.find('.file-holder');\n    const url = fileHolder.data('linesPath');\n\n    const $errorContainer = $container.find('.js-error-lazy-load-diff');\n    const $successContainer = $container.find('.js-success-lazy-load');\n\n    /**\n     * We only fetch resolved discussions.\n     * Unresolved discussions don't have an endpoint being provided.\n     */\n    if (url) {\n      return axios\n        .get(url)\n        .then(({ data }) => {\n          // Reset state in case last request returned error\n          $successContainer.removeClass('hidden');\n          $errorContainer.addClass('hidden');\n\n          Notes.renderDiffContent($container, data);\n        })\n        .catch(() => {\n          $successContainer.addClass('hidden');\n          $errorContainer.removeClass('hidden');\n        });\n    }\n    return Promise.resolve();\n  }\n\n  toggleCommitList(e) {\n    const $element = $(e.currentTarget);\n    const $closestSystemCommitList = $element.siblings('.system-note-commit-list');\n\n    $element\n      .find('.fa')\n      .toggleClass('fa-angle-down')\n      .toggleClass('fa-angle-up');\n    $closestSystemCommitList.toggleClass('hide-shade');\n  }\n\n  /**\n   * Scans system notes with `ul` elements in system note body\n   * then collapse long commit list pushed by user to make it less\n   * intrusive.\n   */\n  collapseLongCommitList() {\n    const systemNotes = $('#notes-list')\n      .find('li.system-note')\n      .has('ul');\n\n    $.each(systemNotes, function(index, systemNote) {\n      const $systemNote = $(systemNote);\n      const headerMessage = $systemNote\n        .find('.note-text')\n        .find('p:first')\n        .text()\n        .replace(':', '');\n\n      $systemNote.find('.note-header .system-note-message').html(headerMessage);\n\n      if ($systemNote.find('li').length > MAX_VISIBLE_COMMIT_LIST_COUNT) {\n        $systemNote.find('.note-text').addClass('system-note-commit-list');\n        $systemNote.find('.system-note-commit-list-toggler').show();\n      } else {\n        $systemNote.find('.note-text').addClass('system-note-commit-list hide-shade');\n      }\n    });\n  }\n\n  addFlash(...flashParams) {\n    this.flashContainer = new Flash(...flashParams);\n  }\n\n  clearFlash() {\n    if (this.flashContainer) {\n      this.flashContainer.style.display = 'none';\n      this.flashContainer = null;\n    }\n  }\n\n  cleanForm($form) {\n    // Remove JS classes that are not needed here\n    $form.find('.js-comment-type-dropdown').removeClass('btn-group');\n\n    // Remove dropdown\n    $form.find('.dropdown-menu').remove();\n\n    return $form;\n  }\n\n  /**\n   * Check if note does not exists on page\n   */\n  static isNewNote(noteEntity, noteIds) {\n    return $.inArray(noteEntity.id, noteIds) === -1;\n  }\n\n  /**\n   * Check if $note already contains the `noteEntity` content\n   */\n  static isUpdatedNote(noteEntity, $note) {\n    // There can be CRLF vs LF mismatches if we don't sanitize and compare the same way\n    const sanitizedNoteEntityText = normalizeNewlines(noteEntity.note.trim());\n    const currentNoteText = normalizeNewlines(\n      $note\n        .find('.original-note-content')\n        .first()\n        .text()\n        .trim(),\n    );\n    return sanitizedNoteEntityText !== currentNoteText;\n  }\n\n  static checkMergeRequestStatus() {\n    if (getPagePath(1) === 'merge_requests' && gl.mrWidget) {\n      gl.mrWidget.checkStatus();\n    }\n  }\n\n  static animateAppendNote(noteHtml, $notesList) {\n    const $note = $(noteHtml);\n\n    $note.addClass('fade-in-full').renderGFM();\n    $notesList.append($note);\n    return $note;\n  }\n\n  static animateUpdateNote(noteHtml, $note) {\n    const $updatedNote = $(noteHtml);\n\n    $updatedNote.addClass('fade-in').renderGFM();\n    $note.replaceWith($updatedNote);\n    return $updatedNote;\n  }\n\n  /**\n   * Get data from Form attributes to use for saving/submitting comment.\n   */\n  getFormData($form) {\n    const content = $form.find('.js-note-text').val();\n    return {\n      formData: $form.serialize(),\n      formContent: _.escape(content),\n      formAction: $form.attr('action'),\n      formContentOriginal: content,\n    };\n  }\n\n  /**\n   * Identify if comment has any quick actions\n   */\n  hasQuickActions(formContent) {\n    return REGEX_QUICK_ACTIONS.test(formContent);\n  }\n\n  /**\n   * Remove quick actions and leave comment with pure message\n   */\n  stripQuickActions(formContent) {\n    return formContent.replace(REGEX_QUICK_ACTIONS, '').trim();\n  }\n\n  /**\n   * Gets appropriate description from quick actions found in provided `formContent`\n   */\n  getQuickActionDescription(formContent, availableQuickActions = []) {\n    let tempFormContent;\n\n    // Identify executed quick actions from `formContent`\n    const executedCommands = availableQuickActions.filter((command, index) => {\n      const commandRegex = new RegExp(`/${command.name}`);\n      return commandRegex.test(formContent);\n    });\n\n    if (executedCommands && executedCommands.length) {\n      if (executedCommands.length > 1) {\n        tempFormContent = 'Applying multiple commands';\n      } else {\n        const commandDescription = executedCommands[0].description.toLowerCase();\n        tempFormContent = `Applying command to ${commandDescription}`;\n      }\n    } else {\n      tempFormContent = 'Applying command';\n    }\n\n    return tempFormContent;\n  }\n\n  /**\n   * Create placeholder note DOM element populated with comment body\n   * that we will show while comment is being posted.\n   * Once comment is _actually_ posted on server, we will have final element\n   * in response that we will show in place of this temporary element.\n   */\n  createPlaceholderNote({\n    formContent,\n    uniqueId,\n    isDiscussionNote,\n    currentUsername,\n    currentUserFullname,\n    currentUserAvatar,\n  }) {\n    const discussionClass = isDiscussionNote ? 'discussion' : '';\n    const $tempNote = $(\n      `<li id=\"${uniqueId}\" class=\"note being-posted fade-in-half timeline-entry\">\n         <div class=\"timeline-entry-inner\">\n            <div class=\"timeline-icon\">\n               <a href=\"/${_.escape(currentUsername)}\">\n                 <img class=\"avatar s40\" src=\"${currentUserAvatar}\" />\n               </a>\n            </div>\n            <div class=\"timeline-content ${discussionClass}\">\n               <div class=\"note-header\">\n                  <div class=\"note-header-info\">\n                     <a href=\"/${_.escape(currentUsername)}\">\n                       <span class=\"d-none d-sm-inline-block\">${_.escape(currentUsername)}</span>\n                       <span class=\"note-headline-light\">${_.escape(currentUsername)}</span>\n                     </a>\n                  </div>\n               </div>\n               <div class=\"note-body\">\n                 <div class=\"note-text\">\n                   <p>${formContent}</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>`,\n    );\n\n    $tempNote.find('.d-none.d-sm-inline-block').text(_.escape(currentUserFullname));\n    $tempNote.find('.note-headline-light').text(`@${_.escape(currentUsername)}`);\n\n    return $tempNote;\n  }\n\n  /**\n   * Create Placeholder System Note DOM element populated with quick action description\n   */\n  createPlaceholderSystemNote({ formContent, uniqueId }) {\n    const $tempNote = $(\n      `<li id=\"${uniqueId}\" class=\"note system-note timeline-entry being-posted fade-in-half\">\n         <div class=\"timeline-entry-inner\">\n           <div class=\"timeline-content\">\n             <i>${formContent}</i>\n           </div>\n         </div>\n       </li>`,\n    );\n\n    return $tempNote;\n  }\n\n  /**\n   * This method does following tasks step-by-step whenever a new comment\n   * is submitted by user (both main thread comments as well as discussion comments).\n   *\n   * 1) Get Form metadata\n   * 2) Identify comment type; a) Main thread b) Discussion thread c) Discussion resolve\n   * 3) Build temporary placeholder element (using `createPlaceholderNote`)\n   * 4) Show placeholder note on UI\n   * 5) Perform network request to submit the note using `axios.post`\n   *    a) If request is successfully completed\n   *        1. Remove placeholder element\n   *        2. Show submitted Note element\n   *        3. Perform post-submit errands\n   *           a. Mark discussion as resolved if comment submission was for resolve.\n   *           b. Reset comment form to original state.\n   *    b) If request failed\n   *        1. Remove placeholder element\n   *        2. Show error Flash message about failure\n   */\n  postComment(e) {\n    e.preventDefault();\n\n    // Get Form metadata\n    const $submitBtn = $(e.target);\n    $submitBtn.prop('disabled', true);\n    let $form = $submitBtn.parents('form');\n    const $closeBtn = $form.find('.js-note-target-close');\n    const isDiscussionNote =\n      $submitBtn\n        .parent()\n        .find('li.droplab-item-selected')\n        .attr('id') === 'discussion';\n    const isMainForm = $form.hasClass('js-main-target-form');\n    const isDiscussionForm = $form.hasClass('js-discussion-note-form');\n    const isDiscussionResolve = $submitBtn.hasClass('js-comment-resolve-button');\n    const { formData, formContent, formAction, formContentOriginal } = this.getFormData($form);\n    let noteUniqueId;\n    let systemNoteUniqueId;\n    let hasQuickActions = false;\n    let $notesContainer;\n    let tempFormContent;\n\n    // Get reference to notes container based on type of comment\n    if (isDiscussionForm) {\n      $notesContainer = $form.parent('.discussion-notes').find('.notes');\n    } else if (isMainForm) {\n      $notesContainer = $('ul.main-notes-list');\n    }\n\n    // If comment is to resolve discussion, disable submit buttons while\n    // comment posting is finished.\n    if (isDiscussionResolve) {\n      $form.find('.js-comment-submit-button').disable();\n    }\n\n    tempFormContent = formContent;\n    if (this.hasQuickActions(formContent)) {\n      tempFormContent = this.stripQuickActions(formContent);\n      hasQuickActions = true;\n    }\n\n    // Show placeholder note\n    if (tempFormContent) {\n      noteUniqueId = _.uniqueId('tempNote_');\n      $notesContainer.append(\n        this.createPlaceholderNote({\n          formContent: tempFormContent,\n          uniqueId: noteUniqueId,\n          isDiscussionNote,\n          currentUsername: gon.current_username,\n          currentUserFullname: gon.current_user_fullname,\n          currentUserAvatar: gon.current_user_avatar_url,\n        }),\n      );\n    }\n\n    // Show placeholder system note\n    if (hasQuickActions) {\n      systemNoteUniqueId = _.uniqueId('tempSystemNote_');\n      $notesContainer.append(\n        this.createPlaceholderSystemNote({\n          formContent: this.getQuickActionDescription(\n            formContent,\n            AjaxCache.get(gl.GfmAutoComplete.dataSources.commands),\n          ),\n          uniqueId: systemNoteUniqueId,\n        }),\n      );\n    }\n\n    // Clear the form textarea\n    if ($notesContainer.length) {\n      if (isMainForm) {\n        this.resetMainTargetForm(e);\n      } else if (isDiscussionForm) {\n        this.removeDiscussionNoteForm($form);\n      }\n    }\n\n    $closeBtn.text($closeBtn.data('originalText'));\n\n    // Make request to submit comment on server\n    return axios\n      .post(`${formAction}?html=true`, formData)\n      .then(res => {\n        const note = res.data;\n\n        $submitBtn.prop('disabled', false);\n        // Submission successful! remove placeholder\n        $notesContainer.find(`#${noteUniqueId}`).remove();\n\n        const $diffFile = $form.closest('.diff-file');\n        if ($diffFile.length > 0) {\n          const blurEvent = new CustomEvent('blur.imageDiff', {\n            detail: e,\n          });\n\n          $diffFile[0].dispatchEvent(blurEvent);\n        }\n\n        // Reset cached commands list when command is applied\n        if (hasQuickActions) {\n          $form.find('textarea.js-note-text').trigger('clear-commands-cache.atwho');\n        }\n\n        // Clear previous form errors\n        this.clearFlashWrapper();\n\n        // Check if this was discussion comment\n        if (isDiscussionForm) {\n          // Remove flash-container\n          $notesContainer.find('.flash-container').remove();\n\n          // If comment intends to resolve discussion, do the same.\n          if (isDiscussionResolve) {\n            $form\n              .attr('data-discussion-id', $submitBtn.data('discussionId'))\n              .attr('data-resolve-all', 'true')\n              .attr('data-project-path', $submitBtn.data('projectPath'));\n          }\n\n          // Show final note element on UI\n          const isNewDiffComment = $notesContainer.length === 0;\n          this.addDiscussionNote($form, note, isNewDiffComment);\n\n          if (isNewDiffComment) {\n            // Add image badge, avatar badge and toggle discussion badge for new image diffs\n            const notePosition = $form.find('#note_position').val();\n            if ($diffFile.length > 0 && notePosition.length > 0) {\n              const { x, y, width, height } = JSON.parse(notePosition);\n              const addBadgeEvent = new CustomEvent('addBadge.imageDiff', {\n                detail: {\n                  x,\n                  y,\n                  width,\n                  height,\n                  noteId: `note_${note.id}`,\n                  discussionId: note.discussion_id,\n                },\n              });\n\n              $diffFile[0].dispatchEvent(addBadgeEvent);\n            }\n          }\n\n          // append flash-container to the Notes list\n          if ($notesContainer.length) {\n            $notesContainer.append('<div class=\"flash-container\" style=\"display: none;\"></div>');\n          }\n        } else if (isMainForm) {\n          // Check if this was main thread comment\n          // Show final note element on UI and perform form and action buttons cleanup\n          this.addNote($form, note);\n          this.reenableTargetFormSubmitButton(e);\n        }\n\n        if (note.commands_changes) {\n          this.handleQuickActions(note);\n        }\n\n        $form.trigger('ajax:success', [note]);\n      })\n      .catch(() => {\n        // Submission failed, remove placeholder note and show Flash error message\n        $notesContainer.find(`#${noteUniqueId}`).remove();\n        $submitBtn.prop('disabled', false);\n        const blurEvent = new CustomEvent('blur.imageDiff', {\n          detail: e,\n        });\n\n        const closestDiffFile = $form.closest('.diff-file');\n\n        if (closestDiffFile.length) {\n          closestDiffFile[0].dispatchEvent(blurEvent);\n        }\n\n        if (hasQuickActions) {\n          $notesContainer.find(`#${systemNoteUniqueId}`).remove();\n        }\n\n        // Show form again on UI on failure\n        if (isDiscussionForm && $notesContainer.length) {\n          const replyButton = $notesContainer.parent().find('.js-discussion-reply-button');\n          this.replyToDiscussionNote(replyButton[0]);\n          $form = $notesContainer.parent().find('form');\n        }\n\n        $form.find('.js-note-text').val(formContentOriginal);\n        this.reenableTargetFormSubmitButton(e);\n        this.addNoteError($form);\n      });\n  }\n\n  /**\n   * This method does following tasks step-by-step whenever an existing comment\n   * is updated by user (both main thread comments as well as discussion comments).\n   *\n   * 1) Get Form metadata\n   * 2) Update note element with new content\n   * 3) Perform network request to submit the updated note using `axios.post`\n   *    a) If request is successfully completed\n   *        1. Show submitted Note element\n   *    b) If request failed\n   *        1. Revert Note element to original content\n   *        2. Show error Flash message about failure\n   */\n  updateComment(e) {\n    e.preventDefault();\n\n    // Get Form metadata\n    const $submitBtn = $(e.target);\n    const $form = $submitBtn.parents('form');\n    const $closeBtn = $form.find('.js-note-target-close');\n    const $editingNote = $form.parents('.note.is-editing');\n    const $noteBody = $editingNote.find('.js-task-list-container');\n    const $noteBodyText = $noteBody.find('.note-text');\n    const { formData, formContent, formAction } = this.getFormData($form);\n    const $diffFile = $form.closest('.diff-file');\n    const $notesContainer = $form.closest('.notes');\n\n    // Cache original comment content\n    const cachedNoteBodyText = $noteBodyText.html();\n\n    // Show updated comment content temporarily\n    $noteBodyText.html(formContent);\n    $editingNote.removeClass('is-editing fade-in-full').addClass('being-posted fade-in-half');\n    $editingNote\n      .find('.note-headline-meta a')\n      .html(\n        '<i class=\"fa fa-spinner fa-spin\" aria-label=\"Comment is being updated\" aria-hidden=\"true\"></i>',\n      );\n\n    // Make request to update comment on server\n    axios\n      .post(`${formAction}?html=true`, formData)\n      .then(({ data }) => {\n        // Submission successful! render final note element\n        this.updateNote(data, $editingNote);\n      })\n      .catch(() => {\n        // Submission failed, revert back to original note\n        $noteBodyText.html(_.escape(cachedNoteBodyText));\n        $editingNote.removeClass('being-posted fade-in');\n        $editingNote.find('.fa.fa-spinner').remove();\n\n        // Show Flash message about failure\n        this.updateNoteError();\n      });\n\n    return $closeBtn.text($closeBtn.data('originalText'));\n  }\n}\n\nwindow.Notes = Notes;\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TaskList\"] = factory();\n\telse\n\t\troot[\"TaskList\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nvar NodeArray, TaskList, closest, createEvent,\n  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nNodeArray = function(nodeList) {\n  return Array.prototype.slice.apply(nodeList);\n};\n\nclosest = function(el, className) {\n  while (el && !el.classList.contains(className)) {\n    el = el.parentNode;\n  }\n  return el;\n};\n\ncreateEvent = function(eventName, detail) {\n  var event;\n  if (typeof Event === 'function') {\n    event = new Event(eventName, {\n      bubbles: true,\n      cancelable: true\n    });\n    event.detail = detail;\n  } else {\n    event = document.createEvent('CustomEvent');\n    event.initCustomEvent(eventName, true, true, detail);\n  }\n  return event;\n};\n\nTaskList = (function() {\n  function TaskList(el1) {\n    this.el = el1;\n    this.container = closest(this.el, 'js-task-list-container');\n    this.field = this.container.querySelector('.js-task-list-field');\n    this.container.addEventListener('change', (function(_this) {\n      return function(event) {\n        if (event.target.classList.contains('task-list-item-checkbox')) {\n          return _this.updateTaskList(event.target);\n        }\n      };\n    })(this));\n    this.enable();\n  }\n\n  TaskList.prototype.enable = function() {\n    var event;\n    if (this.container.querySelectorAll('.js-task-list-field').length > 0) {\n      NodeArray(this.container.querySelectorAll('.task-list-item')).forEach(function(item) {\n        return item.classList.add('enabled');\n      });\n      NodeArray(this.container.querySelectorAll('.task-list-item-checkbox')).forEach(function(checkbox) {\n        return checkbox.disabled = false;\n      });\n      this.container.classList.add('is-task-list-enabled');\n      event = createEvent('tasklist:enabled');\n      return this.container.dispatchEvent(event);\n    }\n  };\n\n  TaskList.prototype.disable = function() {\n    var event;\n    NodeArray(this.container.querySelectorAll('.task-list-item')).forEach(function(item) {\n      return item.classList.remove('enabled');\n    });\n    NodeArray(this.container.querySelectorAll('.task-list-item-checkbox')).forEach(function(checkbox) {\n      return checkbox.disabled = true;\n    });\n    this.container.classList.remove('is-task-list-enabled');\n    event = createEvent('tasklist:disabled');\n    return this.container.dispatchEvent(event);\n  };\n\n  TaskList.prototype.updateTaskList = function(item) {\n    var changeEvent, changedEvent, checkboxes, index;\n    checkboxes = this.container.querySelectorAll('.task-list-item-checkbox');\n    index = 1 + NodeArray(checkboxes).indexOf(item);\n    changeEvent = createEvent('tasklist:change', {\n      index: index,\n      checked: item.checked\n    });\n    this.field.dispatchEvent(changeEvent);\n    if (!changeEvent.defaultPrevented) {\n      this.field.value = TaskList.updateSource(this.field.value, index, item.checked);\n      changeEvent = createEvent('change');\n      this.field.dispatchEvent(changeEvent);\n      changedEvent = createEvent('tasklist:changed', {\n        index: index,\n        checked: item.checked\n      });\n      return this.field.dispatchEvent(changedEvent);\n    }\n  };\n\n  TaskList.incomplete = \"[ ]\";\n\n  TaskList.complete = \"[x]\";\n\n  TaskList.escapePattern = function(str) {\n    return str.replace(/([\\[\\]])/g, \"\\\\$1\").replace(/\\s/, \"\\\\s\").replace(\"x\", \"[xX]\");\n  };\n\n  TaskList.incompletePattern = RegExp(\"\" + (TaskList.escapePattern(TaskList.incomplete)));\n\n  TaskList.completePattern = RegExp(\"\" + (TaskList.escapePattern(TaskList.complete)));\n\n  TaskList.itemPattern = RegExp(\"^(?:\\\\s*(?:>\\\\s*)*(?:[-+*]|(?:\\\\d+\\\\.)))\\\\s*(\" + (TaskList.escapePattern(TaskList.complete)) + \"|\" + (TaskList.escapePattern(TaskList.incomplete)) + \")\\\\s+(?!\\\\(.*?\\\\))(?=(?:\\\\[.*?\\\\]\\\\s*(?:\\\\[.*?\\\\]|\\\\(.*?\\\\))\\\\s*)*(?:[^\\\\[]|$))\");\n\n  TaskList.startFencesPattern = /^`{3}.*$/;\n\n  TaskList.endFencesPattern = /^`{3}$/;\n\n  TaskList.itemsInParasPattern = RegExp(\"^(\" + (TaskList.escapePattern(TaskList.complete)) + \"|\" + (TaskList.escapePattern(TaskList.incomplete)) + \").+$\", \"g\");\n\n  TaskList.updateSource = function(source, itemIndex, checked) {\n    var clean, inCodeBlock, index, line, result;\n    clean = source.replace(/\\r/g, '').replace(this.itemsInParasPattern, '').split(\"\\n\");\n    index = 0;\n    inCodeBlock = false;\n    result = (function() {\n      var i, len, ref, results;\n      ref = source.split(\"\\n\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        line = ref[i];\n        if (inCodeBlock) {\n          if (line.match(this.endFencesPattern)) {\n            inCodeBlock = false;\n          }\n        } else if (line.match(this.startFencesPattern)) {\n          inCodeBlock = true;\n        } else if (indexOf.call(clean, line) >= 0 && line.match(this.itemPattern)) {\n          index += 1;\n          if (index === itemIndex) {\n            line = checked ? line.replace(this.incompletePattern, this.complete) : line.replace(this.completePattern, this.incomplete);\n          }\n        }\n        results.push(line);\n      }\n      return results;\n    }).call(this);\n    return result.join(\"\\n\");\n  };\n\n  return TaskList;\n\n})();\n\nif (typeof jQuery !== 'undefined') {\n  jQuery.fn.taskList = function(method) {\n    return this.each(function(index, el) {\n      var taskList;\n      taskList = jQuery(el).data('task-list');\n      if (!taskList) {\n        taskList = new TaskList(el);\n        jQuery(el).data('task-list', taskList);\n        if (!method || method === 'enable') {\n          return;\n        }\n      }\n      return taskList[method || 'enable']();\n    });\n  };\n}\n\nmodule.exports = TaskList;\n\n\n/***/ })\n/******/ ]);\n});","import Mousetrap from 'mousetrap';\nimport findAndFollowLink from '../../lib/utils/navigation_utility';\nimport Shortcuts from './shortcuts';\n\nexport default class ShortcutsNavigation extends Shortcuts {\n  constructor() {\n    super();\n\n    Mousetrap.bind('g p', () => findAndFollowLink('.shortcuts-project'));\n    Mousetrap.bind('g v', () => findAndFollowLink('.shortcuts-project-activity'));\n    Mousetrap.bind('g r', () => findAndFollowLink('.shortcuts-project-releases'));\n    Mousetrap.bind('g f', () => findAndFollowLink('.shortcuts-tree'));\n    Mousetrap.bind('g c', () => findAndFollowLink('.shortcuts-commits'));\n    Mousetrap.bind('g j', () => findAndFollowLink('.shortcuts-builds'));\n    Mousetrap.bind('g n', () => findAndFollowLink('.shortcuts-network'));\n    Mousetrap.bind('g d', () => findAndFollowLink('.shortcuts-repository-charts'));\n    Mousetrap.bind('g i', () => findAndFollowLink('.shortcuts-issues'));\n    Mousetrap.bind('g b', () => findAndFollowLink('.shortcuts-issue-boards'));\n    Mousetrap.bind('g m', () => findAndFollowLink('.shortcuts-merge_requests'));\n    Mousetrap.bind('g w', () => findAndFollowLink('.shortcuts-wiki'));\n    Mousetrap.bind('g s', () => findAndFollowLink('.shortcuts-snippets'));\n    Mousetrap.bind('g k', () => findAndFollowLink('.shortcuts-kubernetes'));\n    Mousetrap.bind('g e', () => findAndFollowLink('.shortcuts-environments'));\n    Mousetrap.bind('g l', () => findAndFollowLink('.shortcuts-metrics'));\n    Mousetrap.bind('i', () => findAndFollowLink('.shortcuts-new-issue'));\n\n    this.enabledHelp.push('.hidden-shortcut.project');\n  }\n}\n","import $ from 'jquery';\nimport AccessorUtilities from './lib/utils/accessor';\n\nexport default class ProjectSelectComboButton {\n  constructor(select) {\n    this.projectSelectInput = $(select);\n    this.newItemBtn = $('.new-project-item-link');\n    this.resourceType = this.newItemBtn.data('type');\n    this.resourceLabel = this.newItemBtn.data('label');\n    this.formattedText = this.deriveTextVariants();\n    this.groupId = this.projectSelectInput.data('groupId');\n    this.bindEvents();\n    this.initLocalStorage();\n  }\n\n  bindEvents() {\n    this.projectSelectInput\n      .siblings('.new-project-item-select-button')\n      .on('click', e => this.openDropdown(e));\n\n    this.newItemBtn.on('click', e => {\n      if (!this.getProjectFromLocalStorage()) {\n        e.preventDefault();\n        this.openDropdown(e);\n      }\n    });\n\n    this.projectSelectInput.on('change', () => this.selectProject());\n  }\n\n  initLocalStorage() {\n    const localStorageIsSafe = AccessorUtilities.isLocalStorageAccessSafe();\n\n    if (localStorageIsSafe) {\n      this.localStorageKey = [\n        'group',\n        this.groupId,\n        this.formattedText.localStorageItemType,\n        'recent-project',\n      ].join('-');\n      this.setBtnTextFromLocalStorage();\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  openDropdown(event) {\n    $(event.currentTarget)\n      .siblings('.project-item-select')\n      .select2('open');\n  }\n\n  selectProject() {\n    const selectedProjectData = JSON.parse(this.projectSelectInput.val());\n    const projectUrl = `${selectedProjectData.url}/${this.projectSelectInput.data('relativePath')}`;\n    const projectName = selectedProjectData.name;\n\n    const projectMeta = {\n      url: projectUrl,\n      name: projectName,\n    };\n\n    this.setNewItemBtnAttributes(projectMeta);\n    this.setProjectInLocalStorage(projectMeta);\n  }\n\n  setBtnTextFromLocalStorage() {\n    const cachedProjectData = this.getProjectFromLocalStorage();\n\n    this.setNewItemBtnAttributes(cachedProjectData);\n  }\n\n  setNewItemBtnAttributes(project) {\n    if (project) {\n      this.newItemBtn.attr('href', project.url);\n      this.newItemBtn.text(`${this.formattedText.defaultTextPrefix} in ${project.name}`);\n    } else {\n      this.newItemBtn.text(`Select project to create ${this.formattedText.presetTextSuffix}`);\n    }\n  }\n\n  getProjectFromLocalStorage() {\n    const projectString = localStorage.getItem(this.localStorageKey);\n\n    return JSON.parse(projectString);\n  }\n\n  setProjectInLocalStorage(projectMeta) {\n    const projectString = JSON.stringify(projectMeta);\n\n    localStorage.setItem(this.localStorageKey, projectString);\n  }\n\n  deriveTextVariants() {\n    const defaultTextPrefix = this.resourceLabel;\n\n    // the trailing slice call depluralizes each of these strings (e.g. new-issues -> new-issue)\n    const localStorageItemType = `new-${this.resourceType\n      .split('_')\n      .join('-')\n      .slice(0, -1)}`;\n    const presetTextSuffix = this.resourceType\n      .split('_')\n      .join(' ')\n      .slice(0, -1);\n\n    return {\n      localStorageItemType, // new-issue / new-merge-request\n      defaultTextPrefix, // New issue / New merge request\n      presetTextSuffix, // issue / merge request\n    };\n  }\n}\n","/* eslint-disable func-names, no-var, object-shorthand, one-var, no-else-return */\n\nimport $ from 'jquery';\nimport Api from './api';\nimport ProjectSelectComboButton from './project_select_combo_button';\n\nexport default function projectSelect() {\n  $('.ajax-project-select').each(function(i, select) {\n    var placeholder;\n    const simpleFilter = $(select).data('simpleFilter') || false;\n    this.groupId = $(select).data('groupId');\n    this.includeGroups = $(select).data('includeGroups');\n    this.allProjects = $(select).data('allProjects') || false;\n    this.orderBy = $(select).data('orderBy') || 'id';\n    this.withIssuesEnabled = $(select).data('withIssuesEnabled');\n    this.withMergeRequestsEnabled = $(select).data('withMergeRequestsEnabled');\n    this.withShared =\n      $(select).data('withShared') === undefined ? true : $(select).data('withShared');\n    this.includeProjectsInSubgroups = $(select).data('includeProjectsInSubgroups') || false;\n    this.allowClear = $(select).data('allowClear') || false;\n\n    placeholder = 'Search for project';\n    if (this.includeGroups) {\n      placeholder += ' or group';\n    }\n\n    $(select).select2({\n      placeholder: placeholder,\n      minimumInputLength: 0,\n      query: (function(_this) {\n        return function(query) {\n          var finalCallback, projectsCallback;\n          finalCallback = function(projects) {\n            var data;\n            data = {\n              results: projects,\n            };\n            return query.callback(data);\n          };\n          if (_this.includeGroups) {\n            projectsCallback = function(projects) {\n              var groupsCallback;\n              groupsCallback = function(groups) {\n                var data;\n                data = groups.concat(projects);\n                return finalCallback(data);\n              };\n              return Api.groups(query.term, {}, groupsCallback);\n            };\n          } else {\n            projectsCallback = finalCallback;\n          }\n          if (_this.groupId) {\n            return Api.groupProjects(\n              _this.groupId,\n              query.term,\n              {\n                with_issues_enabled: _this.withIssuesEnabled,\n                with_merge_requests_enabled: _this.withMergeRequestsEnabled,\n                with_shared: _this.withShared,\n                include_subgroups: _this.includeProjectsInSubgroups,\n              },\n              projectsCallback,\n            );\n          } else {\n            return Api.projects(\n              query.term,\n              {\n                order_by: _this.orderBy,\n                with_issues_enabled: _this.withIssuesEnabled,\n                with_merge_requests_enabled: _this.withMergeRequestsEnabled,\n                membership: !_this.allProjects,\n              },\n              projectsCallback,\n            );\n          }\n        };\n      })(this),\n      id: function(project) {\n        if (simpleFilter) return project.id;\n        return JSON.stringify({\n          name: project.name,\n          url: project.web_url,\n        });\n      },\n      text: function(project) {\n        return project.name_with_namespace || project.name;\n      },\n\n      initSelection: function(el, callback) {\n        return Api.project(el.val()).then(({ data }) => callback(data));\n      },\n\n      allowClear: this.allowClear,\n\n      dropdownCssClass: 'ajax-project-dropdown',\n    });\n    if (simpleFilter) return select;\n    return new ProjectSelectComboButton(select);\n  });\n}\n","/* eslint-disable func-names, no-var, no-return-assign, one-var, object-shorthand, vars-on-top */\n\nimport $ from 'jquery';\nimport Cookies from 'js-cookie';\nimport { __ } from '~/locale';\nimport { visitUrl } from '~/lib/utils/url_utility';\nimport axios from '~/lib/utils/axios_utils';\nimport flash from '~/flash';\nimport projectSelect from '../../project_select';\n\nexport default class Project {\n  constructor() {\n    const $cloneOptions = $('ul.clone-options-dropdown');\n    const $projectCloneField = $('#project_clone');\n    const $cloneBtnLabel = $('.js-git-clone-holder .js-clone-dropdown-label');\n    const mobileCloneField = document.querySelector(\n      '.js-mobile-git-clone .js-clone-dropdown-label',\n    );\n\n    const selectedCloneOption = $cloneBtnLabel.text().trim();\n    if (selectedCloneOption.length > 0) {\n      $(`a:contains('${selectedCloneOption}')`, $cloneOptions).addClass('is-active');\n    }\n\n    $('a', $cloneOptions).on('click', e => {\n      e.preventDefault();\n      const $this = $(e.currentTarget);\n      const url = $this.attr('href');\n      const cloneType = $this.data('cloneType');\n\n      $('.is-active', $cloneOptions).removeClass('is-active');\n      $(`a[data-clone-type=\"${cloneType}\"]`).each(function() {\n        const $el = $(this);\n        const activeText = $el.find('.dropdown-menu-inner-title').text();\n        const $container = $el.closest('.project-clone-holder');\n        const $label = $container.find('.js-clone-dropdown-label');\n\n        $el.toggleClass('is-active');\n        $label.text(activeText);\n      });\n\n      if (mobileCloneField) {\n        mobileCloneField.dataset.clipboardText = url;\n      } else {\n        $projectCloneField.val(url);\n      }\n      $('.js-git-empty .js-clone').text(url);\n    });\n    // Ref switcher\n    Project.initRefSwitcher();\n    $('.project-refs-select').on('change', function() {\n      return $(this)\n        .parents('form')\n        .submit();\n    });\n    $('.hide-no-ssh-message').on('click', function(e) {\n      Cookies.set('hide_no_ssh_message', 'false');\n      $(this)\n        .parents('.no-ssh-key-message')\n        .remove();\n      return e.preventDefault();\n    });\n    $('.hide-no-password-message').on('click', function(e) {\n      Cookies.set('hide_no_password_message', 'false');\n      $(this)\n        .parents('.no-password-message')\n        .remove();\n      return e.preventDefault();\n    });\n    $('.hide-auto-devops-implicitly-enabled-banner').on('click', function(e) {\n      const projectId = $(this).data('project-id');\n      const cookieKey = `hide_auto_devops_implicitly_enabled_banner_${projectId}`;\n      Cookies.set(cookieKey, 'false');\n      $(this)\n        .parents('.auto-devops-implicitly-enabled-banner')\n        .remove();\n      return e.preventDefault();\n    });\n    Project.projectSelectDropdown();\n  }\n\n  static projectSelectDropdown() {\n    projectSelect();\n    $('.project-item-select').on('click', e => Project.changeProject($(e.currentTarget).val()));\n  }\n\n  static changeProject(url) {\n    return (window.location = url);\n  }\n\n  static initRefSwitcher() {\n    var refListItem = document.createElement('li');\n    var refLink = document.createElement('a');\n\n    refLink.href = '#';\n\n    return $('.js-project-refs-dropdown').each(function() {\n      var $dropdown, selected;\n      $dropdown = $(this);\n      selected = $dropdown.data('selected');\n      return $dropdown.glDropdown({\n        data(term, callback) {\n          axios\n            .get($dropdown.data('refsUrl'), {\n              params: {\n                ref: $dropdown.data('ref'),\n                search: term,\n              },\n            })\n            .then(({ data }) => callback(data))\n            .catch(() => flash(__('An error occurred while getting projects')));\n        },\n        selectable: true,\n        filterable: true,\n        filterRemote: true,\n        filterByText: true,\n        inputFieldName: $dropdown.data('inputFieldName'),\n        fieldName: $dropdown.data('fieldName'),\n        renderRow: function(ref) {\n          var li = refListItem.cloneNode(false);\n\n          if (ref.header != null) {\n            li.className = 'dropdown-header';\n            li.textContent = ref.header;\n          } else {\n            var link = refLink.cloneNode(false);\n\n            if (ref === selected) {\n              link.className = 'is-active';\n            }\n\n            link.textContent = ref;\n            link.dataset.ref = ref;\n\n            li.appendChild(link);\n          }\n\n          return li;\n        },\n        id: function(obj, $el) {\n          return $el.attr('data-ref');\n        },\n        toggleLabel: function(obj, $el) {\n          return $el.text().trim();\n        },\n        clicked: function(options) {\n          const { e } = options;\n          e.preventDefault();\n          if ($('input[name=\"ref\"]').length) {\n            var $form = $dropdown.closest('form');\n\n            var $visit = $dropdown.data('visit');\n            var shouldVisit = $visit ? true : $visit;\n            var action = $form.attr('action');\n            var divider = action.indexOf('?') === -1 ? '?' : '&';\n            if (shouldVisit) {\n              visitUrl(`${action}${divider}${$form.serialize()}`);\n            }\n          }\n        },\n      });\n    });\n  }\n}\n","/* eslint-disable func-names, no-var, no-underscore-dangle, no-param-reassign, prefer-template, consistent-return, one-var, no-else-return */\n\nimport $ from 'jquery';\n\n// LineHighlighter\n//\n// Handles single- and multi-line selection and highlight for blob views.\n//\n//\n// ### Example Markup\n//\n//   <div id=\"blob-content-holder\">\n//     <div class=\"file-content\">\n//       <div class=\"line-numbers\">\n//         <a href=\"#L1\" id=\"L1\" data-line-number=\"1\">1</a>\n//         <a href=\"#L2\" id=\"L2\" data-line-number=\"2\">2</a>\n//         <a href=\"#L3\" id=\"L3\" data-line-number=\"3\">3</a>\n//         <a href=\"#L4\" id=\"L4\" data-line-number=\"4\">4</a>\n//         <a href=\"#L5\" id=\"L5\" data-line-number=\"5\">5</a>\n//       </div>\n//       <pre class=\"code highlight\">\n//         <code>\n//           <span id=\"LC1\" class=\"line\">...</span>\n//           <span id=\"LC2\" class=\"line\">...</span>\n//           <span id=\"LC3\" class=\"line\">...</span>\n//           <span id=\"LC4\" class=\"line\">...</span>\n//           <span id=\"LC5\" class=\"line\">...</span>\n//         </code>\n//       </pre>\n//     </div>\n//   </div>\n//\n\nconst LineHighlighter = function(options = {}) {\n  options.highlightLineClass = options.highlightLineClass || 'hll';\n  options.fileHolderSelector = options.fileHolderSelector || '.file-holder';\n  options.scrollFileHolder = options.scrollFileHolder || false;\n  options.hash = options.hash || window.location.hash;\n\n  this.options = options;\n  this._hash = options.hash;\n  this.highlightLineClass = options.highlightLineClass;\n  this.setHash = this.setHash.bind(this);\n  this.highlightLine = this.highlightLine.bind(this);\n  this.clickHandler = this.clickHandler.bind(this);\n  this.highlightHash = this.highlightHash.bind(this);\n\n  this.bindEvents();\n  this.highlightHash();\n};\n\nLineHighlighter.prototype.bindEvents = function() {\n  const $fileHolder = $(this.options.fileHolderSelector);\n\n  $fileHolder.on('click', 'a[data-line-number]', this.clickHandler);\n  $fileHolder.on('highlight:line', this.highlightHash);\n};\n\nLineHighlighter.prototype.highlightHash = function(newHash) {\n  let range;\n  if (newHash && typeof newHash === 'string') this._hash = newHash;\n\n  this.clearHighlight();\n\n  if (this._hash !== '') {\n    range = this.hashToRange(this._hash);\n    if (range[0]) {\n      this.highlightRange(range);\n      const lineSelector = `#L${range[0]}`;\n      const scrollOptions = {\n        // Scroll to the first highlighted line on initial load\n        // Offset -50 for the sticky top bar, and another -100 for some context\n        offset: -150,\n      };\n      if (this.options.scrollFileHolder) {\n        $(this.options.fileHolderSelector).scrollTo(lineSelector, scrollOptions);\n      } else {\n        $.scrollTo(lineSelector, scrollOptions);\n      }\n    }\n  }\n};\n\nLineHighlighter.prototype.clickHandler = function(event) {\n  var current, lineNumber, range;\n  event.preventDefault();\n  this.clearHighlight();\n  lineNumber = $(event.target)\n    .closest('a')\n    .data('lineNumber');\n  current = this.hashToRange(this._hash);\n  if (!(current[0] && event.shiftKey)) {\n    // If there's no current selection, or there is but Shift wasn't held,\n    // treat this like a single-line selection.\n    this.setHash(lineNumber);\n    return this.highlightLine(lineNumber);\n  } else if (event.shiftKey) {\n    if (lineNumber < current[0]) {\n      range = [lineNumber, current[0]];\n    } else {\n      range = [current[0], lineNumber];\n    }\n    this.setHash(range[0], range[1]);\n    return this.highlightRange(range);\n  }\n};\n\nLineHighlighter.prototype.clearHighlight = function() {\n  return $('.' + this.highlightLineClass).removeClass(this.highlightLineClass);\n};\n\n// Convert a URL hash String into line numbers\n//\n// hash - Hash String\n//\n// Examples:\n//\n//   hashToRange('#L5')    # => [5, null]\n//   hashToRange('#L5-15') # => [5, 15]\n//   hashToRange('#foo')   # => [null, null]\n//\n// Returns an Array\nLineHighlighter.prototype.hashToRange = function(hash) {\n  var first, last, matches;\n  // ?L(\\d+)(?:-(\\d+))?$/)\n  matches = hash.match(/^#?L(\\d+)(?:-(\\d+))?$/);\n  if (matches && matches.length) {\n    first = parseInt(matches[1], 10);\n    last = matches[2] ? parseInt(matches[2], 10) : null;\n    return [first, last];\n  } else {\n    return [null, null];\n  }\n};\n\n// Highlight a single line\n//\n// lineNumber - Line number to highlight\nLineHighlighter.prototype.highlightLine = function(lineNumber) {\n  return $('#LC' + lineNumber).addClass(this.highlightLineClass);\n};\n\n// Highlight all lines within a range\n//\n// range - Array containing the starting and ending line numbers\nLineHighlighter.prototype.highlightRange = function(range) {\n  if (range[1]) {\n    const results = [];\n    const ref = range[0] <= range[1] ? range : range.reverse();\n\n    for (let lineNumber = range[0]; lineNumber <= ref[1]; lineNumber += 1) {\n      results.push(this.highlightLine(lineNumber));\n    }\n\n    return results;\n  } else {\n    return this.highlightLine(range[0]);\n  }\n};\n\n// Set the URL hash string\nLineHighlighter.prototype.setHash = function(firstLineNumber, lastLineNumber) {\n  var hash;\n  if (lastLineNumber) {\n    hash = '#L' + firstLineNumber + '-' + lastLineNumber;\n  } else {\n    hash = '#L' + firstLineNumber;\n  }\n  this._hash = hash;\n  return this.__setLocationHash__(hash);\n};\n\n// Make the actual hash change in the browser\n//\n// This method is stubbed in tests.\nLineHighlighter.prototype.__setLocationHash__ = function(value) {\n  return window.history.pushState(\n    {\n      url: value,\n      // We're using pushState instead of assigning location.hash directly to\n      // prevent the page from scrolling on the hashchange event\n    },\n    document.title,\n    value,\n  );\n};\n\nexport default LineHighlighter;\n","import Notes from './notes';\n\nexport default () => {\n  const dataEl = document.querySelector('.js-notes-data');\n  const { notesUrl, notesIds, now, diffView, enableGFM } = JSON.parse(dataEl.innerHTML);\n\n  // Create a singleton so that we don't need to assign\n  // into the window object, we can just access the current isntance with Notes.instance\n  Notes.initialize(notesUrl, notesIds, now, diffView, enableGFM);\n};\n","import initGkeDropdowns from '~/projects/gke_cluster_dropdowns';\nimport PersistentUserCallout from '../../persistent_user_callout';\nimport Project from './project';\nimport ShortcutsNavigation from '../../behaviors/shortcuts/shortcuts_navigation';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const { page } = document.body.dataset;\n  const newClusterViews = [\n    'projects:clusters:new',\n    'projects:clusters:create_gcp',\n    'projects:clusters:create_user',\n  ];\n\n  if (newClusterViews.indexOf(page) > -1) {\n    const callout = document.querySelector('.gcp-signup-offer');\n    if (callout) new PersistentUserCallout(callout); // eslint-disable-line no-new\n\n    initGkeDropdowns();\n  }\n\n  new Project(); // eslint-disable-line no-new\n  new ShortcutsNavigation(); // eslint-disable-line no-new\n});\n","export default () => {\n  const { protocol, host, pathname } = window.location;\n  const shareBtn = document.querySelector('.js-share-btn');\n  const embedBtn = document.querySelector('.js-embed-btn');\n  const snippetUrlArea = document.querySelector('.js-snippet-url-area');\n  const embedAction = document.querySelector('.js-embed-action');\n  const url = `${protocol}//${host + pathname}`;\n\n  shareBtn.addEventListener('click', () => {\n    shareBtn.classList.add('is-active');\n    embedBtn.classList.remove('is-active');\n    snippetUrlArea.value = url;\n    embedAction.innerText = 'Share';\n  });\n\n  embedBtn.addEventListener('click', () => {\n    embedBtn.classList.add('is-active');\n    shareBtn.classList.remove('is-active');\n    const scriptTag = `<script src=\"${url}.js\"></script>`;\n    snippetUrlArea.value = scriptTag;\n    embedAction.innerText = 'Embed';\n  });\n};\n","import $ from 'jquery';\nimport Dropzone from 'dropzone';\nimport _ from 'underscore';\nimport './behaviors/preview_markdown';\nimport csrf from './lib/utils/csrf';\nimport axios from './lib/utils/axios_utils';\n\nDropzone.autoDiscover = false;\n\n/**\n * Return the error message string from the given response.\n *\n * @param {String|Object} res\n */\nfunction getErrorMessage(res) {\n  if (!res || _.isString(res)) {\n    return res;\n  }\n\n  return res.message;\n}\n\nexport default function dropzoneInput(form) {\n  const divHover = '<div class=\"div-dropzone-hover\"></div>';\n  const iconPaperclip = '<i class=\"fa fa-paperclip div-dropzone-icon\"></i>';\n  const $attachButton = form.find('.button-attach-file');\n  const $attachingFileMessage = form.find('.attaching-file-message');\n  const $cancelButton = form.find('.button-cancel-uploading-files');\n  const $retryLink = form.find('.retry-uploading-link');\n  const $uploadProgress = form.find('.uploading-progress');\n  const $uploadingErrorContainer = form.find('.uploading-error-container');\n  const $uploadingErrorMessage = form.find('.uploading-error-message');\n  const $uploadingProgressContainer = form.find('.uploading-progress-container');\n  const uploadsPath = form.data('uploads-path') || window.uploads_path || null;\n  const maxFileSize = gon.max_file_size || 10;\n  const formTextarea = form.find('.js-gfm-input');\n  let handlePaste;\n  let pasteText;\n  let addFileToForm;\n  let updateAttachingMessage;\n  let isImage;\n  let getFilename;\n  let uploadFile;\n\n  formTextarea.wrap('<div class=\"div-dropzone\"></div>');\n  formTextarea.on('paste', event => handlePaste(event));\n\n  // Add dropzone area to the form.\n  const $mdArea = formTextarea.closest('.md-area');\n  form.setupMarkdownPreview();\n  const $formDropzone = form.find('.div-dropzone');\n  $formDropzone.parent().addClass('div-dropzone-wrapper');\n  $formDropzone.append(divHover);\n  $formDropzone.find('.div-dropzone-hover').append(iconPaperclip);\n\n  if (!uploadsPath) {\n    $formDropzone.addClass('js-invalid-dropzone');\n    return null;\n  }\n\n  const dropzone = $formDropzone.dropzone({\n    url: uploadsPath,\n    dictDefaultMessage: '',\n    clickable: true,\n    paramName: 'file',\n    maxFilesize: maxFileSize,\n    uploadMultiple: false,\n    headers: csrf.headers,\n    previewContainer: false,\n    processing: () => $('.div-dropzone-alert').alert('close'),\n    dragover: () => {\n      $mdArea.addClass('is-dropzone-hover');\n      form.find('.div-dropzone-hover').css('opacity', 0.7);\n    },\n    dragleave: () => {\n      $mdArea.removeClass('is-dropzone-hover');\n      form.find('.div-dropzone-hover').css('opacity', 0);\n    },\n    drop: () => {\n      $mdArea.removeClass('is-dropzone-hover');\n      form.find('.div-dropzone-hover').css('opacity', 0);\n      formTextarea.focus();\n    },\n    success(header, response) {\n      const processingFileCount = this.getQueuedFiles().length + this.getUploadingFiles().length;\n      const shouldPad = processingFileCount >= 1;\n\n      pasteText(response.link.markdown, shouldPad);\n      // Show 'Attach a file' link only when all files have been uploaded.\n      if (!processingFileCount) $attachButton.removeClass('hide');\n      addFileToForm(response.link.url);\n    },\n    error: (file, errorMessage = 'Attaching the file failed.', xhr) => {\n      // If 'error' event is fired by dropzone, the second parameter is error message.\n      // If the 'errorMessage' parameter is empty, the default error message is set.\n      // If the 'error' event is fired by backend (xhr) error response, the third parameter is\n      // xhr object (xhr.responseText is error message).\n      // On error we hide the 'Attach' and 'Cancel' buttons\n      // and show an error.\n      const message = getErrorMessage(errorMessage || xhr.responseText);\n\n      $uploadingErrorContainer.removeClass('hide');\n      $uploadingErrorMessage.html(message);\n      $attachButton.addClass('hide');\n      $cancelButton.addClass('hide');\n    },\n    totaluploadprogress(totalUploadProgress) {\n      updateAttachingMessage(this.files, $attachingFileMessage);\n      $uploadProgress.text(`${Math.round(totalUploadProgress)}%`);\n    },\n    sending: () => {\n      // DOM elements already exist.\n      // Instead of dynamically generating them,\n      // we just either hide or show them.\n      $attachButton.addClass('hide');\n      $uploadingErrorContainer.addClass('hide');\n      $uploadingProgressContainer.removeClass('hide');\n      $cancelButton.removeClass('hide');\n    },\n    removedfile: () => {\n      $attachButton.removeClass('hide');\n      $cancelButton.addClass('hide');\n      $uploadingProgressContainer.addClass('hide');\n      $uploadingErrorContainer.addClass('hide');\n    },\n    queuecomplete: () => {\n      $('.dz-preview').remove();\n      $('.markdown-area').trigger('input');\n\n      $uploadingProgressContainer.addClass('hide');\n      $cancelButton.addClass('hide');\n    },\n  });\n\n  const child = $(dropzone[0]).children('textarea');\n\n  // removeAllFiles(true) stops uploading files (if any)\n  // and remove them from dropzone files queue.\n  $cancelButton.on('click', e => {\n    e.preventDefault();\n    e.stopPropagation();\n    Dropzone.forElement($formDropzone.get(0)).removeAllFiles(true);\n  });\n\n  // If 'error' event is fired, we store a failed files,\n  // clear dropzone files queue, change status of failed files to undefined,\n  // and add that files to the dropzone files queue again.\n  // addFile() adds file to dropzone files queue and upload it.\n  $retryLink.on('click', e => {\n    const dropzoneInstance = Dropzone.forElement(\n      e.target.closest('.js-main-target-form').querySelector('.div-dropzone'),\n    );\n    const failedFiles = dropzoneInstance.files;\n\n    e.preventDefault();\n\n    // 'true' parameter of removeAllFiles() cancels\n    // uploading of files that are being uploaded at the moment.\n    dropzoneInstance.removeAllFiles(true);\n\n    failedFiles.map(failedFile => {\n      const file = failedFile;\n\n      if (file.status === Dropzone.ERROR) {\n        file.status = undefined;\n        file.accepted = undefined;\n      }\n\n      return dropzoneInstance.addFile(file);\n    });\n  });\n  // eslint-disable-next-line consistent-return\n  handlePaste = event => {\n    const pasteEvent = event.originalEvent;\n    if (pasteEvent.clipboardData && pasteEvent.clipboardData.items) {\n      const image = isImage(pasteEvent);\n      if (image) {\n        event.preventDefault();\n        const filename = getFilename(pasteEvent) || 'image.png';\n        const text = `{{${filename}}}`;\n        pasteText(text);\n        return uploadFile(image.getAsFile(), filename);\n      }\n    }\n  };\n\n  isImage = data => {\n    let i = 0;\n    while (i < data.clipboardData.items.length) {\n      const item = data.clipboardData.items[i];\n      if (item.type.indexOf('image') !== -1) {\n        return item;\n      }\n      i += 1;\n    }\n    return false;\n  };\n\n  pasteText = (text, shouldPad) => {\n    let formattedText = text;\n    if (shouldPad) {\n      formattedText += '\\n\\n';\n    }\n    const textarea = child.get(0);\n    const caretStart = textarea.selectionStart;\n    const caretEnd = textarea.selectionEnd;\n    const textEnd = $(child).val().length;\n    const beforeSelection = $(child)\n      .val()\n      .substring(0, caretStart);\n    const afterSelection = $(child)\n      .val()\n      .substring(caretEnd, textEnd);\n    $(child).val(beforeSelection + formattedText + afterSelection);\n    textarea.setSelectionRange(caretStart + formattedText.length, caretEnd + formattedText.length);\n    textarea.style.height = `${textarea.scrollHeight}px`;\n    formTextarea.get(0).dispatchEvent(new Event('input'));\n    return formTextarea.trigger('input');\n  };\n\n  addFileToForm = path => {\n    $(form).append(`<input type=\"hidden\" name=\"files[]\" value=\"${_.escape(path)}\">`);\n  };\n\n  getFilename = e => {\n    let value;\n    if (window.clipboardData && window.clipboardData.getData) {\n      value = window.clipboardData.getData('Text');\n    } else if (e.clipboardData && e.clipboardData.getData) {\n      value = e.clipboardData.getData('text/plain');\n    }\n    value = value.split('\\r');\n    return value[0];\n  };\n\n  const showSpinner = () => $uploadingProgressContainer.removeClass('hide');\n\n  const closeSpinner = () => $uploadingProgressContainer.addClass('hide');\n\n  const showError = message => {\n    $uploadingErrorContainer.removeClass('hide');\n    $uploadingErrorMessage.html(message);\n  };\n\n  const closeAlertMessage = () => form.find('.div-dropzone-alert').alert('close');\n\n  const insertToTextArea = (filename, url) => {\n    const $child = $(child);\n    $child.val((index, val) => val.replace(`{{${filename}}}`, url));\n\n    $child.trigger('change');\n  };\n\n  uploadFile = (item, filename) => {\n    const formData = new FormData();\n    formData.append('file', item, filename);\n\n    showSpinner();\n    closeAlertMessage();\n\n    axios\n      .post(uploadsPath, formData)\n      .then(({ data }) => {\n        const md = data.link.markdown;\n\n        insertToTextArea(filename, md);\n        closeSpinner();\n      })\n      .catch(e => {\n        showError(e.response.data.message);\n        closeSpinner();\n      });\n  };\n\n  updateAttachingMessage = (files, messageContainer) => {\n    let attachingMessage;\n    const filesCount = files.filter(file => file.status === 'uploading' || file.status === 'queued')\n      .length;\n\n    // Dinamycally change uploading files text depending on files number in\n    // dropzone files queue.\n    if (filesCount > 1) {\n      attachingMessage = `Attaching ${filesCount} files -`;\n    } else {\n      attachingMessage = 'Attaching a file -';\n    }\n\n    messageContainer.text(attachingMessage);\n  };\n\n  form.find('.markdown-selector').click(function onMarkdownClick(e) {\n    e.preventDefault();\n    $(this)\n      .closest('.gfm-form')\n      .find('.div-dropzone')\n      .click();\n    formTextarea.focus();\n  });\n\n  return Dropzone.forElement($formDropzone.get(0));\n}\n","import $ from 'jquery';\nimport autosize from 'autosize';\nimport GfmAutoComplete, * as GFMConfig from './gfm_auto_complete';\nimport dropzoneInput from './dropzone_input';\nimport { addMarkdownListeners, removeMarkdownListeners } from './lib/utils/text_markdown';\n\nexport default class GLForm {\n  constructor(form, enableGFM = {}) {\n    this.form = form;\n    this.textarea = this.form.find('textarea.js-gfm-input');\n    this.enableGFM = Object.assign({}, GFMConfig.defaultAutocompleteConfig, enableGFM);\n    // Disable autocomplete for keywords which do not have dataSources available\n    const dataSources = (gl.GfmAutoComplete && gl.GfmAutoComplete.dataSources) || {};\n    Object.keys(this.enableGFM).forEach(item => {\n      if (item !== 'emojis') {\n        this.enableGFM[item] = !!dataSources[item];\n      }\n    });\n    // Before we start, we should clean up any previous data for this form\n    this.destroy();\n    // Set up the form\n    this.setupForm();\n    this.form.data('glForm', this);\n  }\n\n  destroy() {\n    // Clean form listeners\n    this.clearEventListeners();\n    if (this.autoComplete) {\n      this.autoComplete.destroy();\n    }\n    this.form.data('glForm', null);\n  }\n\n  setupForm() {\n    const isNewForm = this.form.is(':not(.gfm-form)');\n    this.form.removeClass('js-new-note-form');\n    if (isNewForm) {\n      this.form.find('.div-dropzone').remove();\n      this.form.addClass('gfm-form');\n      // remove notify commit author checkbox for non-commit notes\n      gl.utils.disableButtonIfEmptyField(\n        this.form.find('.js-note-text'),\n        this.form.find('.js-comment-button, .js-note-new-discussion'),\n      );\n      this.autoComplete = new GfmAutoComplete(gl.GfmAutoComplete && gl.GfmAutoComplete.dataSources);\n      this.autoComplete.setup(this.form.find('.js-gfm-input'), this.enableGFM);\n      dropzoneInput(this.form);\n      autosize(this.textarea);\n    }\n    // form and textarea event listeners\n    this.addEventListeners();\n    addMarkdownListeners(this.form);\n    this.form.show();\n    if (this.isAutosizeable) this.setupAutosize();\n  }\n\n  setupAutosize() {\n    this.textarea.off('autosize:resized').on('autosize:resized', this.setHeightData.bind(this));\n\n    this.textarea.off('mouseup.autosize').on('mouseup.autosize', this.destroyAutosize.bind(this));\n\n    setTimeout(() => {\n      autosize(this.textarea);\n      this.textarea.css('resize', 'vertical');\n    }, 0);\n  }\n\n  setHeightData() {\n    this.textarea.data('height', this.textarea.outerHeight());\n  }\n\n  destroyAutosize() {\n    const outerHeight = this.textarea.outerHeight();\n\n    if (this.textarea.data('height') === outerHeight) return;\n\n    autosize.destroy(this.textarea);\n\n    this.textarea.data('height', outerHeight);\n    this.textarea.outerHeight(outerHeight);\n    this.textarea.css('max-height', window.outerHeight);\n  }\n\n  clearEventListeners() {\n    this.textarea.off('focus');\n    this.textarea.off('blur');\n    removeMarkdownListeners(this.form);\n  }\n\n  addEventListeners() {\n    this.textarea.on('focus', function focusTextArea() {\n      $(this)\n        .closest('.md-area')\n        .addClass('is-focused');\n    });\n    this.textarea.on('blur', function blurTextArea() {\n      $(this)\n        .closest('.md-area')\n        .removeClass('is-focused');\n    });\n  }\n}\n","/* eslint-disable func-names, prefer-arrow-callback, no-unused-vars, consistent-return, camelcase, class-methods-use-this */\n\n// Zen Mode (full screen) textarea\n//\n/*= provides zen_mode:enter */\n/*= provides zen_mode:leave */\n\nimport $ from 'jquery';\nimport 'vendor/jquery.scrollTo';\nimport Dropzone from 'dropzone';\nimport Mousetrap from 'mousetrap';\nimport 'mousetrap/plugins/pause/mousetrap-pause';\n\nDropzone.autoDiscover = false;\n\n//\n// ### Events\n//\n// `zen_mode:enter`\n//\n// Fired when the \"Edit in fullscreen\" link is clicked.\n//\n// **Synchronicity** Sync\n// **Bubbles** Yes\n// **Cancelable** No\n// **Target** a.js-zen-enter\n//\n// `zen_mode:leave`\n//\n// Fired when the \"Leave Fullscreen\" link is clicked.\n//\n// **Synchronicity** Sync\n// **Bubbles** Yes\n// **Cancelable** No\n// **Target** a.js-zen-leave\n//\n\nexport default class ZenMode {\n  constructor() {\n    this.active_backdrop = null;\n    this.active_textarea = null;\n    $(document).on('click', '.js-zen-enter', function(e) {\n      e.preventDefault();\n      return $(e.currentTarget).trigger('zen_mode:enter');\n    });\n    $(document).on('click', '.js-zen-leave', function(e) {\n      e.preventDefault();\n      return $(e.currentTarget).trigger('zen_mode:leave');\n    });\n    $(document).on(\n      'zen_mode:enter',\n      (function(_this) {\n        return function(e) {\n          return _this.enter(\n            $(e.target)\n              .closest('.md-area')\n              .find('.zen-backdrop'),\n          );\n        };\n      })(this),\n    );\n    $(document).on(\n      'zen_mode:leave',\n      (function(_this) {\n        return function(e) {\n          return _this.exit();\n        };\n      })(this),\n    );\n    $(document).on('keydown', function(e) {\n      // Esc\n      if (e.keyCode === 27) {\n        e.preventDefault();\n        return $(document).trigger('zen_mode:leave');\n      }\n    });\n  }\n\n  enter(backdrop) {\n    Mousetrap.pause();\n    this.active_backdrop = $(backdrop);\n    this.active_backdrop.addClass('fullscreen');\n    this.active_textarea = this.active_backdrop.find('textarea');\n    // Prevent a user-resized textarea from persisting to fullscreen\n    this.active_textarea.removeAttr('style');\n    this.active_textarea.focus();\n  }\n\n  exit() {\n    if (this.active_textarea) {\n      Mousetrap.unpause();\n      this.active_textarea.closest('.zen-backdrop').removeClass('fullscreen');\n      this.scrollTo(this.active_textarea);\n      this.active_textarea = null;\n      this.active_backdrop = null;\n\n      const $dropzone = $('.div-dropzone');\n      if ($dropzone && !$dropzone.hasClass('js-invalid-dropzone')) {\n        Dropzone.forElement('.div-dropzone').enable();\n      }\n    }\n  }\n\n  scrollTo(zen_area) {\n    return $.scrollTo(zen_area, 0, {\n      offset: -150,\n    });\n  }\n}\n"],"sourceRoot":""}