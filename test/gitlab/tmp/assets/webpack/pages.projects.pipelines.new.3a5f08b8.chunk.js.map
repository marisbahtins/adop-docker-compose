{"version":3,"sources":["webpack:///./pages/projects/pipelines/new/index.js","webpack:///./ref_select_dropdown.js","webpack:///./new_branch_form.js"],"names":["__webpack_require__","r","__webpack_exports__","jquery__WEBPACK_IMPORTED_MODULE_0__","jquery__WEBPACK_IMPORTED_MODULE_0___default","n","_new_branch_form__WEBPACK_IMPORTED_MODULE_1__","_ci_variable_list_native_form_variable_list__WEBPACK_IMPORTED_MODULE_2__","document","addEventListener","NewBranchForm","$","setupNativeFormVariableList","container","formField","RefSelectDropdown","$dropdownButton","availableRefs","_classCallCheck","this","availableRefsValue","JSON","parse","getElementById","innerHTML","glDropdown","data","filterable","filterByText","remote","fieldName","filterInput","selectable","isSelectable","branch","$el","hasClass","text","id","toggleLabel","$dropdownContainer","closest","$fieldInput","concat","$filterInput","on","e","keyCode","which","ref","val","trim","removeClass","form","validate","bind","branchNameError","find","name","setupRestrictions","addBinding","init","length","trigger","endsWith","invalid","single","startsWith","pattern","prefix","conjunction","restrictions","errorMessage","errors","formatter","unique","validator","_this","indexOf","empty","values","value","call","push","restriction","formatted","map","test","join","matched","match","reduce","append"],"mappings":"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","file":"pages.projects.pipelines.new.3a5f08b8.chunk.js","sourcesContent":["import $ from 'jquery';\nimport NewBranchForm from '~/new_branch_form';\nimport setupNativeFormVariableList from '~/ci_variable_list/native_form_variable_list';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  new NewBranchForm($('.js-new-pipeline-form')); // eslint-disable-line no-new\n\n  setupNativeFormVariableList({\n    container: $('.js-ci-variable-list-section'),\n    formField: 'variables_attributes',\n  });\n});\n","import $ from 'jquery';\n\nclass RefSelectDropdown {\n  constructor($dropdownButton, availableRefs) {\n    const availableRefsValue =\n      availableRefs || JSON.parse(document.getElementById('availableRefs').innerHTML);\n    $dropdownButton.glDropdown({\n      data: availableRefsValue,\n      filterable: true,\n      filterByText: true,\n      remote: false,\n      fieldName: $dropdownButton.data('fieldName'),\n      filterInput: 'input[type=\"search\"]',\n      selectable: true,\n      isSelectable(branch, $el) {\n        return !$el.hasClass('is-active');\n      },\n      text(branch) {\n        return branch;\n      },\n      id(branch) {\n        return branch;\n      },\n      toggleLabel(branch) {\n        return branch;\n      },\n    });\n\n    const $dropdownContainer = $dropdownButton.closest('.dropdown');\n    const $fieldInput = $(`input[name=\"${$dropdownButton.data('fieldName')}\"]`, $dropdownContainer);\n    const $filterInput = $('input[type=\"search\"]', $dropdownContainer);\n\n    $filterInput.on('keyup', e => {\n      const keyCode = e.keyCode || e.which;\n      if (keyCode !== 13) return;\n\n      const ref = $filterInput.val().trim();\n      if (ref === '') {\n        return;\n      }\n\n      $fieldInput.val(ref);\n      $('.dropdown-toggle-text', $dropdownButton).text(ref);\n\n      $dropdownContainer.removeClass('open');\n    });\n  }\n}\n\nexport default RefSelectDropdown;\n","/* eslint-disable func-names, no-var, one-var, consistent-return, no-return-assign, prefer-arrow-callback, prefer-template, no-shadow, no-else-return */\n\nimport $ from 'jquery';\nimport RefSelectDropdown from './ref_select_dropdown';\n\nexport default class NewBranchForm {\n  constructor(form, availableRefs) {\n    this.validate = this.validate.bind(this);\n    this.branchNameError = form.find('.js-branch-name-error');\n    this.name = form.find('.js-branch-name');\n    this.ref = form.find('#ref');\n    new RefSelectDropdown($('.js-branch-select'), availableRefs); // eslint-disable-line no-new\n    this.setupRestrictions();\n    this.addBinding();\n    this.init();\n  }\n\n  addBinding() {\n    return this.name.on('blur', this.validate);\n  }\n\n  init() {\n    if (this.name.length && this.name.val().length > 0) {\n      return this.name.trigger('blur');\n    }\n  }\n\n  setupRestrictions() {\n    var endsWith, invalid, single, startsWith;\n    startsWith = {\n      pattern: /^(\\/|\\.)/g,\n      prefix: \"can't start with\",\n      conjunction: 'or',\n    };\n    endsWith = {\n      pattern: /(\\/|\\.|\\.lock)$/g,\n      prefix: \"can't end in\",\n      conjunction: 'or',\n    };\n    invalid = {\n      pattern: /(\\s|~|\\^|:|\\?|\\*|\\[|\\\\|\\.\\.|@\\{|\\/{2,}){1}/g,\n      prefix: \"can't contain\",\n      conjunction: ', ',\n    };\n    single = {\n      pattern: /^@+$/g,\n      prefix: \"can't be\",\n      conjunction: 'or',\n    };\n    return (this.restrictions = [startsWith, invalid, endsWith, single]);\n  }\n\n  validate() {\n    var errorMessage, errors, formatter, unique, validator;\n    const { indexOf } = [];\n\n    this.branchNameError.empty();\n    unique = function(values, value) {\n      if (indexOf.call(values, value) === -1) {\n        values.push(value);\n      }\n      return values;\n    };\n    formatter = function(values, restriction) {\n      var formatted;\n      formatted = values.map(function(value) {\n        switch (false) {\n          case !/\\s/.test(value):\n            return 'spaces';\n          case !/\\/{2,}/g.test(value):\n            return 'consecutive slashes';\n          default:\n            return \"'\" + value + \"'\";\n        }\n      });\n      return restriction.prefix + ' ' + formatted.join(restriction.conjunction);\n    };\n    validator = (function(_this) {\n      return function(errors, restriction) {\n        var matched;\n        matched = _this.name.val().match(restriction.pattern);\n        if (matched) {\n          return errors.concat(formatter(matched.reduce(unique, []), restriction));\n        } else {\n          return errors;\n        }\n      };\n    })(this);\n    errors = this.restrictions.reduce(validator, []);\n    if (errors.length > 0) {\n      errorMessage = $('<span/>').text(errors.join(', '));\n      return this.branchNameError.append(errorMessage);\n    }\n  }\n}\n"],"sourceRoot":""}